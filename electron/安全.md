```js
åœ¨ Electron ä¸­ï¼ŒwebPreferences çš„ contextIsolationã€nodeIntegration å’Œ sandbox æ˜¯æ ¸å¿ƒå®‰å…¨é…ç½®é€‰é¡¹ï¼Œå®ƒä»¬æ§åˆ¶æ¸²æŸ“è¿›ç¨‹çš„è®¿é—®æƒé™å’Œéš”ç¦»çº§åˆ«ã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†åŒºåˆ«å’Œåº”ç”¨åœºæ™¯ï¼š

1. nodeIntegration: boolean
ä½œç”¨ï¼šæ˜¯å¦å…è®¸æ¸²æŸ“è¿›ç¨‹ç›´æ¥è®¿é—® Node.js APIï¼ˆå¦‚ require()ã€processã€fs ç­‰ï¼‰ã€‚

é»˜è®¤å€¼ï¼šfalse

é£é™©ï¼š

å¼€å¯åï¼Œæ¸²æŸ“è¿›ç¨‹ä¸­çš„ JavaScript å¯ç›´æ¥è°ƒç”¨ Node.js æ¨¡å—ã€‚

è‹¥åŠ è½½äº†ç¬¬ä¸‰æ–¹/è¿œç¨‹å†…å®¹ï¼Œæ¶æ„ä»£ç å¯æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€è®¿é—®æ–‡ä»¶ç³»ç»Ÿã€‚

åº”ç”¨åœºæ™¯ï¼š

ä»…é™æœ¬åœ°å¯ä¿¡å†…å®¹ï¼šå½“çª—å£ä»…åŠ è½½æœ¬åœ°æ‰“åŒ…çš„ HTML/CSS/JSï¼ˆå¦‚ file:// åè®®ï¼‰ï¼Œä¸”æ— éœ€åŠ è½½ä»»ä½•è¿œç¨‹å†…å®¹æ—¶ã€‚

æ—§ç‰ˆå…¼å®¹ï¼šé—ç•™é¡¹ç›®æ— æ³•è¿ç§»åˆ°é¢„åŠ è½½è„šæœ¬æ¨¡å¼ã€‚

ç¤ºä¾‹ï¼š
new BrowserWindow({
  webPreferences: {
    nodeIntegration: true, // é«˜é£é™©ï¼ä»…ç”¨äºå®Œå…¨å¯ä¿¡å†…å®¹
  }
});
2. contextIsolation: boolean
ä½œç”¨ï¼šéš”ç¦»æ¸²æŸ“è¿›ç¨‹çš„ JavaScript ä¸Šä¸‹æ–‡ä¸ Electron å†…éƒ¨ä¸Šä¸‹æ–‡ï¼ˆå¦‚ preload è„šæœ¬ï¼‰ã€‚

é»˜è®¤å€¼ï¼štrueï¼ˆElectron 12+ï¼‰

å®‰å…¨æœºåˆ¶ï¼š

å¼€å¯æ—¶ï¼Œæ¸²æŸ“è¿›ç¨‹æ— æ³•ç›´æ¥è®¿é—® preload è„šæœ¬é™„åŠ åˆ° window çš„å¯¹è±¡ï¼ˆéœ€é€šè¿‡ contextBridge å®‰å…¨æš´éœ²ï¼‰ã€‚

é˜»æ­¢æ¶æ„ä»£ç ç¯¡æ”¹é¢„åŠ è½½çš„ API æˆ–è®¿é—® Electron å†…éƒ¨ã€‚

åº”ç”¨åœºæ™¯ï¼š

æ‰€æœ‰ç”Ÿäº§ç¯å¢ƒï¼šå¼ºçƒˆå»ºè®®å§‹ç»ˆå¼€å¯ï¼ˆé»˜è®¤å€¼ï¼‰ï¼Œå°¤å…¶å½“åŠ è½½è¿œç¨‹å†…å®¹æ—¶ã€‚

å¿…é¡»é…åˆ preload è„šæœ¬ï¼šé€šè¿‡ contextBridge.exposeInMainWorld å®‰å…¨æš´éœ²æœ‰é™ APIã€‚

ç¤ºä¾‹ï¼š
// é¢„åŠ è½½è„šæœ¬ (preload.js)
const { contextBridge } = require('electron');
contextBridge.exposeInMainWorld('api', {
  safeMethod: () => { /* å®‰å…¨æš´éœ²çš„æ–¹æ³• */ }
});

// ä¸»è¿›ç¨‹
new BrowserWindow({
  webPreferences: {
    contextIsolation: true, // å¿…éœ€çš„å®‰å…¨æªæ–½
    preload: 'path/to/preload.js'
  }
});
3. sandbox: boolean
ä½œç”¨ï¼šå¯ç”¨ Chromium çš„æ²™ç®±ç¯å¢ƒï¼Œé™åˆ¶æ¸²æŸ“è¿›ç¨‹çš„æ“ä½œç³»ç»Ÿæƒé™ã€‚

é»˜è®¤å€¼ï¼šfalseï¼ˆä½†å¯¹éƒ¨åˆ†ç³»ç»Ÿæ¸²æŸ“è¿›ç¨‹é»˜è®¤ä¸º trueï¼‰

å®‰å…¨æœºåˆ¶ï¼š

å¼€å¯åï¼Œæ¸²æŸ“è¿›ç¨‹æ— æ³•ç›´æ¥è®¿é—® Node.js æˆ–ç³»ç»Ÿèµ„æºï¼ˆå³ä½¿ nodeIntegration: true ä¹Ÿä¼šè¢«å¿½ç•¥ï¼‰ã€‚

ä»…å…è®¸é€šè¿‡ preload è„šæœ¬ï¼ˆè¿è¡Œåœ¨éæ²™ç®±ç¯å¢ƒï¼‰ç» contextBridge æš´éœ²çš„æœ‰é™ API é—´æ¥æ“ä½œã€‚

åº”ç”¨åœºæ™¯ï¼š

åŠ è½½è¿œç¨‹/ä¸å—ä¿¡å†…å®¹ï¼šå¦‚åµŒå…¥ç½‘é¡µã€ç¬¬ä¸‰æ–¹å¹¿å‘Šç­‰ã€‚

é«˜å®‰å…¨éœ€æ±‚ï¼šé‡‘èã€åŒ»ç–—ç­‰æ•æ„Ÿåº”ç”¨ã€‚

ç¤ºä¾‹ï¼š

new BrowserWindow({
  webPreferences: {
    sandbox: true, // å¯ç”¨æ²™ç®±
    preload: 'path/to/preload.js' // é¢„åŠ è½½è„šæœ¬å¯è®¿é—® Node.js
  }
});
ç»„åˆé…ç½®çš„å®‰å…¨å®è·µ
åœºæ™¯	é…ç½®å»ºè®®	å®‰å…¨ç­‰çº§
åŠ è½½æœ¬åœ°å¯ä¿¡å†…å®¹	nodeIntegration: true + contextIsolation: false + sandbox: false	âš ï¸ ä½
æ··åˆå†…å®¹ï¼ˆæ¨èï¼‰	nodeIntegration: false + contextIsolation: true + sandbox: false	âœ… ä¸­
åŠ è½½è¿œç¨‹å†…å®¹	nodeIntegration: false + contextIsolation: true + sandbox: true	ğŸ”’ é«˜
é»„é‡‘æ³•åˆ™ï¼š

å§‹ç»ˆå¼€å¯ contextIsolationï¼ˆElectron 12+ é»˜è®¤å¼€å¯ï¼‰ã€‚

é™¤éå¿…è¦ï¼Œç¦ç”¨ nodeIntegrationã€‚

å¯¹ä¸å—ä¿¡å†…å®¹å¼ºåˆ¶å¯ç”¨ sandboxã€‚

é€šè¿‡ preload + contextBridge æš´éœ²æœ€å°å¿…è¦ APIã€‚

ä¸ºä½•é¿å… contextIsolation: false + nodeIntegration: trueï¼Ÿ
è¿™ç§ç»„åˆç­‰äºå®Œå…¨ç¦ç”¨å®‰å…¨é˜²æŠ¤ï¼š

æ¸²æŸ“è¿›ç¨‹å¯ç›´æ¥æ‰§è¡Œ Node.js ä»£ç ï¼ˆrequire('child_process').exec('rm -rf /')ï¼‰ã€‚

æ¶æ„è„šæœ¬å¯ä¿®æ”¹ preload æ³¨å…¥çš„ APIï¼ŒåŠ«æŒåˆæ³•æ“ä½œã€‚

ç»å¯¹ç¦æ­¢ åœ¨åŠ è½½è¿œç¨‹å†…å®¹ï¼ˆå¦‚ https://ï¼‰æ—¶ä½¿ç”¨æ­¤é…ç½®ã€‚

æœ€ä½³å®è·µæ€»ç»“

// å®‰å…¨é…ç½®ç¤ºä¾‹ï¼ˆè¿œç¨‹å†…å®¹ï¼‰
const win = new BrowserWindow({
  webPreferences: {
    nodeIntegration: false,    // ç¦ç”¨ Node.js è®¿é—®
    contextIsolation: true,    // å¼ºåˆ¶ä¸Šä¸‹æ–‡éš”ç¦»
    sandbox: true,             // å¯ç”¨ Chromium æ²™ç®±
    preload: path.join(__dirname, 'preload.js') // é€šè¿‡ contextBridge æš´éœ² API
  }
});
å§‹ç»ˆéµå¾ª æœ€å°æƒé™åŸåˆ™ï¼Œä½¿ç”¨é¢„åŠ è½½è„šæœ¬ä½œä¸ºæ¸²æŸ“è¿›ç¨‹ä¸ä¸»è¿›ç¨‹é—´çš„å”¯ä¸€å®‰å…¨é€šé“ã€‚




```
