# ã€Šå‰ç«¯è®¾è®¡æ¨¡å¼å®æˆ˜æ‰‹å†Œã€‹

## ç¬¬åä¸€ç« ï¼šäº«å…ƒæ¨¡å¼ï¼ˆFlyweight Patternï¼‰

---

### ğŸ¯ ä¸€å¥è¯å¤§ç™½è¯

> **äº«å…ƒæ¨¡å¼å°±åƒå›¾ä¹¦é¦†çš„å…±äº«ä¹¦ç±ï¼š1000 ä¸ªå­¦ç”Ÿéƒ½è¦çœ‹ã€ŠJavaScript é«˜çº§ç¨‹åºè®¾è®¡ã€‹ï¼Œå›¾ä¹¦é¦†ä¸éœ€è¦ä¹° 1000 æœ¬ï¼Œåªéœ€è¦ä¹° 10 æœ¬ï¼Œå¤§å®¶è½®æµå€Ÿé˜…ã€‚äº«å…ƒæ¨¡å¼é€šè¿‡"å…±äº«"æ¥å‡å°‘å†…å­˜å ç”¨ï¼Œæé«˜æ€§èƒ½ã€‚**

**æ ¸å¿ƒç†å¿µï¼šé€šè¿‡å…±äº«å¤§é‡ç»†ç²’åº¦çš„å¯¹è±¡æ¥å‡å°‘å†…å­˜ä½¿ç”¨ï¼Œæé«˜æ€§èƒ½ã€‚**

---

### ğŸ¤” ä»€ä¹ˆæ—¶å€™éœ€è¦"äº«å…ƒ"ï¼Ÿ

åœ¨å‰ç«¯å¼€å‘ä¸­ï¼Œç»å¸¸ä¼šé‡åˆ°éœ€è¦åˆ›å»ºå¤§é‡ç›¸ä¼¼å¯¹è±¡çš„åœºæ™¯ï¼š

| åœºæ™¯ | ä¸ºä»€ä¹ˆéœ€è¦äº«å…ƒæ¨¡å¼ |
|------|------------------|
| **å›¾æ ‡/å›¾ç‰‡èµ„æº** | å¤§é‡ç›¸åŒçš„å›¾æ ‡ï¼Œä¸éœ€è¦æ¯ä¸ªéƒ½åˆ›å»ºæ–°å®ä¾‹ |
| **æ ·å¼å¯¹è±¡** | å¤§é‡ç›¸åŒçš„æ ·å¼é…ç½®ï¼Œå¯ä»¥å…±äº« |
| **é…ç½®å¯¹è±¡** | å¤§é‡ç›¸åŒçš„é…ç½®ï¼Œå¯ä»¥å¤ç”¨ |
| **ç»„ä»¶å®ä¾‹** | å¤§é‡ç›¸åŒçš„ç»„ä»¶ï¼Œå¯ä»¥å¤ç”¨å®ä¾‹ |
| **æ•°æ®å¯¹è±¡** | å¤§é‡ç›¸åŒçš„æ•°æ®ç»“æ„ï¼Œå¯ä»¥å…±äº« |
| **ä¸»é¢˜é…ç½®** | å¤šä¸ªç»„ä»¶ä½¿ç”¨ç›¸åŒçš„ä¸»é¢˜é…ç½® |

---

### ğŸ˜« å‰ç«¯ç—›ç‚¹ï¼šæ²¡æœ‰äº«å…ƒæ—¶çš„å™©æ¢¦

#### åœºæ™¯ä¸€ï¼šå›¾æ ‡èµ„æºæµªè´¹

```tsx
// âŒ å™©æ¢¦ä»£ç ï¼šæ¯ä¸ªç»„ä»¶éƒ½åˆ›å»ºæ–°çš„å›¾æ ‡å®ä¾‹

const UserList: React.FC = () => {
  const users = Array.from({ length: 1000 }, (_, i) => ({ id: i, name: `User ${i}` }));
  
  return (
    <div>
      {users.map(user => (
        <div key={user.id}>
          {/* æ¯ä¸ªéƒ½åˆ›å»ºæ–°çš„å›¾æ ‡å®ä¾‹ï¼Œæµªè´¹å†…å­˜ */}
          <UserOutlined style={{ color: '#1890ff' }} />
          {user.name}
        </div>
      ))}
    </div>
  );
};

// é—®é¢˜ï¼š
// 1. 1000 ä¸ªç”¨æˆ· = 1000 ä¸ªå›¾æ ‡å®ä¾‹
// 2. å†…å­˜å ç”¨å¤§
// 3. æ¸²æŸ“æ€§èƒ½å·®
```

#### åœºæ™¯äºŒï¼šæ ·å¼å¯¹è±¡é‡å¤åˆ›å»º

```tsx
// âŒ å™©æ¢¦ä»£ç ï¼šæ¯ä¸ªç»„ä»¶éƒ½åˆ›å»ºæ–°çš„æ ·å¼å¯¹è±¡

const ButtonList: React.FC = () => {
  const buttons = Array.from({ length: 100 }, (_, i) => `Button ${i}`);
  
  return (
    <div>
      {buttons.map((text, index) => (
        <button
          key={index}
          style={{
            // æ¯ä¸ªæŒ‰é’®éƒ½åˆ›å»ºæ–°çš„æ ·å¼å¯¹è±¡ï¼Œå³ä½¿æ ·å¼ç›¸åŒ
            padding: '8px 16px',
            backgroundColor: '#1890ff',
            color: '#fff',
            border: 'none',
            borderRadius: '6px',
            cursor: 'pointer',
          }}
        >
          {text}
        </button>
      ))}
    </div>
  );
};

// é—®é¢˜ï¼š
// 1. 100 ä¸ªæŒ‰é’® = 100 ä¸ªæ ·å¼å¯¹è±¡
// 2. å³ä½¿æ ·å¼ç›¸åŒï¼Œä¹Ÿåˆ›å»ºæ–°å¯¹è±¡
// 3. å†…å­˜æµªè´¹
```

#### åœºæ™¯ä¸‰ï¼šé…ç½®å¯¹è±¡é‡å¤

```tsx
// âŒ å™©æ¢¦ä»£ç ï¼šæ¯ä¸ªç»„ä»¶éƒ½åˆ›å»ºæ–°çš„é…ç½®å¯¹è±¡

const TableList: React.FC = () => {
  const tables = Array.from({ length: 50 }, (_, i) => ({
    id: i,
    data: Array.from({ length: 10 }, (_, j) => ({ id: j, name: `Item ${j}` })),
  }));
  
  return (
    <div>
      {tables.map(table => (
        <Table
          key={table.id}
          // æ¯ä¸ªè¡¨æ ¼éƒ½åˆ›å»ºæ–°çš„é…ç½®å¯¹è±¡
          pagination={{
            pageSize: 10,
            showSizeChanger: true,
            showQuickJumper: true,
          }}
          scroll={{ y: 400 }}
          dataSource={table.data}
          columns={[
            { title: 'ID', dataIndex: 'id' },
            { title: 'åç§°', dataIndex: 'name' },
          ]}
        />
      ))}
    </div>
  );
};

// é—®é¢˜ï¼š
// 1. 50 ä¸ªè¡¨æ ¼ = 50 ä¸ªç›¸åŒçš„ pagination é…ç½®å¯¹è±¡
// 2. 50 ä¸ªç›¸åŒçš„ scroll é…ç½®å¯¹è±¡
// 3. 50 ä¸ªç›¸åŒçš„ columns é…ç½®å¯¹è±¡
// 4. å†…å­˜æµªè´¹ä¸¥é‡
```

**è¿™äº›ä»£ç æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ**

| é—®é¢˜ | æè¿° |
|------|------|
| ğŸ”´ **å†…å­˜æµªè´¹** | åˆ›å»ºå¤§é‡ç›¸åŒçš„å¯¹è±¡ï¼Œå ç”¨å¤§é‡å†…å­˜ |
| ğŸ”´ **æ€§èƒ½é—®é¢˜** | å¯¹è±¡åˆ›å»ºå’Œåƒåœ¾å›æ”¶å¼€é”€å¤§ |
| ğŸ”´ **æ¸²æŸ“æ…¢** | å¤§é‡å¯¹è±¡å¯¼è‡´æ¸²æŸ“æ€§èƒ½ä¸‹é™ |

---

### ğŸ’¡ æ¨¡å¼æ ¸å¿ƒæ¦‚å¿µ

äº«å…ƒæ¨¡å¼çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š

> **é€šè¿‡å…±äº«å¤§é‡ç»†ç²’åº¦çš„å¯¹è±¡æ¥å‡å°‘å†…å­˜ä½¿ç”¨ï¼Œæé«˜æ€§èƒ½ã€‚**

ç”¨å¤§ç™½è¯è¯´å°±æ˜¯ï¼š
- **äº«å…ƒï¼ˆFlyweightï¼‰**ï¼šå¯ä»¥è¢«å…±äº«çš„å¯¹è±¡ï¼ˆå†…éƒ¨çŠ¶æ€ï¼‰
- **å¤–éƒ¨çŠ¶æ€ï¼ˆExtrinsic Stateï¼‰**ï¼šä¸èƒ½å…±äº«çš„çŠ¶æ€ï¼Œç”±å®¢æˆ·ç«¯ä¼ å…¥
- **äº«å…ƒå·¥å‚ï¼ˆFlyweight Factoryï¼‰**ï¼šåˆ›å»ºå’Œç®¡ç†äº«å…ƒå¯¹è±¡

**äº«å…ƒæ¨¡å¼çš„ç»“æ„ï¼š**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Flyweight     â”‚  â† äº«å…ƒæ¥å£
â”‚  (äº«å…ƒæ¥å£)      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ + operation()   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â–²
         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ConcreteFlyweightâ”‚  â† å…·ä½“äº«å…ƒï¼ˆå¯å…±äº«ï¼‰
â”‚  (å…·ä½“äº«å…ƒ)      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ intrinsicState  â”‚  â† å†…éƒ¨çŠ¶æ€ï¼ˆå…±äº«ï¼‰
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â–²
         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚FlyweightFactory â”‚  â† äº«å…ƒå·¥å‚
â”‚  (äº«å…ƒå·¥å‚)      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ + getFlyweight()â”‚  â† è·å–æˆ–åˆ›å»ºäº«å…ƒ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ç±»æ¯”ç†è§£ï¼š**

```
æ²¡æœ‰äº«å…ƒï¼š1000 ä¸ªå­¦ç”Ÿï¼Œæ¯äººä¹°ä¸€æœ¬ã€ŠJS é«˜çº§ç¨‹åºè®¾è®¡ã€‹ â†’ æµªè´¹é’±
æœ‰äº«å…ƒï¼š1000 ä¸ªå­¦ç”Ÿï¼Œå…±äº« 10 æœ¬ã€ŠJS é«˜çº§ç¨‹åºè®¾è®¡ã€‹ â†’ èŠ‚çœèµ„æº
```

---

### ğŸ”§ å‰ç«¯å®æˆ˜æ¡ˆä¾‹ä¸€ï¼šå›¾æ ‡äº«å…ƒå·¥å‚

#### åœºæ™¯æè¿°

åˆ›å»ºå›¾æ ‡äº«å…ƒå·¥å‚ï¼Œå¤ç”¨ç›¸åŒçš„å›¾æ ‡å®ä¾‹ï¼Œå‡å°‘å†…å­˜å ç”¨ã€‚

```tsx
// flyweight/IconFlyweight.tsx

import React from 'react';
import {
  UserOutlined,
  EditOutlined,
  DeleteOutlined,
  SearchOutlined,
  PlusOutlined,
} from '@ant-design/icons';

/**
 * å›¾æ ‡ç±»å‹
 */
type IconType = 'user' | 'edit' | 'delete' | 'search' | 'plus';

/**
 * å›¾æ ‡äº«å…ƒæ¥å£
 */
interface IconFlyweight {
  render: (style?: React.CSSProperties) => React.ReactNode;
}

/**
 * å›¾æ ‡äº«å…ƒå®ç°
 */
class ConcreteIconFlyweight implements IconFlyweight {
  constructor(private iconComponent: React.ComponentType<any>) {}
  
  render(style?: React.CSSProperties): React.ReactNode {
    const IconComponent = this.iconComponent;
    return <IconComponent style={style} />;
  }
}

/**
 * å›¾æ ‡äº«å…ƒå·¥å‚
 * 
 * ç®¡ç†å›¾æ ‡å®ä¾‹ï¼Œç¡®ä¿ç›¸åŒç±»å‹çš„å›¾æ ‡åªåˆ›å»ºä¸€ä¸ªå®ä¾‹
 */
export class IconFlyweightFactory {
  private static icons: Map<IconType, IconFlyweight> = new Map();
  
  /**
   * è·å–å›¾æ ‡äº«å…ƒ
   */
  static getIcon(type: IconType): IconFlyweight {
    // å¦‚æœå·²å­˜åœ¨ï¼Œç›´æ¥è¿”å›
    if (this.icons.has(type)) {
      return this.icons.get(type)!;
    }
    
    // åˆ›å»ºæ–°çš„å›¾æ ‡äº«å…ƒ
    let iconComponent: React.ComponentType<any>;
    
    switch (type) {
      case 'user':
        iconComponent = UserOutlined;
        break;
      case 'edit':
        iconComponent = EditOutlined;
        break;
      case 'delete':
        iconComponent = DeleteOutlined;
        break;
      case 'search':
        iconComponent = SearchOutlined;
        break;
      case 'plus':
        iconComponent = PlusOutlined;
        break;
      default:
        throw new Error(`Unknown icon type: ${type}`);
    }
    
    const flyweight = new ConcreteIconFlyweight(iconComponent);
    this.icons.set(type, flyweight);
    
    return flyweight;
  }
  
  /**
   * æ¸…é™¤æ‰€æœ‰å›¾æ ‡ç¼“å­˜
   */
  static clear(): void {
    this.icons.clear();
  }
  
  /**
   * è·å–å·²ç¼“å­˜çš„å›¾æ ‡æ•°é‡
   */
  static getCacheSize(): number {
    return this.icons.size;
  }
}

/**
 * å›¾æ ‡ç»„ä»¶ï¼ˆä½¿ç”¨äº«å…ƒï¼‰
 */
export const FlyweightIcon: React.FC<{
  type: IconType;
  style?: React.CSSProperties;
}> = ({ type, style }) => {
  const icon = IconFlyweightFactory.getIcon(type);
  return <>{icon.render(style)}</>;
};
```

#### ä¸šåŠ¡ä¸­ä½¿ç”¨

```tsx
// components/UserList.tsx

import React from 'react';
import { FlyweightIcon } from '../flyweight/IconFlyweight';

export const UserList: React.FC = () => {
  const users = Array.from({ length: 1000 }, (_, i) => ({
    id: i,
    name: `User ${i}`,
  }));
  
  return (
    <div>
      {users.map(user => (
        <div key={user.id} style={{ display: 'flex', alignItems: 'center', gap: 8 }}>
          {/* âœ… ä½¿ç”¨äº«å…ƒå›¾æ ‡ï¼Œ1000 ä¸ªç”¨æˆ·å…±äº«åŒä¸€ä¸ªå›¾æ ‡å®ä¾‹ */}
          <FlyweightIcon type="user" style={{ color: '#1890ff' }} />
          {user.name}
        </div>
      ))}
    </div>
  );
};

// å†…å­˜å¯¹æ¯”ï¼š
// ä¸ä½¿ç”¨äº«å…ƒï¼š1000 ä¸ªå›¾æ ‡å®ä¾‹
// ä½¿ç”¨äº«å…ƒï¼š1 ä¸ªå›¾æ ‡å®ä¾‹ï¼ˆå…±äº«ï¼‰
```

---

### ğŸ”§ å‰ç«¯å®æˆ˜æ¡ˆä¾‹äºŒï¼šæ ·å¼å¯¹è±¡äº«å…ƒ

#### åœºæ™¯æè¿°

åˆ›å»ºæ ·å¼å¯¹è±¡äº«å…ƒå·¥å‚ï¼Œå¤ç”¨ç›¸åŒçš„æ ·å¼é…ç½®ï¼Œå‡å°‘å†…å­˜å ç”¨ã€‚

```tsx
// flyweight/StyleFlyweight.ts

/**
 * æ ·å¼ç±»å‹
 */
type StyleType = 'primary' | 'secondary' | 'danger' | 'success' | 'warning';

/**
 * æ ·å¼äº«å…ƒæ¥å£
 */
interface StyleFlyweight {
  getStyle(): React.CSSProperties;
}

/**
 * æ ·å¼äº«å…ƒå®ç°
 */
class ConcreteStyleFlyweight implements StyleFlyweight {
  constructor(private style: React.CSSProperties) {}
  
  getStyle(): React.CSSProperties {
    return { ...this.style };
  }
}

/**
 * æ ·å¼äº«å…ƒå·¥å‚
 */
export class StyleFlyweightFactory {
  private static styles: Map<StyleType, StyleFlyweight> = new Map();
  
  /**
   * è·å–æ ·å¼äº«å…ƒ
   */
  static getStyle(type: StyleType): StyleFlyweight {
    if (this.styles.has(type)) {
      return this.styles.get(type)!;
    }
    
    let style: React.CSSProperties;
    
    switch (type) {
      case 'primary':
        style = {
          padding: '8px 16px',
          backgroundColor: '#1890ff',
          color: '#fff',
          border: 'none',
          borderRadius: '6px',
          cursor: 'pointer',
        };
        break;
      case 'secondary':
        style = {
          padding: '8px 16px',
          backgroundColor: '#f0f0f0',
          color: '#333',
          border: '1px solid #d9d9d9',
          borderRadius: '6px',
          cursor: 'pointer',
        };
        break;
      case 'danger':
        style = {
          padding: '8px 16px',
          backgroundColor: '#ff4d4f',
          color: '#fff',
          border: 'none',
          borderRadius: '6px',
          cursor: 'pointer',
        };
        break;
      case 'success':
        style = {
          padding: '8px 16px',
          backgroundColor: '#52c41a',
          color: '#fff',
          border: 'none',
          borderRadius: '6px',
          cursor: 'pointer',
        };
        break;
      case 'warning':
        style = {
          padding: '8px 16px',
          backgroundColor: '#faad14',
          color: '#fff',
          border: 'none',
          borderRadius: '6px',
          cursor: 'pointer',
        };
        break;
      default:
        throw new Error(`Unknown style type: ${type}`);
    }
    
    const flyweight = new ConcreteStyleFlyweight(style);
    this.styles.set(type, flyweight);
    
    return flyweight;
  }
  
  /**
   * è·å–æ ·å¼ï¼ˆæ”¯æŒè¦†ç›–ï¼‰
   */
  static getStyleWithOverride(
    type: StyleType,
    overrides?: Partial<React.CSSProperties>
  ): React.CSSProperties {
    const baseStyle = this.getStyle(type).getStyle();
    return overrides ? { ...baseStyle, ...overrides } : baseStyle;
  }
  
  static clear(): void {
    this.styles.clear();
  }
}
```

#### ä¸šåŠ¡ä¸­ä½¿ç”¨

```tsx
// components/ButtonList.tsx

import React from 'react';
import { StyleFlyweightFactory } from '../flyweight/StyleFlyweight';

export const ButtonList: React.FC = () => {
  const buttons = Array.from({ length: 100 }, (_, i) => ({
    id: i,
    text: `Button ${i}`,
    type: (['primary', 'secondary', 'danger'] as const)[i % 3],
  }));
  
  return (
    <div>
      {buttons.map(button => (
        <button
          key={button.id}
          // âœ… ä½¿ç”¨äº«å…ƒæ ·å¼ï¼Œ100 ä¸ªæŒ‰é’®å…±äº«æ ·å¼å¯¹è±¡
          style={StyleFlyweightFactory.getStyle(button.type).getStyle()}
        >
          {button.text}
        </button>
      ))}
    </div>
  );
};

// å†…å­˜å¯¹æ¯”ï¼š
// ä¸ä½¿ç”¨äº«å…ƒï¼š100 ä¸ªæ ·å¼å¯¹è±¡
// ä½¿ç”¨äº«å…ƒï¼š3 ä¸ªæ ·å¼å¯¹è±¡ï¼ˆprimaryã€secondaryã€dangerï¼‰
```

---

### ğŸ”§ å‰ç«¯å®æˆ˜æ¡ˆä¾‹ä¸‰ï¼šè¡¨æ ¼é…ç½®äº«å…ƒ

#### åœºæ™¯æè¿°

åˆ›å»ºè¡¨æ ¼é…ç½®äº«å…ƒå·¥å‚ï¼Œå¤ç”¨ç›¸åŒçš„è¡¨æ ¼é…ç½®ï¼Œå‡å°‘å†…å­˜å ç”¨ã€‚

```tsx
// flyweight/TableConfigFlyweight.ts

import { TableProps } from 'antd/es/table';

/**
 * è¡¨æ ¼é…ç½®ç±»å‹
 */
type TableConfigType = 'default' | 'compact' | 'scrollable';

/**
 * è¡¨æ ¼é…ç½®äº«å…ƒæ¥å£
 */
interface TableConfigFlyweight {
  getConfig(): Partial<TableProps<any>>;
}

/**
 * è¡¨æ ¼é…ç½®äº«å…ƒå®ç°
 */
class ConcreteTableConfigFlyweight implements TableConfigFlyweight {
  constructor(private config: Partial<TableProps<any>>) {}
  
  getConfig(): Partial<TableProps<any>> {
    return { ...this.config };
  }
}

/**
 * è¡¨æ ¼é…ç½®äº«å…ƒå·¥å‚
 */
export class TableConfigFlyweightFactory {
  private static configs: Map<TableConfigType, TableConfigFlyweight> = new Map();
  
  /**
   * è·å–è¡¨æ ¼é…ç½®äº«å…ƒ
   */
  static getConfig(type: TableConfigType): TableConfigFlyweight {
    if (this.configs.has(type)) {
      return this.configs.get(type)!;
    }
    
    let config: Partial<TableProps<any>>;
    
    switch (type) {
      case 'default':
        config = {
          pagination: {
            pageSize: 10,
            showSizeChanger: true,
            showQuickJumper: true,
          },
          scroll: { y: 400 },
        };
        break;
      case 'compact':
        config = {
          pagination: {
            pageSize: 20,
            showSizeChanger: true,
            showQuickJumper: true,
          },
          scroll: { y: 600 },
          size: 'small',
        };
        break;
      case 'scrollable':
        config = {
          pagination: false,
          scroll: { x: 'max-content', y: 500 },
        };
        break;
      default:
        throw new Error(`Unknown table config type: ${type}`);
    }
    
    const flyweight = new ConcreteTableConfigFlyweight(config);
    this.configs.set(type, flyweight);
    
    return flyweight;
  }
  
  /**
   * è·å–é…ç½®ï¼ˆæ”¯æŒè¦†ç›–ï¼‰
   */
  static getConfigWithOverride(
    type: TableConfigType,
    overrides?: Partial<TableProps<any>>
  ): Partial<TableProps<any>> {
    const baseConfig = this.getConfig(type).getConfig();
    return overrides ? { ...baseConfig, ...overrides } : baseConfig;
  }
  
  static clear(): void {
    this.configs.clear();
  }
}
```

#### ä¸šåŠ¡ä¸­ä½¿ç”¨

```tsx
// components/TableList.tsx

import React from 'react';
import { Table } from 'antd';
import { TableConfigFlyweightFactory } from '../flyweight/TableConfigFlyweight';

export const TableList: React.FC = () => {
  const tables = Array.from({ length: 50 }, (_, i) => ({
    id: i,
    data: Array.from({ length: 10 }, (_, j) => ({ id: j, name: `Item ${j}` })),
    configType: (['default', 'compact', 'scrollable'] as const)[i % 3],
  }));
  
  return (
    <div>
      {tables.map(table => (
        <Table
          key={table.id}
          // âœ… ä½¿ç”¨äº«å…ƒé…ç½®ï¼Œ50 ä¸ªè¡¨æ ¼å…±äº«é…ç½®å¯¹è±¡
          {...TableConfigFlyweightFactory.getConfig(table.configType).getConfig()}
          dataSource={table.data}
          columns={[
            { title: 'ID', dataIndex: 'id' },
            { title: 'åç§°', dataIndex: 'name' },
          ]}
        />
      ))}
    </div>
  );
};

// å†…å­˜å¯¹æ¯”ï¼š
// ä¸ä½¿ç”¨äº«å…ƒï¼š50 ä¸ª pagination é…ç½® + 50 ä¸ª scroll é…ç½® = 100 ä¸ªå¯¹è±¡
// ä½¿ç”¨äº«å…ƒï¼š3 ä¸ªé…ç½®å¯¹è±¡ï¼ˆdefaultã€compactã€scrollableï¼‰
```

---

### ğŸ”§ å‰ç«¯å®æˆ˜æ¡ˆä¾‹å››ï¼šä¸»é¢˜é…ç½®äº«å…ƒ

#### åœºæ™¯æè¿°

åˆ›å»ºä¸»é¢˜é…ç½®äº«å…ƒå·¥å‚ï¼Œå¤ç”¨ç›¸åŒçš„ä¸»é¢˜é…ç½®ï¼Œå‡å°‘å†…å­˜å ç”¨ã€‚

```tsx
// flyweight/ThemeFlyweight.ts

/**
 * ä¸»é¢˜ç±»å‹
 */
type ThemeType = 'light' | 'dark' | 'blue' | 'green';

/**
 * ä¸»é¢˜é…ç½®
 */
interface ThemeConfig {
  primaryColor: string;
  backgroundColor: string;
  textColor: string;
  borderColor: string;
  borderRadius: string;
  fontSize: string;
  spacing: {
    small: string;
    medium: string;
    large: string;
  };
}

/**
 * ä¸»é¢˜äº«å…ƒæ¥å£
 */
interface ThemeFlyweight {
  getConfig(): ThemeConfig;
}

/**
 * ä¸»é¢˜äº«å…ƒå®ç°
 */
class ConcreteThemeFlyweight implements ThemeFlyweight {
  constructor(private config: ThemeConfig) {}
  
  getConfig(): ThemeConfig {
    return { ...this.config };
  }
}

/**
 * ä¸»é¢˜äº«å…ƒå·¥å‚
 */
export class ThemeFlyweightFactory {
  private static themes: Map<ThemeType, ThemeFlyweight> = new Map();
  
  /**
   * è·å–ä¸»é¢˜äº«å…ƒ
   */
  static getTheme(type: ThemeType): ThemeFlyweight {
    if (this.themes.has(type)) {
      return this.themes.get(type)!;
    }
    
    let config: ThemeConfig;
    
    switch (type) {
      case 'light':
        config = {
          primaryColor: '#1890ff',
          backgroundColor: '#ffffff',
          textColor: '#333333',
          borderColor: '#d9d9d9',
          borderRadius: '6px',
          fontSize: '14px',
          spacing: {
            small: '4px',
            medium: '8px',
            large: '16px',
          },
        };
        break;
      case 'dark':
        config = {
          primaryColor: '#177ddc',
          backgroundColor: '#141414',
          textColor: '#d9d9d9',
          borderColor: '#434343',
          borderRadius: '6px',
          fontSize: '14px',
          spacing: {
            small: '4px',
            medium: '8px',
            large: '16px',
          },
        };
        break;
      case 'blue':
        config = {
          primaryColor: '#1890ff',
          backgroundColor: '#e6f7ff',
          textColor: '#0050b3',
          borderColor: '#91d5ff',
          borderRadius: '6px',
          fontSize: '14px',
          spacing: {
            small: '4px',
            medium: '8px',
            large: '16px',
          },
        };
        break;
      case 'green':
        config = {
          primaryColor: '#52c41a',
          backgroundColor: '#f6ffed',
          textColor: '#389e0d',
          borderColor: '#b7eb8f',
          borderRadius: '6px',
          fontSize: '14px',
          spacing: {
            small: '4px',
            medium: '8px',
            large: '16px',
          },
        };
        break;
      default:
        throw new Error(`Unknown theme type: ${type}`);
    }
    
    const flyweight = new ConcreteThemeFlyweight(config);
    this.themes.set(type, flyweight);
    
    return flyweight;
  }
  
  /**
   * è·å–ä¸»é¢˜é…ç½®ï¼ˆæ”¯æŒè¦†ç›–ï¼‰
   */
  static getThemeWithOverride(
    type: ThemeType,
    overrides?: Partial<ThemeConfig>
  ): ThemeConfig {
    const baseConfig = this.getTheme(type).getConfig();
    return overrides ? { ...baseConfig, ...overrides } : baseConfig;
  }
  
  static clear(): void {
    this.themes.clear();
  }
}
```

#### ä¸šåŠ¡ä¸­ä½¿ç”¨

```tsx
// components/ThemedComponent.tsx

import React from 'react';
import { ThemeFlyweightFactory } from '../flyweight/ThemeFlyweight';

export const ThemedComponent: React.FC<{ theme: 'light' | 'dark' | 'blue' | 'green' }> = ({
  theme,
}) => {
  // âœ… ä½¿ç”¨äº«å…ƒä¸»é¢˜ï¼Œå¤šä¸ªç»„ä»¶å…±äº«åŒä¸€ä¸ªä¸»é¢˜é…ç½®
  const themeConfig = ThemeFlyweightFactory.getTheme(theme).getConfig();
  
  return (
    <div
      style={{
        backgroundColor: themeConfig.backgroundColor,
        color: themeConfig.textColor,
        padding: themeConfig.spacing.large,
        borderRadius: themeConfig.borderRadius,
        border: `1px solid ${themeConfig.borderColor}`,
      }}
    >
      <h2 style={{ color: themeConfig.primaryColor }}>æ ‡é¢˜</h2>
      <p>å†…å®¹</p>
    </div>
  );
};

// ä½¿ç”¨
const App: React.FC = () => {
  return (
    <div>
      {/* å¤šä¸ªç»„ä»¶å…±äº«åŒä¸€ä¸ªä¸»é¢˜é…ç½® */}
      <ThemedComponent theme="light" />
      <ThemedComponent theme="light" />
      <ThemedComponent theme="dark" />
    </div>
  );
};
```

---

### ğŸ”§ å‰ç«¯å®æˆ˜æ¡ˆä¾‹äº”ï¼šæ•°æ®å¯¹è±¡äº«å…ƒ

#### åœºæ™¯æè¿°

åˆ›å»ºæ•°æ®å¯¹è±¡äº«å…ƒå·¥å‚ï¼Œå¤ç”¨ç›¸åŒçš„æ•°æ®ç»“æ„ï¼Œå‡å°‘å†…å­˜å ç”¨ã€‚

```tsx
// flyweight/DataFlyweight.ts

/**
 * æ•°æ®ç±»å‹
 */
type DataType = 'empty' | 'loading' | 'error';

/**
 * æ•°æ®äº«å…ƒæ¥å£
 */
interface DataFlyweight {
  getData(): any;
}

/**
 * æ•°æ®äº«å…ƒå®ç°
 */
class ConcreteDataFlyweight implements DataFlyweight {
  constructor(private data: any) {}
  
  getData(): any {
    return this.data;
  }
}

/**
 * æ•°æ®äº«å…ƒå·¥å‚
 */
export class DataFlyweightFactory {
  private static data: Map<DataType, DataFlyweight> = new Map();
  
  /**
   * è·å–æ•°æ®äº«å…ƒ
   */
  static getData(type: DataType): DataFlyweight {
    if (this.data.has(type)) {
      return this.data.get(type)!;
    }
    
    let data: any;
    
    switch (type) {
      case 'empty':
        data = {
          list: [],
          total: 0,
          page: 1,
          pageSize: 10,
        };
        break;
      case 'loading':
        data = {
          list: [],
          total: 0,
          page: 1,
          pageSize: 10,
          loading: true,
        };
        break;
      case 'error':
        data = {
          list: [],
          total: 0,
          page: 1,
          pageSize: 10,
          error: null,
        };
        break;
      default:
        throw new Error(`Unknown data type: ${type}`);
    }
    
    const flyweight = new ConcreteDataFlyweight(data);
    this.data.set(type, flyweight);
    
    return flyweight;
  }
  
  static clear(): void {
    this.data.clear();
  }
}
```

#### ä¸šåŠ¡ä¸­ä½¿ç”¨

```tsx
// components/DataList.tsx

import React from 'react';
import { DataFlyweightFactory } from '../flyweight/DataFlyweight';

export const DataList: React.FC = () => {
  const lists = Array.from({ length: 100 }, (_, i) => ({
    id: i,
    state: (['empty', 'loading', 'error'] as const)[i % 3],
  }));
  
  return (
    <div>
      {lists.map(list => {
        // âœ… ä½¿ç”¨äº«å…ƒæ•°æ®ï¼Œ100 ä¸ªåˆ—è¡¨å…±äº«æ•°æ®å¯¹è±¡
        const data = DataFlyweightFactory.getData(list.state).getData();
        
        return (
          <div key={list.id}>
            {data.loading && <div>åŠ è½½ä¸­...</div>}
            {data.error && <div>é”™è¯¯</div>}
            {data.list.length === 0 && !data.loading && <div>ç©ºæ•°æ®</div>}
          </div>
        );
      })}
    </div>
  );
};
```

---

### ğŸ“Š æ¨¡å¼æ€»ç»“

#### âœ… ä¼˜ç‚¹

| ä¼˜ç‚¹ | è¯´æ˜ |
|------|------|
| **å‡å°‘å†…å­˜å ç”¨** | é€šè¿‡å…±äº«å¯¹è±¡ï¼Œå¤§å¹…å‡å°‘å†…å­˜ä½¿ç”¨ |
| **æé«˜æ€§èƒ½** | å‡å°‘å¯¹è±¡åˆ›å»ºå’Œåƒåœ¾å›æ”¶å¼€é”€ |
| **æé«˜æ¸²æŸ“æ€§èƒ½** | å‡å°‘å¯¹è±¡æ•°é‡ï¼Œæé«˜æ¸²æŸ“é€Ÿåº¦ |
| **æ˜“äºç®¡ç†** | é›†ä¸­ç®¡ç†å…±äº«å¯¹è±¡ |

#### âŒ ç¼ºç‚¹

| ç¼ºç‚¹ | è¯´æ˜ |
|------|------|
| **å¢åŠ å¤æ‚åº¦** | éœ€è¦åŒºåˆ†å†…éƒ¨çŠ¶æ€å’Œå¤–éƒ¨çŠ¶æ€ |
| **å¯èƒ½è¿‡åº¦ä¼˜åŒ–** | ç®€å•åœºæ™¯ä¸‹å¯èƒ½æ˜¾å¾—å¤šä½™ |
| **çº¿ç¨‹å®‰å…¨** | å¤šçº¿ç¨‹ç¯å¢ƒä¸‹éœ€è¦æ³¨æ„çº¿ç¨‹å®‰å…¨ï¼ˆå‰ç«¯è¾ƒå°‘é‡åˆ°ï¼‰ |

#### ğŸ¯ é€‚ç”¨åœºæ™¯

| åœºæ™¯ | ç¤ºä¾‹ |
|------|------|
| **å¤§é‡ç›¸ä¼¼å¯¹è±¡** | åˆ—è¡¨ä¸­çš„å›¾æ ‡ã€æŒ‰é’®ã€è¡¨æ ¼é…ç½® |
| **å†…å­˜æ•æ„Ÿ** | ç§»åŠ¨ç«¯ã€ä½é…ç½®è®¾å¤‡ |
| **æ€§èƒ½è¦æ±‚é«˜** | å¤§é‡æ•°æ®æ¸²æŸ“ã€å¤æ‚é¡µé¢ |
| **èµ„æºå¤ç”¨** | å›¾æ ‡ã€æ ·å¼ã€é…ç½®ç­‰å¯ä»¥å…±äº«çš„èµ„æº |

#### ğŸš« ä¸é€‚ç”¨åœºæ™¯

- å¯¹è±¡æ•°é‡å°‘ï¼Œä¸éœ€è¦ä¼˜åŒ–
- å¯¹è±¡å·®å¼‚å¤§ï¼Œæ— æ³•å…±äº«
- å¤–éƒ¨çŠ¶æ€å¤æ‚ï¼Œéš¾ä»¥åˆ†ç¦»

---

### ğŸ”„ ä¸å…¶ä»–æ¨¡å¼çš„åŒºåˆ«

| æ¨¡å¼ | å…³æ³¨ç‚¹ | åŒºåˆ« |
|------|--------|------|
| **äº«å…ƒæ¨¡å¼** | å¯¹è±¡å…±äº« | é€šè¿‡å…±äº«å‡å°‘å†…å­˜å ç”¨ |
| **å•ä¾‹æ¨¡å¼** | å”¯ä¸€å®ä¾‹ | ç¡®ä¿åªæœ‰ä¸€ä¸ªå®ä¾‹ |
| **åŸå‹æ¨¡å¼** | å¯¹è±¡å¤åˆ¶ | é€šè¿‡å¤åˆ¶åˆ›å»ºå¯¹è±¡ |
| **å¯¹è±¡æ± æ¨¡å¼** | å¯¹è±¡å¤ç”¨ | å¤ç”¨å·²åˆ›å»ºçš„å¯¹è±¡ |

---

### ğŸ¤” é€‰æ‹©å»ºè®®ï¼šä»€ä¹ˆæ—¶å€™ç”¨äº«å…ƒæ¨¡å¼ï¼Ÿ

é—®è‡ªå·±è¿™å‡ ä¸ªé—®é¢˜ï¼š

```
1. ä½ æ˜¯å¦éœ€è¦åˆ›å»ºå¤§é‡ç›¸ä¼¼çš„å¯¹è±¡ï¼Ÿ
   â†’ æ˜¯çš„è¯ï¼Œè€ƒè™‘äº«å…ƒæ¨¡å¼

2. è¿™äº›å¯¹è±¡æ˜¯å¦å¯ä»¥å…±äº«ï¼Ÿ
   â†’ æ˜¯çš„è¯ï¼Œè€ƒè™‘äº«å…ƒæ¨¡å¼

3. å†…å­˜å ç”¨æ˜¯å¦æ˜¯ä¸€ä¸ªé—®é¢˜ï¼Ÿ
   â†’ æ˜¯çš„è¯ï¼Œè€ƒè™‘äº«å…ƒæ¨¡å¼

4. ä½ æ˜¯å¦èƒ½åŒºåˆ†å†…éƒ¨çŠ¶æ€å’Œå¤–éƒ¨çŠ¶æ€ï¼Ÿ
   â†’ å¦‚æœèƒ½ï¼Œé€‚åˆç”¨äº«å…ƒæ¨¡å¼

5. å¯¹è±¡åˆ›å»ºå’Œåƒåœ¾å›æ”¶æ˜¯å¦å½±å“æ€§èƒ½ï¼Ÿ
   â†’ å¦‚æœæ˜¯ï¼Œè€ƒè™‘äº«å…ƒæ¨¡å¼
```

---

### ğŸ“ æ–‡ä»¶ç»“æ„å‚è€ƒ

```
src/
â”œâ”€â”€ flyweight/
â”‚   â”œâ”€â”€ IconFlyweight.tsx           # å›¾æ ‡äº«å…ƒ
â”‚   â”œâ”€â”€ StyleFlyweight.ts           # æ ·å¼äº«å…ƒ
â”‚   â”œâ”€â”€ TableConfigFlyweight.ts    # è¡¨æ ¼é…ç½®äº«å…ƒ
â”‚   â”œâ”€â”€ ThemeFlyweight.ts           # ä¸»é¢˜äº«å…ƒ
â”‚   â””â”€â”€ DataFlyweight.ts            # æ•°æ®äº«å…ƒ
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ UserList.tsx               # ä½¿ç”¨å›¾æ ‡äº«å…ƒ
â”‚   â”œâ”€â”€ ButtonList.tsx             # ä½¿ç”¨æ ·å¼äº«å…ƒ
â”‚   â”œâ”€â”€ TableList.tsx              # ä½¿ç”¨è¡¨æ ¼é…ç½®äº«å…ƒ
â”‚   â””â”€â”€ DataList.tsx               # ä½¿ç”¨æ•°æ®äº«å…ƒ
â””â”€â”€ App.tsx
```

---

> **ä¸‹ä¸€ç« é¢„å‘Šï¼šã€Šä»£ç†æ¨¡å¼ã€‹â€”â€” æ§åˆ¶è®¿é—®çš„"é—¨å«"**
> 
> æˆ‘ä»¬å°†è®²è§£å¦‚ä½•é€šè¿‡ä»£ç†æ¨¡å¼æ§åˆ¶å¯¹è±¡è®¿é—®ã€å®ç°ç¼“å­˜ä»£ç†ã€è™šæ‹Ÿä»£ç†ç­‰ã€‚

---

*å¦‚æœ‰ç–‘é—®æˆ–å»ºè®®ï¼Œæ¬¢è¿äº¤æµï¼*

