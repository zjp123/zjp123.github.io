# ã€Šå‰ç«¯è®¾è®¡æ¨¡å¼å®æˆ˜æ‰‹å†Œã€‹

## ç¬¬å…­ç« ï¼šé€‚é…å™¨æ¨¡å¼ï¼ˆAdapter Patternï¼‰

---

### ğŸ¯ ä¸€å¥è¯å¤§ç™½è¯

> **é€‚é…å™¨æ¨¡å¼å°±åƒæ‰‹æœºè½¬æ¥å¤´ï¼šä½ çš„æ‰‹æœºæ˜¯ Type-C æ¥å£ï¼Œä½†å……ç”µçº¿æ˜¯ USB-A æ¥å£ï¼Œæ€ä¹ˆåŠï¼Ÿç”¨è½¬æ¥å¤´ï¼è½¬æ¥å¤´å°±æ˜¯"é€‚é…å™¨"ï¼Œå®ƒè®©ä¸¤ä¸ªä¸å…¼å®¹çš„æ¥å£èƒ½å¤Ÿè¿æ¥åœ¨ä¸€èµ·ã€‚**

**æ ¸å¿ƒç†å¿µï¼šå°†ä¸€ä¸ªç±»çš„æ¥å£è½¬æ¢æˆå®¢æˆ·å¸Œæœ›çš„å¦ä¸€ä¸ªæ¥å£ï¼Œä½¿å¾—åŸæœ¬ä¸å…¼å®¹çš„ç±»å¯ä»¥ä¸€èµ·å·¥ä½œã€‚**

---

### ğŸ¤” ä»€ä¹ˆæ—¶å€™éœ€è¦"é€‚é…"ï¼Ÿ

åœ¨å‰ç«¯å¼€å‘ä¸­ï¼Œç»å¸¸ä¼šé‡åˆ°æ¥å£ä¸åŒ¹é…çš„æƒ…å†µï¼š

| åœºæ™¯ | ä¸ºä»€ä¹ˆéœ€è¦é€‚é…å™¨ |
|------|----------------|
| **ç¬¬ä¸‰æ–¹åº“æ¥å£** | ç¬¬ä¸‰æ–¹åº“çš„ API å’Œé¡¹ç›®éœ€æ±‚ä¸ä¸€è‡´ |
| **API æ•°æ®æ ¼å¼** | åç«¯è¿”å›çš„æ•°æ®æ ¼å¼å’Œå‰ç«¯éœ€è¦çš„ä¸ä¸€æ · |
| **æ–°æ—§ç³»ç»Ÿå…¼å®¹** | æ–°ä»£ç éœ€è¦è°ƒç”¨æ—§æ¥å£ï¼Œä½†æ¥å£æ ¼å¼ä¸åŒ |
| **ç»„ä»¶ props** | ç»„ä»¶æœŸæœ›çš„ props æ ¼å¼å’Œå®é™…æ•°æ®æ ¼å¼ä¸åŒ |
| **æ•°æ®æ ¼å¼ç»Ÿä¸€** | å¤šä¸ªæ•°æ®æºæ ¼å¼ä¸åŒï¼Œéœ€è¦ç»Ÿä¸€å¤„ç† |
| **äº‹ä»¶å¤„ç†** | ä¸åŒåº“çš„äº‹ä»¶å¯¹è±¡æ ¼å¼ä¸åŒ |

---

### ğŸ˜« å‰ç«¯ç—›ç‚¹ï¼šæ²¡æœ‰é€‚é…å™¨æ—¶çš„å™©æ¢¦

#### åœºæ™¯ä¸€ï¼šç¬¬ä¸‰æ–¹åº“æ¥å£ä¸åŒ¹é…

```tsx
// âŒ å™©æ¢¦ä»£ç ï¼šç¬¬ä¸‰æ–¹åº“çš„ API å’Œé¡¹ç›®éœ€æ±‚ä¸ä¸€è‡´

// é¡¹ç›®ä¸­ä½¿ç”¨çš„æ˜¯ antd çš„ Tableï¼Œä½†åç«¯è¿”å›çš„æ•°æ®æ ¼å¼æ˜¯ï¼š
const backendData = {
  items: [
    { id: 1, userName: 'å¼ ä¸‰', userEmail: 'zhang@example.com' },
    { id: 2, userName: 'æå››', userEmail: 'li@example.com' },
  ],
  totalCount: 2,
};

// antd Table éœ€è¦çš„æ•°æ®æ ¼å¼æ˜¯ï¼š
// { dataSource: [...], total: number }

// æ¯æ¬¡ä½¿ç”¨éƒ½è¦æ‰‹åŠ¨è½¬æ¢
const tableData = {
  dataSource: backendData.items.map(item => ({
    key: item.id,
    name: item.userName,      // å­—æ®µåä¸ä¸€è‡´
    email: item.userEmail,     // å­—æ®µåä¸ä¸€è‡´
  })),
  total: backendData.totalCount,
};

// é—®é¢˜ï¼š
// 1. æ¯æ¬¡éƒ½è¦å†™è½¬æ¢ä»£ç ï¼Œé‡å¤ä¸”å®¹æ˜“å‡ºé”™
// 2. å­—æ®µæ˜ å°„å…³ç³»æ•£è½åœ¨å„å¤„
// 3. å¦‚æœåç«¯æ”¹äº†å­—æ®µåï¼Œè¦æ”¹ N ä¸ªåœ°æ–¹
```

#### åœºæ™¯äºŒï¼šAPI æ•°æ®æ ¼å¼ä¸ä¸€è‡´

```tsx
// âŒ å™©æ¢¦ä»£ç ï¼šä¸åŒ API è¿”å›æ ¼å¼ä¸åŒ

// API 1 è¿”å›æ ¼å¼
const api1Response = {
  code: 200,
  message: 'success',
  data: {
    list: [...],
    total: 100,
  },
};

// API 2 è¿”å›æ ¼å¼
const api2Response = {
  status: 'ok',
  result: {
    items: [...],
    count: 50,
  },
};

// API 3 è¿”å›æ ¼å¼
const api3Response = {
  success: true,
  payload: [...],
  meta: {
    total: 30,
  },
};

// æ¯ä¸ª API éƒ½è¦å•ç‹¬å¤„ç†
const handleApi1 = (response) => {
  if (response.code === 200) {
    return {
      success: true,
      data: response.data.list,
      total: response.data.total,
    };
  }
};

const handleApi2 = (response) => {
  if (response.status === 'ok') {
    return {
      success: true,
      data: response.result.items,
      total: response.result.count,
    };
  }
};

// é—®é¢˜ï¼š
// 1. ä»£ç é‡å¤ï¼Œæ¯ä¸ª API éƒ½è¦å†™ä¸€éè½¬æ¢é€»è¾‘
// 2. æ ¼å¼ä¸ç»Ÿä¸€ï¼Œè°ƒç”¨æ–¹éœ€è¦çŸ¥é“æ¯ä¸ª API çš„æ ¼å¼
// 3. éš¾ä»¥ç»´æŠ¤ï¼Œæ”¹ä¸€ä¸ª API æ ¼å¼å½±å“å¤šå¤„
```

#### åœºæ™¯ä¸‰ï¼šç»„ä»¶ props ä¸åŒ¹é…

```tsx
// âŒ å™©æ¢¦ä»£ç ï¼šç»„ä»¶æœŸæœ›çš„ props å’Œå®é™…æ•°æ®æ ¼å¼ä¸åŒ

// åç«¯è¿”å›çš„ç”¨æˆ·æ•°æ®
const userData = {
  userId: '123',
  fullName: 'å¼ ä¸‰',
  emailAddress: 'zhang@example.com',
  phoneNumber: '13800138000',
};

// ç»„ä»¶æœŸæœ›çš„ props
interface UserCardProps {
  id: string;
  name: string;
  email: string;
  phone: string;
}

// æ¯æ¬¡ä½¿ç”¨éƒ½è¦æ‰‹åŠ¨è½¬æ¢
<UserCard
  id={userData.userId}
  name={userData.fullName}
  email={userData.emailAddress}
  phone={userData.phoneNumber}
/>

// é—®é¢˜ï¼š
// 1. å­—æ®µæ˜ å°„å…³ç³»æ•£è½åœ¨ç»„ä»¶ä½¿ç”¨å¤„
// 2. å¦‚æœåç«¯æ”¹äº†å­—æ®µåï¼Œè¦æ”¹å¾ˆå¤šåœ°æ–¹
// 3. å®¹æ˜“å†™é”™å­—æ®µå
```

**è¿™äº›ä»£ç æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ**

| é—®é¢˜ | æè¿° |
|------|------|
| ğŸ”´ **ä»£ç é‡å¤** | ç›¸åŒçš„è½¬æ¢é€»è¾‘å†™ N é |
| ğŸ”´ **è€¦åˆä¸¥é‡** | ä¸šåŠ¡ä»£ç ç›´æ¥ä¾èµ–å¤–éƒ¨æ¥å£æ ¼å¼ |
| ğŸ”´ **éš¾ä»¥ç»´æŠ¤** | æ¥å£æ ¼å¼å˜åŒ–æ—¶ï¼Œè¦æ”¹å¾ˆå¤šåœ°æ–¹ |
| ğŸ”´ **å®¹æ˜“å‡ºé”™** | æ‰‹åŠ¨è½¬æ¢å®¹æ˜“å†™é”™å­—æ®µå |

---

### ğŸ’¡ æ¨¡å¼æ ¸å¿ƒæ¦‚å¿µ

é€‚é…å™¨æ¨¡å¼çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š

> **å°†ä¸€ä¸ªç±»çš„æ¥å£è½¬æ¢æˆå®¢æˆ·å¸Œæœ›çš„å¦ä¸€ä¸ªæ¥å£ï¼Œä½¿å¾—åŸæœ¬ä¸å…¼å®¹çš„ç±»å¯ä»¥ä¸€èµ·å·¥ä½œã€‚**

ç”¨å¤§ç™½è¯è¯´å°±æ˜¯ï¼š
- æœ‰ä¸€ä¸ª"ä¸å…¼å®¹"çš„æ¥å£ A
- æœ‰ä¸€ä¸ª"æœŸæœ›"çš„æ¥å£ B
- åˆ›å»ºä¸€ä¸ªé€‚é…å™¨ï¼ŒæŠŠ A è½¬æ¢æˆ B
- ä½¿ç”¨æ–¹åªéœ€è¦çŸ¥é“æ¥å£ Bï¼Œä¸éœ€è¦å…³å¿ƒ A

**é€‚é…å™¨æ¨¡å¼çš„ä¸‰ä¸ªè§’è‰²ï¼š**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Client    â”‚      â”‚   Adapter   â”‚      â”‚  Adaptee    â”‚
â”‚  (å®¢æˆ·ç«¯)    â”‚ â”€â”€â”€â†’ â”‚  (é€‚é…å™¨)    â”‚ â”€â”€â”€â†’ â”‚  (è¢«é€‚é…è€…)  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æœŸæœ›æ¥å£ B   â”‚      â”‚ å®ç°æ¥å£ B   â”‚      â”‚ å®é™…æ¥å£ A   â”‚
â”‚             â”‚      â”‚ å†…éƒ¨è°ƒç”¨ A   â”‚      â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ç±»æ¯”ç†è§£ï¼š**

```
æ²¡æœ‰é€‚é…å™¨ï¼šä½ ç›´æ¥æ‹¿ç€ USB-A çº¿å¾€ Type-C æ‰‹æœºä¸Šæ’ â†’ æ’ä¸è¿›å»
æœ‰é€‚é…å™¨ï¼šUSB-A çº¿ â†’ è½¬æ¥å¤´ â†’ Type-C æ‰‹æœº â†’ å®Œç¾è¿æ¥
```

---

### ğŸ”§ å‰ç«¯å®æˆ˜æ¡ˆä¾‹ä¸€ï¼šAPI å“åº”æ ¼å¼é€‚é…å™¨

#### åœºæ™¯æè¿°

ç»Ÿä¸€ä¸åŒ API çš„å“åº”æ ¼å¼ï¼Œè®©è°ƒç”¨æ–¹ä½¿ç”¨ç»Ÿä¸€çš„æ¥å£ã€‚

```tsx
// adapters/ApiResponseAdapter.ts

/**
 * API å“åº”é€‚é…å™¨
 * 
 * å°†ä¸åŒæ ¼å¼çš„ API å“åº”ç»Ÿä¸€è½¬æ¢ä¸ºæ ‡å‡†æ ¼å¼
 */
export interface StandardApiResponse<T = any> {
  success: boolean;
  data: T;
  message?: string;
  code?: number;
  total?: number;
}

/**
 * API 1 å“åº”æ ¼å¼
 */
interface Api1Response<T> {
  code: number;
  message: string;
  data: {
    list: T[];
    total: number;
  };
}

/**
 * API 2 å“åº”æ ¼å¼
 */
interface Api2Response<T> {
  status: string;
  result: {
    items: T[];
    count: number;
  };
}

/**
 * API 3 å“åº”æ ¼å¼
 */
interface Api3Response<T> {
  success: boolean;
  payload: T[];
  meta: {
    total: number;
  };
}

/**
 * API 1 é€‚é…å™¨
 */
export class Api1Adapter {
  static adapt<T>(response: Api1Response<T>): StandardApiResponse<T[]> {
    return {
      success: response.code === 200,
      data: response.data.list,
      message: response.message,
      code: response.code,
      total: response.data.total,
    };
  }
}

/**
 * API 2 é€‚é…å™¨
 */
export class Api2Adapter {
  static adapt<T>(response: Api2Response<T>): StandardApiResponse<T[]> {
    return {
      success: response.status === 'ok',
      data: response.result.items,
      total: response.result.count,
    };
  }
}

/**
 * API 3 é€‚é…å™¨
 */
export class Api3Adapter {
  static adapt<T>(response: Api3Response<T>): StandardApiResponse<T[]> {
    return {
      success: response.success,
      data: response.payload,
      total: response.meta.total,
    };
  }
}

/**
 * ç»Ÿä¸€é€‚é…å™¨å·¥å‚
 */
export class ApiResponseAdapterFactory {
  static adapt<T>(
    response: Api1Response<T> | Api2Response<T> | Api3Response<T>,
    apiType: 'api1' | 'api2' | 'api3'
  ): StandardApiResponse<T[]> {
    switch (apiType) {
      case 'api1':
        return Api1Adapter.adapt(response as Api1Response<T>);
      case 'api2':
        return Api2Adapter.adapt(response as Api2Response<T>);
      case 'api3':
        return Api3Adapter.adapt(response as Api3Response<T>);
      default:
        throw new Error(`Unknown API type: ${apiType}`);
    }
  }
}
```

#### åœ¨è¯·æ±‚æ‹¦æˆªå™¨ä¸­ä½¿ç”¨

```tsx
// services/request.ts

import axios, { AxiosResponse } from 'axios';
import { ApiResponseAdapterFactory, StandardApiResponse } from '../adapters/ApiResponseAdapter';

const request = axios.create({
  baseURL: '/api',
});

// å“åº”æ‹¦æˆªå™¨ï¼šç»Ÿä¸€é€‚é…ä¸åŒ API çš„å“åº”æ ¼å¼
request.interceptors.response.use(
  (response: AxiosResponse) => {
    const { config } = response;
    
    // æ ¹æ® URL åˆ¤æ–­æ˜¯å“ªä¸ª API
    const apiType = getApiType(config.url || '');
    
    // ä½¿ç”¨é€‚é…å™¨ç»Ÿä¸€è½¬æ¢
    const adaptedResponse = ApiResponseAdapterFactory.adapt(
      response.data,
      apiType
    );
    
    // è¿”å›æ ‡å‡†æ ¼å¼
    return {
      ...response,
      data: adaptedResponse,
    };
  },
  (error) => {
    // é”™è¯¯å“åº”ä¹Ÿç»Ÿä¸€æ ¼å¼
    return Promise.reject({
      success: false,
      message: error.message || 'è¯·æ±‚å¤±è´¥',
      data: null,
    });
  }
);

function getApiType(url: string): 'api1' | 'api2' | 'api3' {
  if (url.includes('/v1/')) return 'api1';
  if (url.includes('/v2/')) return 'api2';
  return 'api3';
}

export default request;
```

#### ä¸šåŠ¡ä¸­ä½¿ç”¨

```tsx
// services/userService.ts

import request from './request';
import { StandardApiResponse } from '../adapters/ApiResponseAdapter';

interface User {
  id: string;
  name: string;
  email: string;
}

/**
 * è·å–ç”¨æˆ·åˆ—è¡¨
 * 
 * è°ƒç”¨æ–¹ä¸éœ€è¦å…³å¿ƒåç«¯è¿”å›çš„æ˜¯ä»€ä¹ˆæ ¼å¼
 * ç»Ÿä¸€ä½¿ç”¨ StandardApiResponse æ ¼å¼
 */
export const getUserList = async (params: {
  page: number;
  size: number;
}): Promise<StandardApiResponse<User[]>> => {
  // å“åº”å·²ç»è¢«æ‹¦æˆªå™¨é€‚é…è¿‡äº†ï¼Œç›´æ¥ä½¿ç”¨
  const response = await request.get('/v1/users', { params });
  return response.data;  // å·²ç»æ˜¯ StandardApiResponse æ ¼å¼
};

// ç»„ä»¶ä¸­ä½¿ç”¨
const UserList: React.FC = () => {
  const [users, setUsers] = useState<User[]>([]);
  const [total, setTotal] = useState(0);
  
  useEffect(() => {
    getUserList({ page: 1, size: 10 }).then((response) => {
      // ç»Ÿä¸€æ ¼å¼ï¼Œä½¿ç”¨èµ·æ¥å¾ˆç®€å•
      if (response.success) {
        setUsers(response.data);
        setTotal(response.total || 0);
      } else {
        message.error(response.message);
      }
    });
  }, []);
  
  return (
    <Table
      dataSource={users}
      pagination={{ total }}
    />
  );
};
```

---

### ğŸ”§ å‰ç«¯å®æˆ˜æ¡ˆä¾‹äºŒï¼šAnt Design Table æ•°æ®é€‚é…å™¨

#### åœºæ™¯æè¿°

é€‚é…åç«¯è¿”å›çš„æ•°æ®æ ¼å¼ï¼Œè½¬æ¢ä¸º Ant Design Table éœ€è¦çš„æ ¼å¼ã€‚

```tsx
// adapters/TableDataAdapter.ts

import { TableProps } from 'antd/es/table';

/**
 * åç«¯è¿”å›çš„æ•°æ®æ ¼å¼
 */
interface BackendTableData<T> {
  items: T[];
  totalCount: number;
  pageIndex: number;
  pageSize: number;
}

/**
 * Ant Design Table éœ€è¦çš„æ•°æ®æ ¼å¼
 */
interface AntdTableData<T> {
  dataSource: T[];
  total: number;
  current: number;
  pageSize: number;
}

/**
 * Table æ•°æ®é€‚é…å™¨
 */
export class TableDataAdapter {
  /**
   * å°†åç«¯æ•°æ®æ ¼å¼è½¬æ¢ä¸º Ant Design Table æ ¼å¼
   */
  static adapt<T>(
    backendData: BackendTableData<T>,
    fieldMapping?: {
      id?: string;           // åç«¯ ID å­—æ®µå
      name?: string;          // åç«¯ name å­—æ®µå
      email?: string;        // åç«¯ email å­—æ®µå
      [key: string]: string | undefined;
    }
  ): AntdTableData<T> {
    let dataSource = backendData.items;
    
    // å¦‚æœæä¾›äº†å­—æ®µæ˜ å°„ï¼Œè¿›è¡Œè½¬æ¢
    if (fieldMapping) {
      dataSource = backendData.items.map((item: any) => {
        const adapted: any = { ...item };
        
        // æ·»åŠ  keyï¼ˆTable å¿…éœ€ï¼‰
        if (fieldMapping.id) {
          adapted.key = item[fieldMapping.id];
        }
        
        // å­—æ®µåæ˜ å°„
        if (fieldMapping.name && item[fieldMapping.name]) {
          adapted.name = item[fieldMapping.name];
        }
        
        if (fieldMapping.email && item[fieldMapping.email]) {
          adapted.email = item[fieldMapping.email];
        }
        
        return adapted;
      }) as T[];
    } else {
      // æ²¡æœ‰æ˜ å°„æ—¶ï¼Œç¡®ä¿æœ‰ key
      dataSource = backendData.items.map((item: any, index) => ({
        ...item,
        key: item.id || item.key || index,
      })) as T[];
    }
    
    return {
      dataSource,
      total: backendData.totalCount,
      current: backendData.pageIndex,
      pageSize: backendData.pageSize,
    };
  }
  
  /**
   * å°† Ant Design Table çš„åˆ†é¡µå‚æ•°è½¬æ¢ä¸ºåç«¯éœ€è¦çš„æ ¼å¼
   */
  static adaptPagination(
    pagination: TableProps<any>['pagination']
  ): { pageIndex: number; pageSize: number } {
    if (typeof pagination === 'object' && pagination !== null) {
      return {
        pageIndex: pagination.current || 1,
        pageSize: pagination.pageSize || 10,
      };
    }
    
    return {
      pageIndex: 1,
      pageSize: 10,
    };
  }
}
```

#### ä¸šåŠ¡ä¸­ä½¿ç”¨

```tsx
// components/UserTable.tsx

import React, { useState, useEffect } from 'react';
import { Table, message } from 'antd';
import { TableDataAdapter } from '../adapters/TableDataAdapter';
import { getUserList } from '../services/userService';

interface User {
  key: string;
  id: string;
  name: string;
  email: string;
}

export const UserTable: React.FC = () => {
  const [tableData, setTableData] = useState<{
    dataSource: User[];
    total: number;
    current: number;
    pageSize: number;
  }>({
    dataSource: [],
    total: 0,
    current: 1,
    pageSize: 10,
  });
  
  const [loading, setLoading] = useState(false);
  
  const fetchData = async (page: number, size: number) => {
    setLoading(true);
    try {
      // åç«¯è¿”å›çš„æ•°æ®æ ¼å¼
      const backendData = await getUserList({
        pageIndex: page,
        pageSize: size,
      });
      
      // âœ… ä½¿ç”¨é€‚é…å™¨è½¬æ¢
      const adaptedData = TableDataAdapter.adapt(backendData, {
        id: 'userId',        // åç«¯å­—æ®µåæ˜¯ userId
        name: 'userName',     // åç«¯å­—æ®µåæ˜¯ userName
        email: 'userEmail',   // åç«¯å­—æ®µåæ˜¯ userEmail
      });
      
      setTableData(adaptedData);
    } catch (error) {
      message.error('åŠ è½½å¤±è´¥');
    } finally {
      setLoading(false);
    }
  };
  
  useEffect(() => {
    fetchData(1, 10);
  }, []);
  
  const handleTableChange = (pagination: any) => {
    // å°† Table çš„åˆ†é¡µå‚æ•°è½¬æ¢ä¸ºåç«¯æ ¼å¼
    const backendParams = TableDataAdapter.adaptPagination(pagination);
    fetchData(backendParams.pageIndex, backendParams.pageSize);
  };
  
  return (
    <Table
      columns={[
        { title: 'ID', dataIndex: 'id' },
        { title: 'å§“å', dataIndex: 'name' },
        { title: 'é‚®ç®±', dataIndex: 'email' },
      ]}
      dataSource={tableData.dataSource}
      loading={loading}
      pagination={{
        current: tableData.current,
        pageSize: tableData.pageSize,
        total: tableData.total,
      }}
      onChange={handleTableChange}
    />
  );
};
```

---

### ğŸ”§ å‰ç«¯å®æˆ˜æ¡ˆä¾‹ä¸‰ï¼šç»„ä»¶ Props é€‚é…å™¨

#### åœºæ™¯æè¿°

é€‚é…åç«¯æ•°æ®æ ¼å¼ï¼Œè½¬æ¢ä¸ºç»„ä»¶éœ€è¦çš„ props æ ¼å¼ã€‚

```tsx
// adapters/UserCardAdapter.ts

/**
 * åç«¯è¿”å›çš„ç”¨æˆ·æ•°æ®æ ¼å¼
 */
interface BackendUserData {
  userId: string;
  fullName: string;
  emailAddress: string;
  phoneNumber: string;
  avatarUrl?: string;
  createdAt: string;
}

/**
 * UserCard ç»„ä»¶æœŸæœ›çš„ props æ ¼å¼
 */
export interface UserCardProps {
  id: string;
  name: string;
  email: string;
  phone: string;
  avatar?: string;
  createdAt: Date;
}

/**
 * UserCard Props é€‚é…å™¨
 */
export class UserCardAdapter {
  /**
   * å°†åç«¯æ•°æ®è½¬æ¢ä¸ºç»„ä»¶ props
   */
  static adapt(backendData: BackendUserData): UserCardProps {
    return {
      id: backendData.userId,
      name: backendData.fullName,
      email: backendData.emailAddress,
      phone: backendData.phoneNumber,
      avatar: backendData.avatarUrl,
      createdAt: new Date(backendData.createdAt),
    };
  }
  
  /**
   * æ‰¹é‡é€‚é…
   */
  static adaptBatch(backendDataList: BackendUserData[]): UserCardProps[] {
    return backendDataList.map(data => UserCardAdapter.adapt(data));
  }
}
```

#### ç»„ä»¶å®šä¹‰

```tsx
// components/UserCard.tsx

import React from 'react';
import { Card, Avatar } from 'antd';
import { UserCardProps } from '../adapters/UserCardAdapter';

export const UserCard: React.FC<UserCardProps> = ({
  id,
  name,
  email,
  phone,
  avatar,
  createdAt,
}) => {
  return (
    <Card>
      <Avatar src={avatar}>{name[0]}</Avatar>
      <div>
        <h3>{name}</h3>
        <p>é‚®ç®±ï¼š{email}</p>
        <p>ç”µè¯ï¼š{phone}</p>
        <p>æ³¨å†Œæ—¶é—´ï¼š{createdAt.toLocaleDateString()}</p>
      </div>
    </Card>
  );
};
```

#### ä¸šåŠ¡ä¸­ä½¿ç”¨

```tsx
// pages/UserList.tsx

import React, { useEffect, useState } from 'react';
import { UserCard } from '../components/UserCard';
import { UserCardAdapter, UserCardProps } from '../adapters/UserCardAdapter';
import { getUserList } from '../services/userService';

export const UserListPage: React.FC = () => {
  const [users, setUsers] = useState<UserCardProps[]>([]);
  
  useEffect(() => {
    getUserList().then((backendData) => {
      // âœ… ä½¿ç”¨é€‚é…å™¨è½¬æ¢
      const adaptedUsers = UserCardAdapter.adaptBatch(backendData.items);
      setUsers(adaptedUsers);
    });
  }, []);
  
  return (
    <div>
      {users.map((user) => (
        // âœ… ç»„ä»¶æ¥æ”¶çš„æ˜¯ç»Ÿä¸€æ ¼å¼ï¼Œä¸éœ€è¦æ‰‹åŠ¨è½¬æ¢
        <UserCard key={user.id} {...user} />
      ))}
    </div>
  );
};
```

---

### ğŸ”§ å‰ç«¯å®æˆ˜æ¡ˆä¾‹å››ï¼šç¬¬ä¸‰æ–¹åº“æ¥å£é€‚é…å™¨

#### åœºæ™¯æè¿°

é€‚é…ç¬¬ä¸‰æ–¹åº“çš„æ¥å£ï¼Œä½¿å…¶ç¬¦åˆé¡¹ç›®çš„ä½¿ç”¨ä¹ æƒ¯ã€‚

```tsx
// adapters/ChartAdapter.ts

import * as echarts from 'echarts';
import type { EChartsOption } from 'echarts';

/**
 * é¡¹ç›®å†…éƒ¨ä½¿ç”¨çš„å›¾è¡¨é…ç½®æ ¼å¼
 */
export interface ChartConfig {
  type: 'line' | 'bar' | 'pie';
  title: string;
  data: {
    labels: string[];
    datasets: Array<{
      label: string;
      data: number[];
      color?: string;
    }>;
  };
  options?: {
    showLegend?: boolean;
    showTooltip?: boolean;
  };
}

/**
 * ECharts é€‚é…å™¨
 * 
 * å°†é¡¹ç›®å†…éƒ¨çš„å›¾è¡¨é…ç½®æ ¼å¼è½¬æ¢ä¸º ECharts æ ¼å¼
 */
export class ChartAdapter {
  /**
   * å°†é¡¹ç›®é…ç½®è½¬æ¢ä¸º ECharts é…ç½®
   */
  static adapt(config: ChartConfig): EChartsOption {
    const baseOption: EChartsOption = {
      title: {
        text: config.title,
      },
      tooltip: {
        show: config.options?.showTooltip !== false,
      },
      legend: {
        show: config.options?.showLegend !== false,
        data: config.data.datasets.map(d => d.label),
      },
    };
    
    switch (config.type) {
      case 'line':
        return {
          ...baseOption,
          xAxis: {
            type: 'category',
            data: config.data.labels,
          },
          yAxis: {
            type: 'value',
          },
          series: config.data.datasets.map(dataset => ({
            name: dataset.label,
            type: 'line',
            data: dataset.data,
            itemStyle: {
              color: dataset.color,
            },
          })),
        };
        
      case 'bar':
        return {
          ...baseOption,
          xAxis: {
            type: 'category',
            data: config.data.labels,
          },
          yAxis: {
            type: 'value',
          },
          series: config.data.datasets.map(dataset => ({
            name: dataset.label,
            type: 'bar',
            data: dataset.data,
            itemStyle: {
              color: dataset.color,
            },
          })),
        };
        
      case 'pie':
        return {
          ...baseOption,
          series: [
            {
              name: config.title,
              type: 'pie',
              radius: '50%',
              data: config.data.labels.map((label, index) => ({
                name: label,
                value: config.data.datasets[0].data[index],
              })),
            },
          ],
        };
        
      default:
        throw new Error(`Unsupported chart type: ${config.type}`);
    }
  }
}
```

#### ä¸šåŠ¡ä¸­ä½¿ç”¨

```tsx
// components/SalesChart.tsx

import React, { useEffect, useRef } from 'react';
import * as echarts from 'echarts';
import { ChartAdapter, ChartConfig } from '../adapters/ChartAdapter';

export const SalesChart: React.FC = () => {
  const chartRef = useRef<HTMLDivElement>(null);
  const chartInstance = useRef<echarts.ECharts | null>(null);
  
  useEffect(() => {
    if (!chartRef.current) return;
    
    // åˆå§‹åŒ–å›¾è¡¨
    chartInstance.current = echarts.init(chartRef.current);
    
    // é¡¹ç›®å†…éƒ¨çš„é…ç½®æ ¼å¼ï¼ˆç»Ÿä¸€ã€æ˜“ç”¨ï¼‰
    const config: ChartConfig = {
      type: 'line',
      title: 'é”€å”®é¢è¶‹åŠ¿',
      data: {
        labels: ['1æœˆ', '2æœˆ', '3æœˆ', '4æœˆ', '5æœˆ', '6æœˆ'],
        datasets: [
          {
            label: 'é”€å”®é¢',
            data: [120, 132, 101, 134, 90, 230],
            color: '#1890ff',
          },
        ],
      },
      options: {
        showLegend: true,
        showTooltip: true,
      },
    };
    
    // âœ… ä½¿ç”¨é€‚é…å™¨è½¬æ¢ä¸º ECharts æ ¼å¼
    const echartsOption = ChartAdapter.adapt(config);
    chartInstance.current.setOption(echartsOption);
    
    return () => {
      chartInstance.current?.dispose();
    };
  }, []);
  
  return <div ref={chartRef} style={{ width: '100%', height: '400px' }} />;
};
```

---

### ğŸ”§ å‰ç«¯å®æˆ˜æ¡ˆä¾‹äº”ï¼šäº‹ä»¶å¯¹è±¡é€‚é…å™¨

#### åœºæ™¯æè¿°

ç»Ÿä¸€ä¸åŒåº“çš„äº‹ä»¶å¯¹è±¡æ ¼å¼ã€‚

```tsx
// adapters/EventAdapter.ts

/**
 * ç»Ÿä¸€çš„äº‹ä»¶å¯¹è±¡æ ¼å¼
 */
export interface UnifiedEvent {
  type: string;
  target: HTMLElement;
  preventDefault: () => void;
  stopPropagation: () => void;
  value?: string | number;
  checked?: boolean;
  key?: string;
  keyCode?: number;
}

/**
 * åŸç”Ÿ DOM äº‹ä»¶é€‚é…å™¨
 */
export class NativeEventAdapter {
  static adapt(event: Event): UnifiedEvent {
    const target = event.target as HTMLElement;
    
    return {
      type: event.type,
      target,
      preventDefault: () => event.preventDefault(),
      stopPropagation: () => event.stopPropagation(),
      value: (target as HTMLInputElement).value,
      checked: (target as HTMLInputElement).checked,
      key: (event as KeyboardEvent).key,
      keyCode: (event as KeyboardEvent).keyCode,
    };
  }
}

/**
 * React SyntheticEvent é€‚é…å™¨
 */
export class ReactEventAdapter {
  static adapt<T extends HTMLElement>(
    event: React.SyntheticEvent<T>
  ): UnifiedEvent {
    return {
      type: event.type,
      target: event.currentTarget,
      preventDefault: () => event.preventDefault(),
      stopPropagation: () => event.stopPropagation(),
      value: (event.target as HTMLInputElement).value,
      checked: (event.target as HTMLInputElement).checked,
      key: (event as React.KeyboardEvent).key,
      keyCode: (event as React.KeyboardEvent).keyCode,
    };
  }
}

/**
 * ç»Ÿä¸€äº‹ä»¶é€‚é…å™¨å·¥å‚
 */
export class EventAdapterFactory {
  static adapt(event: Event | React.SyntheticEvent): UnifiedEvent {
    if (event instanceof Event) {
      return NativeEventAdapter.adapt(event);
    } else {
      return ReactEventAdapter.adapt(event);
    }
  }
}
```

#### ä¸šåŠ¡ä¸­ä½¿ç”¨

```tsx
// components/UnifiedInput.tsx

import React from 'react';
import { Input } from 'antd';
import { EventAdapterFactory, UnifiedEvent } from '../adapters/EventAdapter';

interface UnifiedInputProps {
  value?: string;
  onChange?: (value: string, event: UnifiedEvent) => void;
  onKeyPress?: (key: string, event: UnifiedEvent) => void;
}

export const UnifiedInput: React.FC<UnifiedInputProps> = ({
  value,
  onChange,
  onKeyPress,
}) => {
  const handleChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    // âœ… ä½¿ç”¨é€‚é…å™¨ç»Ÿä¸€äº‹ä»¶æ ¼å¼
    const unifiedEvent = EventAdapterFactory.adapt(e);
    onChange?.(unifiedEvent.value as string, unifiedEvent);
  };
  
  const handleKeyPress = (e: React.KeyboardEvent<HTMLInputElement>) => {
    const unifiedEvent = EventAdapterFactory.adapt(e);
    onKeyPress?.(unifiedEvent.key || '', unifiedEvent);
  };
  
  return (
    <Input
      value={value}
      onChange={handleChange}
      onKeyPress={handleKeyPress}
    />
  );
};
```

---

### ğŸ”§ å‰ç«¯å®æˆ˜æ¡ˆä¾‹å…­ï¼šæ–°æ—§ç³»ç»Ÿæ¥å£é€‚é…å™¨

#### åœºæ™¯æè¿°

æ–°ç³»ç»Ÿéœ€è¦è°ƒç”¨æ—§ç³»ç»Ÿçš„æ¥å£ï¼Œä½†æ¥å£æ ¼å¼ä¸åŒï¼Œä½¿ç”¨é€‚é…å™¨æ¡¥æ¥ã€‚

```tsx
// adapters/LegacyApiAdapter.ts

/**
 * æ—§ç³»ç»Ÿ API æ ¼å¼
 */
interface LegacyUserApi {
  getUserInfo(userId: string): Promise<{
    user_id: string;
    user_name: string;
    user_email: string;
    create_time: string;
  }>;
  
  updateUser(userId: string, data: {
    user_name?: string;
    user_email?: string;
  }): Promise<{ success: boolean; message: string }>;
}

/**
 * æ–°ç³»ç»ŸæœŸæœ›çš„æ¥å£æ ¼å¼
 */
interface ModernUserApi {
  getUser(id: string): Promise<{
    id: string;
    name: string;
    email: string;
    createdAt: Date;
  }>;
  
  updateUser(id: string, data: {
    name?: string;
    email?: string;
  }): Promise<{ success: boolean; message: string }>;
}

/**
 * æ—§ç³»ç»Ÿ API é€‚é…å™¨
 * 
 * å°†æ—§ç³»ç»Ÿçš„æ¥å£é€‚é…ä¸ºæ–°ç³»ç»Ÿçš„æ¥å£æ ¼å¼
 */
export class LegacyApiAdapter implements ModernUserApi {
  constructor(private legacyApi: LegacyUserApi) {}
  
  async getUser(id: string) {
    // è°ƒç”¨æ—§ç³»ç»Ÿæ¥å£
    const legacyData = await this.legacyApi.getUserInfo(id);
    
    // âœ… è½¬æ¢ä¸ºæ–°ç³»ç»Ÿæ ¼å¼
    return {
      id: legacyData.user_id,
      name: legacyData.user_name,
      email: legacyData.user_email,
      createdAt: new Date(legacyData.create_time),
    };
  }
  
  async updateUser(id: string, data: { name?: string; email?: string }) {
    // âœ… å°†æ–°ç³»ç»Ÿæ ¼å¼è½¬æ¢ä¸ºæ—§ç³»ç»Ÿæ ¼å¼
    const legacyData: {
      user_name?: string;
      user_email?: string;
    } = {};
    
    if (data.name !== undefined) {
      legacyData.user_name = data.name;
    }
    
    if (data.email !== undefined) {
      legacyData.user_email = data.email;
    }
    
    // è°ƒç”¨æ—§ç³»ç»Ÿæ¥å£
    return this.legacyApi.updateUser(id, legacyData);
  }
}
```

#### ä¸šåŠ¡ä¸­ä½¿ç”¨

```tsx
// services/userService.ts

import { LegacyApiAdapter } from '../adapters/LegacyApiAdapter';
import { legacyUserApi } from '../apis/legacyApi';

// âœ… ä½¿ç”¨é€‚é…å™¨ï¼Œæ–°ä»£ç å¯ä»¥åƒä½¿ç”¨æ–°æ¥å£ä¸€æ ·ä½¿ç”¨æ—§æ¥å£
const modernUserApi = new LegacyApiAdapter(legacyUserApi);

export const getUser = async (id: string) => {
  // è°ƒç”¨æ–¹ä¸éœ€è¦çŸ¥é“åº•å±‚æ˜¯æ—§ç³»ç»Ÿ
  return modernUserApi.getUser(id);
};

export const updateUser = async (id: string, data: {
  name?: string;
  email?: string;
}) => {
  return modernUserApi.updateUser(id, data);
};

// ç»„ä»¶ä¸­ä½¿ç”¨
const UserProfile: React.FC<{ userId: string }> = ({ userId }) => {
  const [user, setUser] = useState<{
    id: string;
    name: string;
    email: string;
    createdAt: Date;
  } | null>(null);
  
  useEffect(() => {
    // âœ… ä½¿ç”¨ç»Ÿä¸€çš„æ¥å£æ ¼å¼ï¼Œä¸éœ€è¦å…³å¿ƒåº•å±‚å®ç°
    getUser(userId).then(setUser);
  }, [userId]);
  
  return user ? (
    <div>
      <h2>{user.name}</h2>
      <p>{user.email}</p>
      <p>æ³¨å†Œæ—¶é—´ï¼š{user.createdAt.toLocaleDateString()}</p>
    </div>
  ) : null;
};
```

---

### ğŸ“Š æ¨¡å¼æ€»ç»“

#### âœ… ä¼˜ç‚¹

| ä¼˜ç‚¹ | è¯´æ˜ |
|------|------|
| **è§£è€¦** | ä¸šåŠ¡ä»£ç ä¸ç›´æ¥ä¾èµ–å¤–éƒ¨æ¥å£æ ¼å¼ |
| **å¤ç”¨** | é€‚é…å™¨å¯ä»¥åœ¨å¤šå¤„å¤ç”¨ |
| **ç»Ÿä¸€æ¥å£** | è°ƒç”¨æ–¹ä½¿ç”¨ç»Ÿä¸€çš„æ¥å£æ ¼å¼ |
| **æ˜“äºç»´æŠ¤** | æ¥å£æ ¼å¼å˜åŒ–æ—¶ï¼Œåªéœ€ä¿®æ”¹é€‚é…å™¨ |
| **å‘åå…¼å®¹** | å¯ä»¥é€‚é…æ—§æ¥å£ï¼Œä¿æŒå…¼å®¹æ€§ |

#### âŒ ç¼ºç‚¹

| ç¼ºç‚¹ | è¯´æ˜ |
|------|------|
| **å¢åŠ å¤æ‚åº¦** | å¤šäº†ä¸€å±‚é€‚é…å±‚ï¼Œä»£ç é‡å¢åŠ  |
| **æ€§èƒ½å¼€é”€** | æ•°æ®è½¬æ¢æœ‰ä¸€å®šæ€§èƒ½å¼€é”€ï¼ˆé€šå¸¸å¯å¿½ç•¥ï¼‰ |
| **ç»´æŠ¤æˆæœ¬** | éœ€è¦ç»´æŠ¤é€‚é…å™¨ä»£ç  |

#### ğŸ¯ é€‚ç”¨åœºæ™¯

| åœºæ™¯ | ç¤ºä¾‹ |
|------|------|
| **ç¬¬ä¸‰æ–¹åº“æ¥å£** | ç¬¬ä¸‰æ–¹åº“ API å’Œé¡¹ç›®éœ€æ±‚ä¸ä¸€è‡´ |
| **API æ ¼å¼ç»Ÿä¸€** | å¤šä¸ª API è¿”å›æ ¼å¼ä¸åŒï¼Œéœ€è¦ç»Ÿä¸€ |
| **æ–°æ—§ç³»ç»Ÿå…¼å®¹** | æ–°ä»£ç è°ƒç”¨æ—§æ¥å£ |
| **ç»„ä»¶ props** | ç»„ä»¶æœŸæœ›çš„ props å’Œå®é™…æ•°æ®æ ¼å¼ä¸åŒ |
| **æ•°æ®æ ¼å¼è½¬æ¢** | åç«¯æ•°æ®æ ¼å¼å’Œå‰ç«¯éœ€è¦çš„ä¸ä¸€è‡´ |

#### ğŸš« ä¸é€‚ç”¨åœºæ™¯

- æ¥å£æ ¼å¼å®Œå…¨ä¸€è‡´ï¼Œä¸éœ€è¦è½¬æ¢
- æ€§èƒ½è¦æ±‚æé«˜çš„åœºæ™¯ï¼ˆè½¬æ¢æœ‰å¼€é”€ï¼‰
- ç®€å•çš„æ•°æ®æ˜ å°„ï¼ˆå¯ä»¥ç›´æ¥åœ¨ä¸šåŠ¡ä»£ç ä¸­å¤„ç†ï¼‰

---

### ğŸ”„ ä¸å…¶ä»–æ¨¡å¼çš„åŒºåˆ«

| æ¨¡å¼ | å…³æ³¨ç‚¹ | åŒºåˆ« |
|------|--------|------|
| **é€‚é…å™¨æ¨¡å¼** | æ¥å£è½¬æ¢ | è®©ä¸å…¼å®¹çš„æ¥å£å¯ä»¥ä¸€èµ·å·¥ä½œ |
| **è£…é¥°å™¨æ¨¡å¼** | åŠŸèƒ½å¢å¼º | åœ¨ä¸æ”¹å˜æ¥å£çš„æƒ…å†µä¸‹å¢å¼ºåŠŸèƒ½ |
| **ä»£ç†æ¨¡å¼** | è®¿é—®æ§åˆ¶ | æ§åˆ¶å¯¹å¯¹è±¡çš„è®¿é—® |
| **å¤–è§‚æ¨¡å¼** | ç®€åŒ–æ¥å£ | æä¾›ç®€åŒ–çš„ç»Ÿä¸€æ¥å£ |

---

### ğŸ¤” é€‰æ‹©å»ºè®®ï¼šä»€ä¹ˆæ—¶å€™ç”¨é€‚é…å™¨æ¨¡å¼ï¼Ÿ

é—®è‡ªå·±è¿™å‡ ä¸ªé—®é¢˜ï¼š

```
1. ä½ æ˜¯å¦æœ‰ä¸¤ä¸ªä¸å…¼å®¹çš„æ¥å£éœ€è¦ä¸€èµ·å·¥ä½œï¼Ÿ
   â†’ æ˜¯çš„è¯ï¼Œè€ƒè™‘é€‚é…å™¨æ¨¡å¼

2. ä½ æ˜¯å¦éœ€è¦ç»Ÿä¸€å¤šä¸ªä¸åŒæ ¼å¼çš„æ¥å£ï¼Ÿ
   â†’ æ˜¯çš„è¯ï¼Œè€ƒè™‘é€‚é…å™¨æ¨¡å¼

3. ä½ çš„ä¸šåŠ¡ä»£ç æ˜¯å¦ç›´æ¥ä¾èµ–å¤–éƒ¨æ¥å£æ ¼å¼ï¼Ÿ
   â†’ å¦‚æœæ˜¯ï¼Œè€ƒè™‘ç”¨é€‚é…å™¨è§£è€¦

4. ä½ æ˜¯å¦éœ€è¦è°ƒç”¨æ—§æ¥å£ï¼Œä½†å¸Œæœ›ä½¿ç”¨æ–°æ¥å£æ ¼å¼ï¼Ÿ
   â†’ æ˜¯çš„è¯ï¼Œè€ƒè™‘é€‚é…å™¨æ¨¡å¼

5. æ•°æ®è½¬æ¢é€»è¾‘æ˜¯å¦åœ¨å¤šä¸ªåœ°æ–¹é‡å¤ï¼Ÿ
   â†’ å¦‚æœæ˜¯ï¼Œè€ƒè™‘å°è£…æˆé€‚é…å™¨
```

---

### ğŸ“ æ–‡ä»¶ç»“æ„å‚è€ƒ

```
src/
â”œâ”€â”€ adapters/
â”‚   â”œâ”€â”€ ApiResponseAdapter.ts      # API å“åº”é€‚é…å™¨
â”‚   â”œâ”€â”€ TableDataAdapter.ts         # Table æ•°æ®é€‚é…å™¨
â”‚   â”œâ”€â”€ UserCardAdapter.ts          # ç»„ä»¶ Props é€‚é…å™¨
â”‚   â”œâ”€â”€ ChartAdapter.ts             # å›¾è¡¨é€‚é…å™¨
â”‚   â”œâ”€â”€ EventAdapter.ts             # äº‹ä»¶é€‚é…å™¨
â”‚   â””â”€â”€ LegacyApiAdapter.ts         # æ—§ç³»ç»Ÿæ¥å£é€‚é…å™¨
â”œâ”€â”€ services/
â”‚   â””â”€â”€ userService.ts             # ä½¿ç”¨é€‚é…å™¨çš„æœåŠ¡
â””â”€â”€ components/
    â”œâ”€â”€ UserTable.tsx               # ä½¿ç”¨ Table é€‚é…å™¨
    â””â”€â”€ UserCard.tsx                # ä½¿ç”¨ Props é€‚é…å™¨
```

---

> **ä¸‹ä¸€ç« é¢„å‘Šï¼šã€Šè£…é¥°å™¨æ¨¡å¼ã€‹â€”â€” ç»™åŠŸèƒ½"åŠ æ–™"çš„æ­£ç¡®å§¿åŠ¿**
> 
> æˆ‘ä»¬å°†è®²è§£å¦‚ä½•é€šè¿‡è£…é¥°å™¨æ¨¡å¼å¢å¼ºç»„ä»¶åŠŸèƒ½ã€æ·»åŠ æƒé™æ§åˆ¶ã€æ—¥å¿—è®°å½•ç­‰ã€‚

---

*å¦‚æœ‰ç–‘é—®æˆ–å»ºè®®ï¼Œæ¬¢è¿äº¤æµï¼*

