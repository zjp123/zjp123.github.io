# æ¨¡æ¿æ–¹æ³•æ¨¡å¼ï¼ˆTemplate Method Patternï¼‰

> ã€Šå‰ç«¯è®¾è®¡æ¨¡å¼å®æˆ˜æ‰‹å†Œã€‹ç³»åˆ— - ç¬¬ä¹ç« 

---

## ä¸€å¥è¯å¤§ç™½è¯

**å°±åƒåšèœçš„æ ‡å‡†æµç¨‹**ï¼šåšä»»ä½•èœéƒ½æ˜¯"å¤‡èœ â†’ çƒ­é”… â†’ ç‚’èœ â†’ å‡ºé”…"è¿™ä¸ªæµç¨‹ï¼Œä½†å…·ä½“æ€ä¹ˆå¤‡èœã€ç‚’å¤šä¹…ã€æ”¾ä»€ä¹ˆè°ƒæ–™ï¼Œæ¯é“èœä¸ä¸€æ ·ã€‚å¦ˆå¦ˆå®šå¥½äº†åšèœçš„æµç¨‹ï¼ˆæ¨¡æ¿ï¼‰ï¼Œä½ åªéœ€è¦å¡«å…¥æ¯é“èœçš„ç»†èŠ‚å°±è¡Œã€‚

## å‰ç«¯ç—›ç‚¹

æƒ³è±¡ä¸€ä¸‹ï¼Œä½ åœ¨åšå¤šä¸ªé¡µé¢ï¼Œæ¯ä¸ªé¡µé¢éƒ½æœ‰ç›¸ä¼¼çš„æµç¨‹ï¼šè·å–æ•°æ®ã€æ¸²æŸ“ã€é”™è¯¯å¤„ç†ï¼Œä½†ç»†èŠ‚ä¸åŒï¼š

```typescript
// âŒ æ²¡æœ‰ä½¿ç”¨æ¨¡æ¿æ–¹æ³•æ¨¡å¼çš„ä»£ç ï¼šé‡å¤çš„æµç¨‹ä»£ç 
class UserListPage {
  async init() {
    this.showLoading();
    
    try {
      // è·å–ç”¨æˆ·æ•°æ®
      const data = await fetch('/api/users').then(r => r.json());
      
      // æ¸²æŸ“ç”¨æˆ·åˆ—è¡¨
      this.renderUserList(data);
      
      this.hideLoading();
    } catch (error) {
      this.showError(error);
    }
  }
  
  renderUserList(data) {
    // ç”¨æˆ·åˆ—è¡¨æ¸²æŸ“é€»è¾‘
  }
}

class OrderListPage {
  async init() {
    this.showLoading(); // é‡å¤ï¼
    
    try {
      // è·å–è®¢å•æ•°æ®
      const data = await fetch('/api/orders').then(r => r.json());
      
      // æ¸²æŸ“è®¢å•åˆ—è¡¨
      this.renderOrderList(data);
      
      this.hideLoading(); // é‡å¤ï¼
    } catch (error) {
      this.showError(error); // é‡å¤ï¼
    }
  }
  
  renderOrderList(data) {
    // è®¢å•åˆ—è¡¨æ¸²æŸ“é€»è¾‘
  }
}

// æ¯ä¸ªé¡µé¢éƒ½è¦å†™ä¸€é loadingã€error å¤„ç†ï¼Œæµç¨‹ä»£ç é‡å¤ï¼
```

**è¿™æ®µä»£ç çš„é—®é¢˜ï¼š**
1. ğŸ”„ **æµç¨‹ä»£ç é‡å¤**ï¼šæ¯ä¸ªé¡µé¢éƒ½è¦å†™ä¸€é loadingã€error å¤„ç†
2. ğŸ› **å®¹æ˜“é—æ¼**ï¼šå¿˜è®°åŠ  loading æˆ– error å¤„ç†å¾ˆå¸¸è§
3. ğŸ”§ **éš¾ä»¥ç»´æŠ¤**ï¼šè¦æ”¹æµç¨‹ï¼Œæ¯ä¸ªé¡µé¢éƒ½è¦æ”¹
4. ğŸš« **ä¸ç»Ÿä¸€**ï¼šä¸åŒé¡µé¢çš„æµç¨‹å¯èƒ½ä¸ä¸€è‡´

## æ¨¡å¼æ ¸å¿ƒæ¦‚å¿µ

**æ¨¡æ¿æ–¹æ³•æ¨¡å¼çš„æœ¬è´¨**ï¼šåœ¨çˆ¶ç±»ä¸­å®šä¹‰ç®—æ³•çš„éª¨æ¶ï¼Œå°†æŸäº›æ­¥éª¤å»¶è¿Ÿåˆ°å­ç±»å®ç°ã€‚çˆ¶ç±»æ§åˆ¶æµç¨‹ï¼Œå­ç±»å®ç°ç»†èŠ‚ã€‚

**ä¸¤ä¸ªæ ¸å¿ƒè§’è‰²ï¼š**
- **æŠ½è±¡ç±»ï¼ˆAbstract Classï¼‰**ï¼šå®šä¹‰æ¨¡æ¿æ–¹æ³•ï¼ˆç®—æ³•éª¨æ¶ï¼‰å’ŒæŠ½è±¡æ–¹æ³•ï¼ˆå¾…å®ç°çš„æ­¥éª¤ï¼‰
- **å…·ä½“ç±»ï¼ˆConcrete Classï¼‰**ï¼šå®ç°æŠ½è±¡æ–¹æ³•ï¼Œå®Œæˆç®—æ³•çš„å…·ä½“æ­¥éª¤

**æ ¸å¿ƒæ¦‚å¿µï¼š**
- **æ¨¡æ¿æ–¹æ³•ï¼ˆTemplate Methodï¼‰**ï¼šå®šä¹‰ç®—æ³•éª¨æ¶ï¼Œè°ƒç”¨å„ä¸ªæ­¥éª¤
- **æŠ½è±¡æ–¹æ³•ï¼ˆAbstract Methodï¼‰**ï¼šå¿…é¡»ç”±å­ç±»å®ç°
- **é’©å­æ–¹æ³•ï¼ˆHook Methodï¼‰**ï¼šå¯é€‰å®ç°ï¼Œæä¾›æ‰©å±•ç‚¹

**ç±»æ¯”**ï¼š
- ğŸ³ **åšèœæµç¨‹**ï¼šå¤‡èœ â†’ çƒ­é”… â†’ ç‚’èœ â†’ å‡ºé”…ï¼ˆæµç¨‹å›ºå®šï¼Œç»†èŠ‚ä¸åŒï¼‰
- ğŸ“ **è€ƒè¯•æµç¨‹**ï¼šå‘å· â†’ ç­”é¢˜ â†’ æ”¶å·ï¼ˆæµç¨‹å›ºå®šï¼Œç­”é¢˜å†…å®¹ä¸åŒï¼‰
- ğŸ—ï¸ **ç›–æˆ¿å­**ï¼šæ‰“åœ°åŸº â†’ ç Œå¢™ â†’ è£…ä¿®ï¼ˆæµç¨‹å›ºå®šï¼Œè£…ä¿®é£æ ¼ä¸åŒï¼‰

**æ ¸å¿ƒç»“æ„ï¼š**

```typescript
abstract class Template {
  // æ¨¡æ¿æ–¹æ³•ï¼šå®šä¹‰ç®—æ³•éª¨æ¶
  templateMethod() {
    this.step1();
    this.step2();
    if (this.hook()) {  // é’©å­æ–¹æ³•
      this.step3();
    }
    this.step4();
  }
  
  // æŠ½è±¡æ–¹æ³•ï¼šå­ç±»å¿…é¡»å®ç°
  abstract step1(): void;
  abstract step2(): void;
  
  // å…·ä½“æ–¹æ³•ï¼šé€šç”¨å®ç°
  step4() {
    console.log('é€šç”¨æ­¥éª¤4');
  }
  
  // é’©å­æ–¹æ³•ï¼šå¯é€‰å®ç°
  hook(): boolean {
    return true;
  }
}
```

## å‰ç«¯å®æˆ˜æ¡ˆä¾‹

### åœºæ™¯ä¸€ï¼šé¡µé¢æ•°æ®åŠ è½½æµç¨‹ï¼ˆç»Ÿä¸€çš„ CRUD é¡µé¢ï¼‰

æˆ‘ä»¬è¦å®ç°ä¸€ä¸ªç»Ÿä¸€çš„é¡µé¢åŠ è½½æµç¨‹ï¼Œé€‚ç”¨äºå„ç§åˆ—è¡¨é¡µï¼š

```typescript
// âœ… ä½¿ç”¨æ¨¡æ¿æ–¹æ³•æ¨¡å¼é‡æ„

import React, { useState, useEffect } from 'react';
import { Card, Table, Button, Space, Spin, Alert, Tag, Modal, message } from 'antd';
import { ReloadOutlined, PlusOutlined, EditOutlined, DeleteOutlined } from '@ant-design/icons';

// 1ï¸âƒ£ æŠ½è±¡ç±»ï¼šé¡µé¢æ¨¡æ¿
abstract class PageTemplate<T = any> {
  protected data: T[] = [];
  protected loading: boolean = false;
  protected error: string | null = null;
  protected onStateChange?: () => void;
  
  // è®¾ç½®çŠ¶æ€å˜åŒ–å›è°ƒ
  setStateChangeCallback(callback: () => void): void {
    this.onStateChange = callback;
  }
  
  // é€šçŸ¥çŠ¶æ€å˜åŒ–
  protected notifyStateChange(): void {
    this.onStateChange?.();
  }
  
  // ğŸ¯ æ¨¡æ¿æ–¹æ³•ï¼šå®šä¹‰é¡µé¢åŠ è½½æµç¨‹
  async loadPage(): Promise<void> {
    console.log('[æ¨¡æ¿æ–¹æ³•] å¼€å§‹æ‰§è¡Œé¡µé¢åŠ è½½æµç¨‹');
    
    // 1. æ˜¾ç¤º loading
    this.showLoading();
    
    try {
      // 2. æ‰§è¡Œåˆå§‹åŒ–ï¼ˆé’©å­ï¼‰
      await this.beforeFetch();
      
      // 3. è·å–æ•°æ®ï¼ˆæŠ½è±¡æ–¹æ³•ï¼Œå­ç±»å®ç°ï¼‰
      const data = await this.fetchData();
      
      // 4. æ•°æ®è½¬æ¢ï¼ˆé’©å­ï¼‰
      const transformedData = await this.transformData(data);
      
      // 5. ä¿å­˜æ•°æ®
      this.data = transformedData;
      
      // 6. æ‰§è¡Œåç»­å¤„ç†ï¼ˆé’©å­ï¼‰
      await this.afterFetch();
      
      // 7. éšè— loading
      this.hideLoading();
      
      console.log('[æ¨¡æ¿æ–¹æ³•] é¡µé¢åŠ è½½æµç¨‹å®Œæˆ');
    } catch (error: any) {
      // 8. é”™è¯¯å¤„ç†
      this.handleError(error);
    }
  }
  
  // å…·ä½“æ–¹æ³•ï¼šæ˜¾ç¤º loading
  protected showLoading(): void {
    console.log('[é€šç”¨æ­¥éª¤] æ˜¾ç¤º loading');
    this.loading = true;
    this.error = null;
    this.notifyStateChange();
  }
  
  // å…·ä½“æ–¹æ³•ï¼šéšè— loading
  protected hideLoading(): void {
    console.log('[é€šç”¨æ­¥éª¤] éšè— loading');
    this.loading = false;
    this.notifyStateChange();
  }
  
  // å…·ä½“æ–¹æ³•ï¼šé”™è¯¯å¤„ç†
  protected handleError(error: any): void {
    console.error('[é€šç”¨æ­¥éª¤] å¤„ç†é”™è¯¯:', error);
    this.loading = false;
    this.error = error.message || 'æ•°æ®åŠ è½½å¤±è´¥';
    this.notifyStateChange();
  }
  
  // æŠ½è±¡æ–¹æ³•ï¼šè·å–æ•°æ®ï¼ˆå­ç±»å¿…é¡»å®ç°ï¼‰
  protected abstract fetchData(): Promise<T[]>;
  
  // æŠ½è±¡æ–¹æ³•ï¼šè·å–è¡¨æ ¼åˆ—é…ç½®ï¼ˆå­ç±»å¿…é¡»å®ç°ï¼‰
  abstract getColumns(): any[];
  
  // é’©å­æ–¹æ³•ï¼šæ•°æ®è·å–å‰ï¼ˆå¯é€‰å®ç°ï¼‰
  protected async beforeFetch(): Promise<void> {
    console.log('[é’©å­æ–¹æ³•] beforeFetch - å­ç±»å¯è¦†ç›–');
  }
  
  // é’©å­æ–¹æ³•ï¼šæ•°æ®è½¬æ¢ï¼ˆå¯é€‰å®ç°ï¼‰
  protected async transformData(data: T[]): Promise<T[]> {
    console.log('[é’©å­æ–¹æ³•] transformData - å­ç±»å¯è¦†ç›–');
    return data;
  }
  
  // é’©å­æ–¹æ³•ï¼šæ•°æ®è·å–åï¼ˆå¯é€‰å®ç°ï¼‰
  protected async afterFetch(): Promise<void> {
    console.log('[é’©å­æ–¹æ³•] afterFetch - å­ç±»å¯è¦†ç›–');
  }
  
  // è·å–æ•°æ®
  getData(): T[] {
    return this.data;
  }
  
  getLoading(): boolean {
    return this.loading;
  }
  
  getError(): string | null {
    return this.error;
  }
}

// 2ï¸âƒ£ å…·ä½“ç±»ï¼šç”¨æˆ·åˆ—è¡¨é¡µ
interface User {
  id: number;
  name: string;
  email: string;
  role: string;
  status: 'active' | 'inactive';
}

class UserListPage extends PageTemplate<User> {
  // å®ç°æŠ½è±¡æ–¹æ³•ï¼šè·å–ç”¨æˆ·æ•°æ®
  protected async fetchData(): Promise<User[]> {
    console.log('[ç”¨æˆ·åˆ—è¡¨] è·å–ç”¨æˆ·æ•°æ®');
    
    // æ¨¡æ‹Ÿ API è¯·æ±‚
    await new Promise(resolve => setTimeout(resolve, 1000));
    
    return [
      { id: 1, name: 'å¼ ä¸‰', email: 'zhangsan@example.com', role: 'admin', status: 'active' },
      { id: 2, name: 'æå››', email: 'lisi@example.com', role: 'user', status: 'active' },
      { id: 3, name: 'ç‹äº”', email: 'wangwu@example.com', role: 'user', status: 'inactive' },
    ];
  }
  
  // å®ç°é’©å­æ–¹æ³•ï¼šæ•°æ®è½¬æ¢
  protected async transformData(data: User[]): Promise<User[]> {
    console.log('[ç”¨æˆ·åˆ—è¡¨] æ•°æ®è½¬æ¢ï¼šæ·»åŠ æ˜¾ç¤ºåç§°');
    return data.map(user => ({
      ...user,
      displayName: `${user.name} (${user.role})`,
    } as any));
  }
  
  // å®ç°æŠ½è±¡æ–¹æ³•ï¼šè¡¨æ ¼åˆ—é…ç½®
  getColumns() {
    return [
      { title: 'ID', dataIndex: 'id', key: 'id' },
      { title: 'å§“å', dataIndex: 'name', key: 'name' },
      { title: 'é‚®ç®±', dataIndex: 'email', key: 'email' },
      {
        title: 'è§’è‰²',
        dataIndex: 'role',
        key: 'role',
        render: (role: string) => (
          <Tag color={role === 'admin' ? 'red' : 'blue'}>
            {role === 'admin' ? 'ç®¡ç†å‘˜' : 'æ™®é€šç”¨æˆ·'}
          </Tag>
        ),
      },
      {
        title: 'çŠ¶æ€',
        dataIndex: 'status',
        key: 'status',
        render: (status: string) => (
          <Tag color={status === 'active' ? 'green' : 'default'}>
            {status === 'active' ? 'æ¿€æ´»' : 'åœç”¨'}
          </Tag>
        ),
      },
    ];
  }
}

// 3ï¸âƒ£ å…·ä½“ç±»ï¼šè®¢å•åˆ—è¡¨é¡µ
interface Order {
  id: number;
  orderNo: string;
  customer: string;
  amount: number;
  status: 'pending' | 'paid' | 'shipped' | 'completed';
}

class OrderListPage extends PageTemplate<Order> {
  // å®ç°æŠ½è±¡æ–¹æ³•ï¼šè·å–è®¢å•æ•°æ®
  protected async fetchData(): Promise<Order[]> {
    console.log('[è®¢å•åˆ—è¡¨] è·å–è®¢å•æ•°æ®');
    
    // æ¨¡æ‹Ÿ API è¯·æ±‚
    await new Promise(resolve => setTimeout(resolve, 1200));
    
    return [
      { id: 1, orderNo: 'ORD001', customer: 'å¼ ä¸‰', amount: 299, status: 'paid' },
      { id: 2, orderNo: 'ORD002', customer: 'æå››', amount: 599, status: 'shipped' },
      { id: 3, orderNo: 'ORD003', customer: 'ç‹äº”', amount: 199, status: 'pending' },
    ];
  }
  
  // å®ç°é’©å­æ–¹æ³•ï¼šæ•°æ®è·å–å‰
  protected async beforeFetch(): Promise<void> {
    console.log('[è®¢å•åˆ—è¡¨] beforeFetchï¼šæ£€æŸ¥æƒé™');
    // å¯ä»¥åœ¨è¿™é‡Œåšæƒé™æ£€æŸ¥ã€å‚æ•°éªŒè¯ç­‰
  }
  
  // å®ç°é’©å­æ–¹æ³•ï¼šæ•°æ®è½¬æ¢
  protected async transformData(data: Order[]): Promise<Order[]> {
    console.log('[è®¢å•åˆ—è¡¨] æ•°æ®è½¬æ¢ï¼šæ ¼å¼åŒ–é‡‘é¢');
    return data.map(order => ({
      ...order,
      formattedAmount: `Â¥${order.amount.toFixed(2)}`,
    } as any));
  }
  
  // å®ç°é’©å­æ–¹æ³•ï¼šæ•°æ®è·å–å
  protected async afterFetch(): Promise<void> {
    console.log('[è®¢å•åˆ—è¡¨] afterFetchï¼šç»Ÿè®¡è®¢å•æ•°æ®');
    message.success(`æˆåŠŸåŠ è½½ ${this.data.length} æ¡è®¢å•`);
  }
  
  // å®ç°æŠ½è±¡æ–¹æ³•ï¼šè¡¨æ ¼åˆ—é…ç½®
  getColumns() {
    return [
      { title: 'ID', dataIndex: 'id', key: 'id' },
      { title: 'è®¢å•å·', dataIndex: 'orderNo', key: 'orderNo' },
      { title: 'å®¢æˆ·', dataIndex: 'customer', key: 'customer' },
      {
        title: 'é‡‘é¢',
        dataIndex: 'formattedAmount',
        key: 'amount',
        render: (text: string) => <span style={{ color: '#ff4d4f' }}>{text}</span>,
      },
      {
        title: 'çŠ¶æ€',
        dataIndex: 'status',
        key: 'status',
        render: (status: string) => {
          const colorMap = {
            pending: 'default',
            paid: 'blue',
            shipped: 'orange',
            completed: 'green',
          };
          const textMap = {
            pending: 'å¾…æ”¯ä»˜',
            paid: 'å·²æ”¯ä»˜',
            shipped: 'å·²å‘è´§',
            completed: 'å·²å®Œæˆ',
          };
          return <Tag color={colorMap[status]}>{textMap[status]}</Tag>;
        },
      },
    ];
  }
}

// 4ï¸âƒ£ React ç»„ä»¶
const TemplateMethodDemo: React.FC = () => {
  const [currentPage, setCurrentPage] = useState<'user' | 'order'>('user');
  const [, forceUpdate] = useState({});
  
  // åˆ›å»ºé¡µé¢å®ä¾‹
  const [userPage] = useState(() => {
    const page = new UserListPage();
    page.setStateChangeCallback(() => forceUpdate({}));
    return page;
  });
  
  const [orderPage] = useState(() => {
    const page = new OrderListPage();
    page.setStateChangeCallback(() => forceUpdate({}));
    return page;
  });
  
  const currentPageInstance = currentPage === 'user' ? userPage : orderPage;
  
  // åˆå§‹åŠ è½½
  useEffect(() => {
    currentPageInstance.loadPage();
  }, [currentPage]);
  
  // åˆ·æ–°
  const handleRefresh = () => {
    currentPageInstance.loadPage();
  };
  
  return (
    <div style={{ padding: 24, backgroundColor: '#f0f2f5', minHeight: '100vh' }}>
      <Card
        title="ğŸ“‹ åˆ—è¡¨é¡µé¢ï¼ˆæ¨¡æ¿æ–¹æ³•æ¨¡å¼ï¼‰"
        style={{ maxWidth: 1200, margin: '0 auto' }}
        extra={
          <Space>
            <Button
              type={currentPage === 'user' ? 'primary' : 'default'}
              onClick={() => setCurrentPage('user')}
            >
              ç”¨æˆ·åˆ—è¡¨
            </Button>
            <Button
              type={currentPage === 'order' ? 'primary' : 'default'}
              onClick={() => setCurrentPage('order')}
            >
              è®¢å•åˆ—è¡¨
            </Button>
          </Space>
        }
      >
        {/* æµç¨‹å±•ç¤º */}
        <Card type="inner" title="æ¨¡æ¿æ–¹æ³•æµç¨‹" style={{ marginBottom: 16 }}>
          <Space wrap>
            <Tag color="blue">1. æ˜¾ç¤º Loading</Tag>
            <Tag color="blue">2. beforeFetchï¼ˆé’©å­ï¼‰</Tag>
            <Tag color="red">3. fetchDataï¼ˆæŠ½è±¡æ–¹æ³•ï¼‰</Tag>
            <Tag color="blue">4. transformDataï¼ˆé’©å­ï¼‰</Tag>
            <Tag color="blue">5. ä¿å­˜æ•°æ®</Tag>
            <Tag color="blue">6. afterFetchï¼ˆé’©å­ï¼‰</Tag>
            <Tag color="blue">7. éšè— Loading</Tag>
          </Space>
          <div style={{ marginTop: 12, color: '#666', fontSize: 12 }}>
            ğŸ’¡ çº¢è‰²æ ‡ç­¾ä¸ºæŠ½è±¡æ–¹æ³•ï¼ˆå­ç±»å¿…é¡»å®ç°ï¼‰ï¼Œè“è‰²æ ‡ç­¾ä¸ºé€šç”¨æ­¥éª¤æˆ–é’©å­æ–¹æ³•
          </div>
        </Card>
        
        {/* æ“ä½œæ  */}
        <Space style={{ marginBottom: 16 }}>
          <Button
            type="primary"
            icon={<ReloadOutlined />}
            onClick={handleRefresh}
            loading={currentPageInstance.getLoading()}
          >
            åˆ·æ–°
          </Button>
          <Tag color="green">
            å½“å‰é¡µé¢: {currentPage === 'user' ? 'ç”¨æˆ·åˆ—è¡¨' : 'è®¢å•åˆ—è¡¨'}
          </Tag>
        </Space>
        
        {/* é”™è¯¯æç¤º */}
        {currentPageInstance.getError() && (
          <Alert
            type="error"
            message={currentPageInstance.getError()}
            closable
            style={{ marginBottom: 16 }}
          />
        )}
        
        {/* æ•°æ®è¡¨æ ¼ */}
        <Spin spinning={currentPageInstance.getLoading()}>
          <Table
            dataSource={currentPageInstance.getData()}
            columns={currentPageInstance.getColumns()}
            rowKey="id"
            pagination={{ pageSize: 10 }}
          />
        </Spin>
        
        {/* è¯´æ˜ */}
        <Card type="inner" title="ğŸ“‹ æ¨¡æ¿æ–¹æ³•æ¨¡å¼è¯´æ˜" style={{ marginTop: 16 }}>
          <ul style={{ margin: 0, paddingLeft: 20 }}>
            <li>âœ… <strong>PageTemplate</strong> æ˜¯æŠ½è±¡ç±»ï¼Œå®šä¹‰äº†é¡µé¢åŠ è½½çš„æ¨¡æ¿æ–¹æ³•ï¼ˆloadPageï¼‰</li>
            <li>âœ… <strong>UserListPageã€OrderListPage</strong> æ˜¯å…·ä½“ç±»ï¼Œå®ç°æŠ½è±¡æ–¹æ³•</li>
            <li>âœ… æ¨¡æ¿æ–¹æ³•æ§åˆ¶æµç¨‹ï¼Œå­ç±»åªéœ€å®ç°å…·ä½“æ­¥éª¤ï¼ˆfetchDataã€getColumnsï¼‰</li>
            <li>âœ… é’©å­æ–¹æ³•ï¼ˆbeforeFetchã€transformDataã€afterFetchï¼‰æä¾›æ‰©å±•ç‚¹</li>
            <li>âœ… æ–°å¢é¡µé¢åªéœ€ç»§æ‰¿ PageTemplate å¹¶å®ç°æŠ½è±¡æ–¹æ³•</li>
            <li>âœ… ç»Ÿä¸€çš„ loadingã€error å¤„ç†ï¼Œé¿å…é‡å¤ä»£ç </li>
          </ul>
        </Card>
      </Card>
    </div>
  );
};

export default TemplateMethodDemo;
```

#### ğŸ¯ ä½¿ç”¨æ¨¡æ¿æ–¹æ³•æ¨¡å¼åçš„å¥½å¤„

1. **æµç¨‹ç»Ÿä¸€**ï¼šæ‰€æœ‰é¡µé¢å…±äº«ç›¸åŒçš„åŠ è½½æµç¨‹
2. **é¿å…é‡å¤**ï¼šloadingã€error å¤„ç†åªå†™ä¸€æ¬¡
3. **æ˜“äºæ‰©å±•**ï¼šé’©å­æ–¹æ³•æä¾›çµæ´»çš„æ‰©å±•ç‚¹
4. **è§„èŒƒç»Ÿä¸€**ï¼šæ–°é¡µé¢å¿…é¡»éµå¾ªæ¨¡æ¿æµç¨‹

---

### åœºæ™¯äºŒï¼šè¡¨å•æäº¤æµç¨‹ï¼ˆç»Ÿä¸€çš„è¡¨å•å¤„ç†ï¼‰

å®ç°ä¸€ä¸ªç»Ÿä¸€çš„è¡¨å•æäº¤æµç¨‹ï¼Œé€‚ç”¨äºå„ç§è¡¨å•ï¼š

```typescript
import React, { useState } from 'react';
import { Card, Form, Input, Button, message, Space, Steps, Tag } from 'antd';
import { SaveOutlined } from '@ant-design/icons';

// è¡¨å•æ¨¡æ¿
abstract class FormTemplate<T = any> {
  protected formData: T | null = null;
  protected errors: Record<string, string> = {};
  protected submitting: boolean = false;
  protected onStateChange?: () => void;
  
  setStateChangeCallback(callback: () => void): void {
    this.onStateChange = callback;
  }
  
  protected notifyStateChange(): void {
    this.onStateChange?.();
  }
  
  // ğŸ¯ æ¨¡æ¿æ–¹æ³•ï¼šè¡¨å•æäº¤æµç¨‹
  async submitForm(data: T): Promise<void> {
    console.log('[æ¨¡æ¿æ–¹æ³•] å¼€å§‹è¡¨å•æäº¤æµç¨‹');
    
    try {
      // 1. å¼€å§‹æäº¤
      this.startSubmitting();
      
      // 2. è¡¨å•éªŒè¯ï¼ˆæŠ½è±¡æ–¹æ³•ï¼‰
      await this.validateForm(data);
      
      // 3. æ•°æ®é¢„å¤„ç†ï¼ˆé’©å­ï¼‰
      const processedData = await this.preprocessData(data);
      
      // 4. æäº¤å‰ç¡®è®¤ï¼ˆé’©å­ï¼‰
      const shouldContinue = await this.beforeSubmit(processedData);
      if (!shouldContinue) {
        this.cancelSubmitting();
        return;
      }
      
      // 5. æäº¤æ•°æ®ï¼ˆæŠ½è±¡æ–¹æ³•ï¼‰
      const result = await this.submit(processedData);
      
      // 6. æäº¤åå¤„ç†ï¼ˆé’©å­ï¼‰
      await this.afterSubmit(result);
      
      // 7. æäº¤æˆåŠŸ
      this.submitSuccess();
      
      console.log('[æ¨¡æ¿æ–¹æ³•] è¡¨å•æäº¤æµç¨‹å®Œæˆ');
    } catch (error: any) {
      // 8. é”™è¯¯å¤„ç†
      this.submitError(error);
    }
  }
  
  // å…·ä½“æ–¹æ³•
  protected startSubmitting(): void {
    console.log('[é€šç”¨æ­¥éª¤] å¼€å§‹æäº¤');
    this.submitting = true;
    this.errors = {};
    this.notifyStateChange();
  }
  
  protected cancelSubmitting(): void {
    console.log('[é€šç”¨æ­¥éª¤] å–æ¶ˆæäº¤');
    this.submitting = false;
    this.notifyStateChange();
  }
  
  protected submitSuccess(): void {
    console.log('[é€šç”¨æ­¥éª¤] æäº¤æˆåŠŸ');
    this.submitting = false;
    message.success('æäº¤æˆåŠŸ');
    this.notifyStateChange();
  }
  
  protected submitError(error: any): void {
    console.error('[é€šç”¨æ­¥éª¤] æäº¤å¤±è´¥:', error);
    this.submitting = false;
    this.errors = { general: error.message || 'æäº¤å¤±è´¥' };
    message.error(error.message || 'æäº¤å¤±è´¥');
    this.notifyStateChange();
  }
  
  // æŠ½è±¡æ–¹æ³•ï¼šè¡¨å•éªŒè¯
  protected abstract validateForm(data: T): Promise<void>;
  
  // æŠ½è±¡æ–¹æ³•ï¼šæäº¤æ•°æ®
  protected abstract submit(data: T): Promise<any>;
  
  // é’©å­æ–¹æ³•ï¼šæ•°æ®é¢„å¤„ç†
  protected async preprocessData(data: T): Promise<T> {
    console.log('[é’©å­æ–¹æ³•] preprocessData');
    return data;
  }
  
  // é’©å­æ–¹æ³•ï¼šæäº¤å‰ç¡®è®¤
  protected async beforeSubmit(data: T): Promise<boolean> {
    console.log('[é’©å­æ–¹æ³•] beforeSubmit');
    return true;
  }
  
  // é’©å­æ–¹æ³•ï¼šæäº¤åå¤„ç†
  protected async afterSubmit(result: any): Promise<void> {
    console.log('[é’©å­æ–¹æ³•] afterSubmit');
  }
  
  getSubmitting(): boolean {
    return this.submitting;
  }
  
  getErrors(): Record<string, string> {
    return this.errors;
  }
}

// ç”¨æˆ·æ³¨å†Œè¡¨å•
interface RegisterData {
  username: string;
  email: string;
  password: string;
  confirmPassword: string;
}

class RegisterForm extends FormTemplate<RegisterData> {
  // å®ç°æŠ½è±¡æ–¹æ³•ï¼šè¡¨å•éªŒè¯
  protected async validateForm(data: RegisterData): Promise<void> {
    console.log('[æ³¨å†Œè¡¨å•] éªŒè¯è¡¨å•');
    
    const errors: Record<string, string> = {};
    
    if (!data.username || data.username.length < 3) {
      errors.username = 'ç”¨æˆ·åè‡³å°‘3ä¸ªå­—ç¬¦';
    }
    
    if (!data.email || !/\S+@\S+\.\S+/.test(data.email)) {
      errors.email = 'é‚®ç®±æ ¼å¼ä¸æ­£ç¡®';
    }
    
    if (!data.password || data.password.length < 8) {
      errors.password = 'å¯†ç è‡³å°‘8ä½';
    }
    
    if (data.password !== data.confirmPassword) {
      errors.confirmPassword = 'ä¸¤æ¬¡å¯†ç ä¸ä¸€è‡´';
    }
    
    if (Object.keys(errors).length > 0) {
      this.errors = errors;
      throw new Error('è¡¨å•éªŒè¯å¤±è´¥');
    }
  }
  
  // å®ç°é’©å­æ–¹æ³•ï¼šæ•°æ®é¢„å¤„ç†
  protected async preprocessData(data: RegisterData): Promise<RegisterData> {
    console.log('[æ³¨å†Œè¡¨å•] æ•°æ®é¢„å¤„ç†ï¼šç§»é™¤ confirmPassword');
    const { confirmPassword, ...processedData } = data;
    return processedData as RegisterData;
  }
  
  // å®ç°é’©å­æ–¹æ³•ï¼šæäº¤å‰ç¡®è®¤
  protected async beforeSubmit(data: RegisterData): Promise<boolean> {
    console.log('[æ³¨å†Œè¡¨å•] æäº¤å‰ç¡®è®¤');
    // è¿™é‡Œå¯ä»¥å¼¹å‡ºç¡®è®¤å¯¹è¯æ¡†
    return true;
  }
  
  // å®ç°æŠ½è±¡æ–¹æ³•ï¼šæäº¤æ•°æ®
  protected async submit(data: RegisterData): Promise<any> {
    console.log('[æ³¨å†Œè¡¨å•] æäº¤æ³¨å†Œæ•°æ®');
    
    // æ¨¡æ‹Ÿ API è¯·æ±‚
    await new Promise(resolve => setTimeout(resolve, 1500));
    
    // æ¨¡æ‹Ÿéšæœºå¤±è´¥
    if (Math.random() > 0.8) {
      throw new Error('ç”¨æˆ·åå·²å­˜åœ¨');
    }
    
    return { userId: 123, username: data.username };
  }
  
  // å®ç°é’©å­æ–¹æ³•ï¼šæäº¤åå¤„ç†
  protected async afterSubmit(result: any): Promise<void> {
    console.log('[æ³¨å†Œè¡¨å•] æäº¤åå¤„ç†ï¼šè·³è½¬åˆ°ç™»å½•é¡µ');
    // å¯ä»¥åœ¨è¿™é‡Œè·³è½¬é¡µé¢ã€æ¸…ç©ºè¡¨å•ç­‰
    message.success(`æ³¨å†ŒæˆåŠŸï¼ç”¨æˆ·ID: ${result.userId}`);
  }
}

// è”ç³»æˆ‘ä»¬è¡¨å•
interface ContactData {
  name: string;
  email: string;
  message: string;
}

class ContactForm extends FormTemplate<ContactData> {
  // å®ç°æŠ½è±¡æ–¹æ³•ï¼šè¡¨å•éªŒè¯
  protected async validateForm(data: ContactData): Promise<void> {
    console.log('[è”ç³»è¡¨å•] éªŒè¯è¡¨å•');
    
    const errors: Record<string, string> = {};
    
    if (!data.name) {
      errors.name = 'å§“åä¸èƒ½ä¸ºç©º';
    }
    
    if (!data.email || !/\S+@\S+\.\S+/.test(data.email)) {
      errors.email = 'é‚®ç®±æ ¼å¼ä¸æ­£ç¡®';
    }
    
    if (!data.message || data.message.length < 10) {
      errors.message = 'ç•™è¨€è‡³å°‘10ä¸ªå­—ç¬¦';
    }
    
    if (Object.keys(errors).length > 0) {
      this.errors = errors;
      throw new Error('è¡¨å•éªŒè¯å¤±è´¥');
    }
  }
  
  // å®ç°é’©å­æ–¹æ³•ï¼šæ•°æ®é¢„å¤„ç†
  protected async preprocessData(data: ContactData): Promise<ContactData> {
    console.log('[è”ç³»è¡¨å•] æ•°æ®é¢„å¤„ç†ï¼šæ·»åŠ æ—¶é—´æˆ³');
    return {
      ...data,
      timestamp: Date.now(),
    } as any;
  }
  
  // å®ç°æŠ½è±¡æ–¹æ³•ï¼šæäº¤æ•°æ®
  protected async submit(data: ContactData): Promise<any> {
    console.log('[è”ç³»è¡¨å•] æäº¤è”ç³»æ•°æ®');
    
    // æ¨¡æ‹Ÿ API è¯·æ±‚
    await new Promise(resolve => setTimeout(resolve, 1000));
    
    return { messageId: Date.now() };
  }
  
  // å®ç°é’©å­æ–¹æ³•ï¼šæäº¤åå¤„ç†
  protected async afterSubmit(result: any): Promise<void> {
    console.log('[è”ç³»è¡¨å•] æäº¤åå¤„ç†ï¼šå‘é€ç¡®è®¤é‚®ä»¶');
    message.success('ç•™è¨€å·²æäº¤ï¼Œæˆ‘ä»¬ä¼šå°½å¿«å›å¤æ‚¨ï¼');
  }
}

// React ç»„ä»¶
const FormTemplateDemo: React.FC = () => {
  const [formType, setFormType] = useState<'register' | 'contact'>('register');
  const [form] = Form.useForm();
  const [, forceUpdate] = useState({});
  
  const [registerForm] = useState(() => {
    const f = new RegisterForm();
    f.setStateChangeCallback(() => forceUpdate({}));
    return f;
  });
  
  const [contactForm] = useState(() => {
    const f = new ContactForm();
    f.setStateChangeCallback(() => forceUpdate({}));
    return f;
  });
  
  const currentForm = formType === 'register' ? registerForm : contactForm;
  
  const handleSubmit = async () => {
    try {
      const values = await form.validateFields();
      await currentForm.submitForm(values);
      form.resetFields();
    } catch (error) {
      console.error('è¡¨å•éªŒè¯å¤±è´¥:', error);
    }
  };
  
  return (
    <div style={{ padding: 24, backgroundColor: '#f0f2f5', minHeight: '100vh' }}>
      <Card
        title="ğŸ“ è¡¨å•æäº¤ï¼ˆæ¨¡æ¿æ–¹æ³•æ¨¡å¼ï¼‰"
        style={{ maxWidth: 800, margin: '0 auto' }}
        extra={
          <Space>
            <Button
              type={formType === 'register' ? 'primary' : 'default'}
              onClick={() => {
                setFormType('register');
                form.resetFields();
              }}
            >
              æ³¨å†Œè¡¨å•
            </Button>
            <Button
              type={formType === 'contact' ? 'primary' : 'default'}
              onClick={() => {
                setFormType('contact');
                form.resetFields();
              }}
            >
              è”ç³»è¡¨å•
            </Button>
          </Space>
        }
      >
        {/* æµç¨‹å±•ç¤º */}
        <Card type="inner" title="è¡¨å•æäº¤æµç¨‹" style={{ marginBottom: 16 }}>
          <Steps
            size="small"
            current={-1}
            items={[
              { title: 'å¼€å§‹æäº¤' },
              { title: 'è¡¨å•éªŒè¯', description: 'æŠ½è±¡æ–¹æ³•' },
              { title: 'æ•°æ®é¢„å¤„ç†', description: 'é’©å­' },
              { title: 'æäº¤å‰ç¡®è®¤', description: 'é’©å­' },
              { title: 'æäº¤æ•°æ®', description: 'æŠ½è±¡æ–¹æ³•' },
              { title: 'æäº¤åå¤„ç†', description: 'é’©å­' },
              { title: 'å®Œæˆ' },
            ]}
          />
        </Card>
        
        {/* è¡¨å• */}
        {formType === 'register' ? (
          <Form form={form} layout="vertical">
            <Form.Item label="ç”¨æˆ·å" name="username" rules={[{ required: true }]}>
              <Input placeholder="è‡³å°‘3ä¸ªå­—ç¬¦" />
            </Form.Item>
            <Form.Item label="é‚®ç®±" name="email" rules={[{ required: true, type: 'email' }]}>
              <Input placeholder="example@domain.com" />
            </Form.Item>
            <Form.Item label="å¯†ç " name="password" rules={[{ required: true }]}>
              <Input.Password placeholder="è‡³å°‘8ä½" />
            </Form.Item>
            <Form.Item label="ç¡®è®¤å¯†ç " name="confirmPassword" rules={[{ required: true }]}>
              <Input.Password placeholder="å†æ¬¡è¾“å…¥å¯†ç " />
            </Form.Item>
          </Form>
        ) : (
          <Form form={form} layout="vertical">
            <Form.Item label="å§“å" name="name" rules={[{ required: true }]}>
              <Input placeholder="è¯·è¾“å…¥æ‚¨çš„å§“å" />
            </Form.Item>
            <Form.Item label="é‚®ç®±" name="email" rules={[{ required: true, type: 'email' }]}>
              <Input placeholder="example@domain.com" />
            </Form.Item>
            <Form.Item label="ç•™è¨€" name="message" rules={[{ required: true }]}>
              <Input.TextArea rows={4} placeholder="è‡³å°‘10ä¸ªå­—ç¬¦" />
            </Form.Item>
          </Form>
        )}
        
        <Button
          type="primary"
          icon={<SaveOutlined />}
          onClick={handleSubmit}
          loading={currentForm.getSubmitting()}
          block
        >
          æäº¤
        </Button>
        
        {/* è¯´æ˜ */}
        <Card type="inner" title="ğŸ“‹ æ¨¡æ¿æ–¹æ³•æ¨¡å¼è¯´æ˜" style={{ marginTop: 16 }}>
          <ul style={{ margin: 0, paddingLeft: 20 }}>
            <li>âœ… <strong>FormTemplate</strong> å®šä¹‰äº†è¡¨å•æäº¤çš„æ¨¡æ¿æ–¹æ³•ï¼ˆsubmitFormï¼‰</li>
            <li>âœ… <strong>RegisterFormã€ContactForm</strong> å®ç°æŠ½è±¡æ–¹æ³•å’Œé’©å­æ–¹æ³•</li>
            <li>âœ… ç»Ÿä¸€çš„æäº¤æµç¨‹ï¼šéªŒè¯ â†’ é¢„å¤„ç† â†’ ç¡®è®¤ â†’ æäº¤ â†’ åå¤„ç†</li>
            <li>âœ… é’©å­æ–¹æ³•æä¾›æ‰©å±•ç‚¹ï¼Œå­ç±»å¯é€‰æ‹©æ€§å®ç°</li>
            <li>âœ… é¿å…é‡å¤çš„ loadingã€error å¤„ç†ä»£ç </li>
          </ul>
        </Card>
      </Card>
    </div>
  );
};

export default FormTemplateDemo;
```

---

### åœºæ™¯ä¸‰ï¼šæµ‹è¯•ç”¨ä¾‹æ¨¡æ¿ï¼ˆå•å…ƒæµ‹è¯•æ¡†æ¶ï¼‰

å®ç°ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹æ¨¡æ¿ï¼Œç»Ÿä¸€æµ‹è¯•æµç¨‹ï¼š

```typescript
import React, { useState } from 'react';
import { Card, Button, Space, Timeline, Tag, Progress, Alert } from 'antd';
import { PlayCircleOutlined, CheckCircleOutlined, CloseCircleOutlined } from '@ant-design/icons';

// æµ‹è¯•ç»“æœ
interface TestResult {
  testName: string;
  passed: boolean;
  message: string;
  duration: number;
}

// æµ‹è¯•ç”¨ä¾‹æ¨¡æ¿
abstract class TestCase {
  protected testName: string;
  protected logs: string[] = [];
  protected startTime: number = 0;
  
  constructor(testName: string) {
    this.testName = testName;
  }
  
  // ğŸ¯ æ¨¡æ¿æ–¹æ³•ï¼šæµ‹è¯•æ‰§è¡Œæµç¨‹
  async run(): Promise<TestResult> {
    console.log(`[æ¨¡æ¿æ–¹æ³•] å¼€å§‹æ‰§è¡Œæµ‹è¯•: ${this.testName}`);
    this.startTime = Date.now();
    
    try {
      // 1. æµ‹è¯•å‰å‡†å¤‡
      this.log('å‡†å¤‡æµ‹è¯•ç¯å¢ƒ');
      await this.setup();
      
      // 2. æ‰§è¡Œæµ‹è¯•ï¼ˆæŠ½è±¡æ–¹æ³•ï¼‰
      this.log('æ‰§è¡Œæµ‹è¯•ç”¨ä¾‹');
      await this.runTest();
      
      // 3. æµ‹è¯•åæ¸…ç†
      this.log('æ¸…ç†æµ‹è¯•ç¯å¢ƒ');
      await this.teardown();
      
      const duration = Date.now() - this.startTime;
      this.log(`æµ‹è¯•é€šè¿‡ (${duration}ms)`);
      
      return {
        testName: this.testName,
        passed: true,
        message: 'æµ‹è¯•é€šè¿‡',
        duration,
      };
    } catch (error: any) {
      const duration = Date.now() - this.startTime;
      this.log(`æµ‹è¯•å¤±è´¥: ${error.message} (${duration}ms)`);
      
      // å³ä½¿æµ‹è¯•å¤±è´¥ï¼Œä¹Ÿè¦æ‰§è¡Œæ¸…ç†
      try {
        await this.teardown();
      } catch (cleanupError) {
        this.log('æ¸…ç†å¤±è´¥');
      }
      
      return {
        testName: this.testName,
        passed: false,
        message: error.message,
        duration,
      };
    }
  }
  
  // å…·ä½“æ–¹æ³•ï¼šæ—¥å¿—è®°å½•
  protected log(message: string): void {
    const timestamp = new Date().toLocaleTimeString();
    this.logs.push(`[${timestamp}] ${message}`);
    console.log(`[${this.testName}] ${message}`);
  }
  
  // å…·ä½“æ–¹æ³•ï¼šæ–­è¨€
  protected assert(condition: boolean, message: string): void {
    if (!condition) {
      throw new Error(`æ–­è¨€å¤±è´¥: ${message}`);
    }
    this.log(`âœ“ ${message}`);
  }
  
  // é’©å­æ–¹æ³•ï¼šæµ‹è¯•å‰å‡†å¤‡
  protected async setup(): Promise<void> {
    this.log('[é’©å­] setup - é»˜è®¤å®ç°');
  }
  
  // æŠ½è±¡æ–¹æ³•ï¼šæ‰§è¡Œæµ‹è¯•
  protected abstract runTest(): Promise<void>;
  
  // é’©å­æ–¹æ³•ï¼šæµ‹è¯•åæ¸…ç†
  protected async teardown(): Promise<void> {
    this.log('[é’©å­] teardown - é»˜è®¤å®ç°');
  }
  
  getLogs(): string[] {
    return this.logs;
  }
}

// å…·ä½“æµ‹è¯•ï¼šç”¨æˆ·æ³¨å†Œæµ‹è¯•
class UserRegistrationTest extends TestCase {
  private mockUser: any;
  
  constructor() {
    super('ç”¨æˆ·æ³¨å†ŒåŠŸèƒ½æµ‹è¯•');
  }
  
  // å®ç°é’©å­ï¼šå‡†å¤‡æµ‹è¯•æ•°æ®
  protected async setup(): Promise<void> {
    this.log('å‡†å¤‡æµ‹è¯•ç”¨æˆ·æ•°æ®');
    this.mockUser = {
      username: 'testuser',
      email: 'test@example.com',
      password: 'password123',
    };
    await new Promise(resolve => setTimeout(resolve, 300));
  }
  
  // å®ç°æŠ½è±¡æ–¹æ³•ï¼šæ‰§è¡Œæµ‹è¯•
  protected async runTest(): Promise<void> {
    this.log('æµ‹è¯•ç”¨æˆ·åéªŒè¯');
    this.assert(this.mockUser.username.length >= 3, 'ç”¨æˆ·åé•¿åº¦ >= 3');
    
    this.log('æµ‹è¯•é‚®ç®±æ ¼å¼éªŒè¯');
    this.assert(
      /\S+@\S+\.\S+/.test(this.mockUser.email),
      'é‚®ç®±æ ¼å¼æ­£ç¡®'
    );
    
    this.log('æµ‹è¯•å¯†ç å¼ºåº¦éªŒè¯');
    this.assert(this.mockUser.password.length >= 8, 'å¯†ç é•¿åº¦ >= 8');
    
    this.log('æ¨¡æ‹Ÿæ³¨å†Œ API è°ƒç”¨');
    await new Promise(resolve => setTimeout(resolve, 500));
    
    // æ¨¡æ‹Ÿéšæœºå¤±è´¥
    if (Math.random() > 0.7) {
      throw new Error('API è°ƒç”¨å¤±è´¥');
    }
    
    this.log('éªŒè¯æ³¨å†Œç»“æœ');
    this.assert(true, 'æ³¨å†ŒæˆåŠŸ');
  }
  
  // å®ç°é’©å­ï¼šæ¸…ç†æµ‹è¯•æ•°æ®
  protected async teardown(): Promise<void> {
    this.log('æ¸…ç†æµ‹è¯•ç”¨æˆ·æ•°æ®');
    this.mockUser = null;
    await new Promise(resolve => setTimeout(resolve, 200));
  }
}

// å…·ä½“æµ‹è¯•ï¼šè®¢å•åˆ›å»ºæµ‹è¯•
class OrderCreationTest extends TestCase {
  private mockOrder: any;
  
  constructor() {
    super('è®¢å•åˆ›å»ºåŠŸèƒ½æµ‹è¯•');
  }
  
  protected async setup(): Promise<void> {
    this.log('å‡†å¤‡æµ‹è¯•è®¢å•æ•°æ®');
    this.mockOrder = {
      productId: 123,
      quantity: 2,
      price: 99.99,
    };
    await new Promise(resolve => setTimeout(resolve, 200));
  }
  
  protected async runTest(): Promise<void> {
    this.log('æµ‹è¯•å•†å“IDéªŒè¯');
    this.assert(this.mockOrder.productId > 0, 'å•†å“IDæœ‰æ•ˆ');
    
    this.log('æµ‹è¯•æ•°é‡éªŒè¯');
    this.assert(this.mockOrder.quantity > 0, 'æ•°é‡ > 0');
    
    this.log('æµ‹è¯•ä»·æ ¼éªŒè¯');
    this.assert(this.mockOrder.price > 0, 'ä»·æ ¼ > 0');
    
    this.log('è®¡ç®—è®¢å•æ€»é¢');
    const total = this.mockOrder.quantity * this.mockOrder.price;
    this.assert(total === 199.98, `æ€»é¢æ­£ç¡®: ${total}`);
    
    this.log('æ¨¡æ‹Ÿåˆ›å»ºè®¢å• API');
    await new Promise(resolve => setTimeout(resolve, 400));
    
    this.log('éªŒè¯è®¢å•åˆ›å»ºç»“æœ');
    this.assert(true, 'è®¢å•åˆ›å»ºæˆåŠŸ');
  }
  
  protected async teardown(): Promise<void> {
    this.log('æ¸…ç†æµ‹è¯•è®¢å•æ•°æ®');
    this.mockOrder = null;
    await new Promise(resolve => setTimeout(resolve, 100));
  }
}

// React ç»„ä»¶
const TestCaseDemo: React.FC = () => {
  const [testResults, setTestResults] = useState<TestResult[]>([]);
  const [running, setRunning] = useState(false);
  const [currentTest, setCurrentTest] = useState<TestCase | null>(null);
  const [currentLogs, setCurrentLogs] = useState<string[]>([]);
  
  const tests = [
    new UserRegistrationTest(),
    new OrderCreationTest(),
  ];
  
  const runAllTests = async () => {
    setRunning(true);
    setTestResults([]);
    
    for (const test of tests) {
      setCurrentTest(test);
      setCurrentLogs([]);
      
      const result = await test.run();
      setCurrentLogs(test.getLogs());
      setTestResults(prev => [...prev, result]);
      
      await new Promise(resolve => setTimeout(resolve, 500));
    }
    
    setCurrentTest(null);
    setRunning(false);
  };
  
  const passedCount = testResults.filter(r => r.passed).length;
  const progress = testResults.length > 0 ? (passedCount / testResults.length) * 100 : 0;
  
  return (
    <div style={{ padding: 24, backgroundColor: '#f0f2f5', minHeight: '100vh' }}>
      <Card title="ğŸ§ª æµ‹è¯•ç”¨ä¾‹ï¼ˆæ¨¡æ¿æ–¹æ³•æ¨¡å¼ï¼‰" style={{ maxWidth: 1200, margin: '0 auto' }}>
        {/* æµ‹è¯•æ§åˆ¶ */}
        <Card type="inner" style={{ marginBottom: 16 }}>
          <Space>
            <Button
              type="primary"
              icon={<PlayCircleOutlined />}
              onClick={runAllTests}
              loading={running}
              disabled={running}
            >
              è¿è¡Œæ‰€æœ‰æµ‹è¯•
            </Button>
            {testResults.length > 0 && (
              <Tag color={passedCount === testResults.length ? 'green' : 'red'}>
                {passedCount} / {testResults.length} é€šè¿‡
              </Tag>
            )}
          </Space>
          
          {testResults.length > 0 && (
            <Progress
              percent={Math.round(progress)}
              status={passedCount === testResults.length ? 'success' : 'exception'}
              style={{ marginTop: 16 }}
            />
          )}
        </Card>
        
        <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: 16 }}>
          {/* æµ‹è¯•ç»“æœ */}
          <Card type="inner" title="æµ‹è¯•ç»“æœ">
            {testResults.length === 0 ? (
              <div style={{ textAlign: 'center', color: '#999', padding: 40 }}>
                ç‚¹å‡»"è¿è¡Œæ‰€æœ‰æµ‹è¯•"å¼€å§‹æµ‹è¯•
              </div>
            ) : (
              testResults.map((result, index) => (
                <Card
                  key={index}
                  size="small"
                  style={{
                    marginBottom: 12,
                    backgroundColor: result.passed ? '#f6ffed' : '#fff2f0',
                    borderColor: result.passed ? '#b7eb8f' : '#ffccc7',
                  }}
                >
                  <Space direction="vertical" style={{ width: '100%' }}>
                    <Space>
                      {result.passed ? (
                        <CheckCircleOutlined style={{ color: '#52c41a', fontSize: 20 }} />
                      ) : (
                        <CloseCircleOutlined style={{ color: '#ff4d4f', fontSize: 20 }} />
                      )}
                      <strong>{result.testName}</strong>
                    </Space>
                    <div style={{ fontSize: 12, color: '#666' }}>
                      {result.message} ({result.duration}ms)
                    </div>
                  </Space>
                </Card>
              ))
            )}
          </Card>
          
          {/* æ‰§è¡Œæ—¥å¿— */}
          <Card type="inner" title="æ‰§è¡Œæ—¥å¿—">
            {currentLogs.length === 0 && !currentTest ? (
              <div style={{ textAlign: 'center', color: '#999', padding: 40 }}>
                ç­‰å¾…æµ‹è¯•æ‰§è¡Œ...
              </div>
            ) : (
              <Timeline
                items={currentLogs.map((log, index) => ({
                  children: <div style={{ fontSize: 12 }}>{log}</div>,
                  color: log.includes('âœ“') ? 'green' : log.includes('å¤±è´¥') ? 'red' : 'blue',
                }))}
              />
            )}
          </Card>
        </div>
        
        {/* è¯´æ˜ */}
        <Card type="inner" title="ğŸ“‹ æ¨¡æ¿æ–¹æ³•æ¨¡å¼è¯´æ˜" style={{ marginTop: 16 }}>
          <ul style={{ margin: 0, paddingLeft: 20 }}>
            <li>âœ… <strong>TestCase</strong> å®šä¹‰äº†æµ‹è¯•æ‰§è¡Œçš„æ¨¡æ¿æ–¹æ³•ï¼ˆrunï¼‰</li>
            <li>âœ… ç»Ÿä¸€çš„æµ‹è¯•æµç¨‹ï¼š<Tag>setup</Tag> â†’ <Tag>runTest</Tag> â†’ <Tag>teardown</Tag></li>
            <li>âœ… å­ç±»åªéœ€å®ç° runTestï¼ˆæµ‹è¯•é€»è¾‘ï¼‰ï¼Œsetup å’Œ teardown æ˜¯å¯é€‰çš„</li>
            <li>âœ… å³ä½¿æµ‹è¯•å¤±è´¥ï¼Œteardown ä¹Ÿä¼šæ‰§è¡Œï¼ˆæ¸…ç†èµ„æºï¼‰</li>
            <li>âœ… ç»Ÿä¸€çš„æ—¥å¿—è®°å½•å’Œæ–­è¨€æ–¹æ³•</li>
          </ul>
        </Card>
      </Card>
    </div>
  );
};

export default TestCaseDemo;
```

## æ¨¡å¼æ€»ç»“

### âœ… ä¼˜ç‚¹

1. **ä»£ç å¤ç”¨**ï¼šå…¬å…±æµç¨‹åœ¨çˆ¶ç±»å®ç°ï¼Œé¿å…é‡å¤
2. **æµç¨‹ç»Ÿä¸€**ï¼šæ‰€æœ‰å­ç±»éµå¾ªç›¸åŒçš„æµç¨‹
3. **æ˜“äºç»´æŠ¤**ï¼šä¿®æ”¹æµç¨‹åªéœ€æ”¹çˆ¶ç±»
4. **ç¬¦åˆå¼€é—­åŸåˆ™**ï¼šå¯¹æ‰©å±•å¼€æ”¾ï¼ˆå­ç±»å®ç°ç»†èŠ‚ï¼‰ï¼Œå¯¹ä¿®æ”¹å…³é—­ï¼ˆæµç¨‹å›ºå®šï¼‰
5. **æ§åˆ¶åè½¬**ï¼šçˆ¶ç±»æ§åˆ¶æµç¨‹ï¼Œå­ç±»å®ç°ç»†èŠ‚

### âŒ ç¼ºç‚¹

1. **å¢åŠ å¤æ‚åº¦**ï¼šç®€å•åœºæ™¯ä½¿ç”¨æ¨¡æ¿æ–¹æ³•å¯èƒ½è¿‡åº¦è®¾è®¡
2. **ç»§æ‰¿é™åˆ¶**ï¼šå¿…é¡»é€šè¿‡ç»§æ‰¿ä½¿ç”¨ï¼Œçµæ´»æ€§å—é™
3. **å­ç±»æ•°é‡å¢åŠ **ï¼šæ¯ç§å˜ä½“éƒ½éœ€è¦ä¸€ä¸ªå­ç±»
4. **è°ƒè¯•å›°éš¾**ï¼šæµç¨‹åœ¨çˆ¶ç±»ï¼Œç»†èŠ‚åœ¨å­ç±»ï¼Œè°ƒè¯•æ—¶éœ€è¦è·³è½¬

### ğŸ¯ é€‚ç”¨åœºæ™¯

æ¨¡æ¿æ–¹æ³•æ¨¡å¼ç‰¹åˆ«é€‚åˆä»¥ä¸‹å‰ç«¯åœºæ™¯ï¼š

| åœºæ™¯ | è¯´æ˜ | å…¸å‹æµç¨‹ |
|------|------|---------|
| **é¡µé¢åŠ è½½** | ç»Ÿä¸€çš„æ•°æ®åŠ è½½æµç¨‹ | loading â†’ fetch â†’ transform â†’ render |
| **è¡¨å•æäº¤** | ç»Ÿä¸€çš„è¡¨å•å¤„ç†æµç¨‹ | validate â†’ preprocess â†’ submit â†’ callback |
| **ç»„ä»¶ç”Ÿå‘½å‘¨æœŸ** | React/Vue ç”Ÿå‘½å‘¨æœŸ | mount â†’ update â†’ unmount |
| **æµ‹è¯•ç”¨ä¾‹** | å•å…ƒæµ‹è¯•æ¡†æ¶ | setup â†’ test â†’ teardown |
| **æ•°æ®å¯¼å…¥å¯¼å‡º** | ç»Ÿä¸€çš„æ•°æ®å¤„ç†æµç¨‹ | read â†’ validate â†’ transform â†’ save |
| **HTTP è¯·æ±‚** | ç»Ÿä¸€çš„è¯·æ±‚å¤„ç† | before â†’ request â†’ after â†’ error |
| **åŠ¨ç”»æµç¨‹** | ç»Ÿä¸€çš„åŠ¨ç”»æ‰§è¡Œ | prepare â†’ animate â†’ complete |

### ğŸ¤” ä»€ä¹ˆæ—¶å€™è¯¥ç”¨æ¨¡æ¿æ–¹æ³•æ¨¡å¼ï¼Ÿ

**ä¸‰ä¸ªåˆ¤æ–­æ ‡å‡†ï¼š**

1. **æœ‰å›ºå®šçš„æµç¨‹å—ï¼Ÿ**
   - æ­¥éª¤é¡ºåºæ˜¯å›ºå®šçš„

2. **æµç¨‹çš„æ­¥éª¤æœ‰å˜åŒ–å—ï¼Ÿ**
   - ä¸åŒåœºæ™¯ä¸‹ï¼ŒæŸäº›æ­¥éª¤çš„å®ç°ä¸åŒ

3. **æµç¨‹éœ€è¦ç»Ÿä¸€ç®¡ç†å—ï¼Ÿ**
   - éœ€è¦ä¿è¯æ‰€æœ‰åœºæ™¯çš„æµç¨‹ä¸€è‡´

**å¿«é€Ÿå†³ç­–æ ‘ï¼š**

```
æœ‰å›ºå®šçš„æµç¨‹éª¨æ¶å—ï¼Ÿ
    â”œâ”€ æ˜¯ â†’ æµç¨‹ä¸­æŸäº›æ­¥éª¤éœ€è¦ä¸åŒå®ç°å—ï¼Ÿ
    â”‚        â”œâ”€ æ˜¯ â†’ éœ€è¦å¼ºåˆ¶ç»Ÿä¸€æµç¨‹å—ï¼Ÿ
    â”‚        â”‚        â”œâ”€ æ˜¯ â†’ âœ… ç”¨æ¨¡æ¿æ–¹æ³•æ¨¡å¼ï¼
    â”‚        â”‚        â””â”€ å¦ â†’ ğŸ¤” è€ƒè™‘ç­–ç•¥æ¨¡å¼
    â”‚        â””â”€ å¦ â†’ âŒ ä¸éœ€è¦å˜åŒ–ï¼Œç›´æ¥å†™æ–¹æ³•
    â””â”€ å¦ â†’ âŒ ä¸éœ€è¦
```

### ğŸ†š æ¨¡æ¿æ–¹æ³•æ¨¡å¼ vs ç­–ç•¥æ¨¡å¼

| ç‰¹å¾ | æ¨¡æ¿æ–¹æ³•æ¨¡å¼ | ç­–ç•¥æ¨¡å¼ |
|------|-------------|---------|
| **ç›®çš„** | å®šä¹‰ç®—æ³•éª¨æ¶ï¼Œéƒ¨åˆ†æ­¥éª¤å­ç±»å®ç° | å°è£…å¯äº’æ¢çš„ç®—æ³• |
| **å®ç°æ–¹å¼** | ç»§æ‰¿ï¼ˆçˆ¶ç±»å®šä¹‰æµç¨‹ï¼‰ | ç»„åˆï¼ˆä¼ å…¥ç­–ç•¥å¯¹è±¡ï¼‰ |
| **æµç¨‹æ§åˆ¶** | çˆ¶ç±»æ§åˆ¶æµç¨‹ | å®¢æˆ·ç«¯æ§åˆ¶é€‰æ‹© |
| **çµæ´»æ€§** | è¾ƒä½ï¼ˆå¿…é¡»ç»§æ‰¿ï¼‰ | è¾ƒé«˜ï¼ˆå¯åŠ¨æ€åˆ‡æ¢ï¼‰ |
| **å…¸å‹åœºæ™¯** | å›ºå®šæµç¨‹ï¼Œç»†èŠ‚ä¸åŒ | ç®—æ³•å¯äº’æ¢ |
| **ä¾‹å­** | é¡µé¢åŠ è½½æµç¨‹ã€æµ‹è¯•ç”¨ä¾‹ | æ”¯ä»˜æ–¹å¼ã€æ’åºç®—æ³• |

### ğŸ’¡ å‰ç«¯æ¡†æ¶ä¸­çš„æ¨¡æ¿æ–¹æ³•æ¨¡å¼

#### 1. React ç»„ä»¶ç”Ÿå‘½å‘¨æœŸï¼ˆç±»ç»„ä»¶ï¼‰

```typescript
class Component {
  // æ¨¡æ¿æ–¹æ³•ï¼ˆReact å†…éƒ¨è°ƒç”¨ï¼‰
  private internalRender() {
    this.componentWillMount();    // é’©å­
    const element = this.render(); // æŠ½è±¡æ–¹æ³•ï¼ˆå­ç±»å®ç°ï¼‰
    this.componentDidMount();      // é’©å­
    return element;
  }
  
  // å­ç±»å®ç°
  render() {
    throw new Error('å¿…é¡»å®ç° render æ–¹æ³•');
  }
  
  // é’©å­æ–¹æ³•
  componentWillMount() {}
  componentDidMount() {}
}
```

#### 2. Vue ç»„ä»¶ç”Ÿå‘½å‘¨æœŸ

```typescript
class VueComponent {
  // æ¨¡æ¿æ–¹æ³•ï¼ˆVue å†…éƒ¨è°ƒç”¨ï¼‰
  private mount() {
    this.beforeCreate();  // é’©å­
    this.created();       // é’©å­
    this.beforeMount();   // é’©å­
    // æ¸²æŸ“ DOM
    this.mounted();       // é’©å­
  }
  
  // å­ç±»å¯ä»¥é‡å†™è¿™äº›é’©å­
  beforeCreate() {}
  created() {}
  beforeMount() {}
  mounted() {}
}
```

#### 3. Express è·¯ç”±å¤„ç†

```typescript
// Express å†…éƒ¨çš„è·¯ç”±å¤„ç†å°±æ˜¯æ¨¡æ¿æ–¹æ³•
class Route {
  handle(req, res) {
    // 1. å‰ç½®ä¸­é—´ä»¶
    this.runMiddlewares(req, res);
    
    // 2. è·¯ç”±å¤„ç†ï¼ˆç”±å¼€å‘è€…å®ç°ï¼‰
    this.handler(req, res);
    
    // 3. åç½®å¤„ç†
    this.afterHandle(req, res);
  }
}
```

---

## ğŸ’¬ å°ç»“

æ¨¡æ¿æ–¹æ³•æ¨¡å¼å°±åƒ"å¡«ç©ºé¢˜"ï¼Œçˆ¶ç±»å®šä¹‰äº†é¢˜ç›®çš„éª¨æ¶ï¼Œå­ç±»åªéœ€è¦å¡«å…¥å…·ä½“ç­”æ¡ˆã€‚æµç¨‹æ˜¯å›ºå®šçš„ï¼Œä½†æ¯ä¸ªç©ºçš„å†…å®¹å¯ä»¥ä¸åŒã€‚

åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œæ¨¡æ¿æ–¹æ³•æ¨¡å¼èƒ½è®©ä½ çš„ä»£ç ï¼š
- ä»"æ¯ä¸ªé¡µé¢é‡å¤å†™æµç¨‹"å˜æˆ"ç»§æ‰¿æ¨¡æ¿è‡ªåŠ¨æ‹¥æœ‰æµç¨‹"
- ä»"æµç¨‹ä¸ç»Ÿä¸€"å˜æˆ"å¼ºåˆ¶ç»Ÿä¸€æµç¨‹"
- ä»"ä¿®æ”¹æµç¨‹è¦æ”¹å¤šå¤„"å˜æˆ"ä¿®æ”¹çˆ¶ç±»ä¸€å¤„å³å¯"

**è®°ä½ä¸€å¥è¯**ï¼šå½“ä½ æœ‰ä¸€ä¸ªå›ºå®šçš„æµç¨‹ï¼Œä½†å…¶ä¸­æŸäº›æ­¥éª¤éœ€è¦ä¸åŒå®ç°æ—¶ï¼Œå°±è¯¥è€ƒè™‘æ¨¡æ¿æ–¹æ³•æ¨¡å¼äº†ï¼

---

> ğŸ’¡ **æ€è€ƒé¢˜**ï¼š
> 1. æ¨¡æ¿æ–¹æ³•æ¨¡å¼å’Œç­–ç•¥æ¨¡å¼æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ
> 2. React çš„ç±»ç»„ä»¶ç”Ÿå‘½å‘¨æœŸæ˜¯æ¨¡æ¿æ–¹æ³•æ¨¡å¼å—ï¼Ÿ
> 3. å¦‚ä½•åœ¨ä¸ä½¿ç”¨ç»§æ‰¿çš„æƒ…å†µä¸‹å®ç°ç±»ä¼¼æ¨¡æ¿æ–¹æ³•çš„æ•ˆæœï¼Ÿï¼ˆæç¤ºï¼šç»„åˆã€é«˜é˜¶å‡½æ•°ï¼‰

---

> ğŸ“š **ç›¸å…³æ¨¡å¼**ï¼š
> - ç­–ç•¥æ¨¡å¼ï¼ˆStrategyï¼‰ï¼šéƒ½æ¶‰åŠç®—æ³•ï¼Œä½†ç­–ç•¥æ¨¡å¼é€šè¿‡ç»„åˆï¼Œæ¨¡æ¿æ–¹æ³•é€šè¿‡ç»§æ‰¿
> - å·¥å‚æ–¹æ³•æ¨¡å¼ï¼ˆFactory Methodï¼‰ï¼šå·¥å‚æ–¹æ³•æ˜¯æ¨¡æ¿æ–¹æ³•çš„ç‰¹ä¾‹
> - è£…é¥°å™¨æ¨¡å¼ï¼ˆDecoratorï¼‰ï¼šéƒ½å¯ä»¥æ‰©å±•åŠŸèƒ½ï¼Œä½†è£…é¥°å™¨æ˜¯åŠ¨æ€çš„

