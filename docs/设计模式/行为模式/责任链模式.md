# è´£ä»»é“¾æ¨¡å¼ï¼ˆChain of Responsibility Patternï¼‰

> ã€Šå‰ç«¯è®¾è®¡æ¨¡å¼å®æˆ˜æ‰‹å†Œã€‹ç³»åˆ— - ç¬¬å…«ç« 

---

## ä¸€å¥è¯å¤§ç™½è¯

**å°±åƒå…¬å¸è¯·å‡å®¡æ‰¹**ï¼šè¯·1å¤©å‡æ‰¾ç»„é•¿æ‰¹ï¼Œè¯·3å¤©å‡è¦éƒ¨é—¨ç»ç†æ‰¹ï¼Œè¯·7å¤©ä»¥ä¸Šè¦æ€»ç›‘æ‰¹ã€‚ä½ åªéœ€è¦æäº¤è¯·å‡ç”³è¯·ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æŒ‰é“¾æ¡ä¼ é€’ï¼Œæ‰¾åˆ°æœ‰æƒé™å®¡æ‰¹çš„äººã€‚ä½ ä¸éœ€è¦çŸ¥é“è°æ¥æ‰¹ï¼Œç³»ç»Ÿè‡ªå·±ä¼šä¼ ä¸‹å»ã€‚

## å‰ç«¯ç—›ç‚¹

æƒ³è±¡ä¸€ä¸‹ï¼Œä½ åœ¨åšä¸€ä¸ªè¡¨å•éªŒè¯ç³»ç»Ÿï¼Œæœ‰å¤šå±‚éªŒè¯è§„åˆ™ï¼š

```typescript
// âŒ æ²¡æœ‰ä½¿ç”¨è´£ä»»é“¾æ¨¡å¼çš„ä»£ç ï¼šå¤šå±‚åµŒå¥—åˆ¤æ–­
function validateForm(data: FormData): string | null {
  // ç¬¬ä¸€å±‚ï¼šå¿…å¡«æ ¡éªŒ
  if (!data.username) {
    return 'ç”¨æˆ·åä¸èƒ½ä¸ºç©º';
  }
  if (!data.email) {
    return 'é‚®ç®±ä¸èƒ½ä¸ºç©º';
  }
  if (!data.password) {
    return 'å¯†ç ä¸èƒ½ä¸ºç©º';
  }
  
  // ç¬¬äºŒå±‚ï¼šæ ¼å¼æ ¡éªŒ
  if (data.username.length < 3) {
    return 'ç”¨æˆ·åè‡³å°‘3ä¸ªå­—ç¬¦';
  }
  const emailReg = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  if (!emailReg.test(data.email)) {
    return 'é‚®ç®±æ ¼å¼ä¸æ­£ç¡®';
  }
  if (data.password.length < 8) {
    return 'å¯†ç è‡³å°‘8ä½';
  }
  
  // ç¬¬ä¸‰å±‚ï¼šä¸šåŠ¡è§„åˆ™æ ¡éªŒ
  if (data.username === 'admin') {
    return 'ç”¨æˆ·åä¸èƒ½ä¸º admin';
  }
  if (data.email.endsWith('@test.com')) {
    return 'ä¸å…è®¸ä½¿ç”¨æµ‹è¯•é‚®ç®±';
  }
  
  // ç¬¬å››å±‚ï¼šå¼‚æ­¥æ ¡éªŒï¼ˆç”¨æˆ·åæ˜¯å¦å·²å­˜åœ¨ï¼‰
  // ... è¿™é‡Œè¿˜è¦åŠ  async/await
  
  // æ¯å¢åŠ ä¸€å±‚æ ¡éªŒï¼Œè¿™ä¸ªå‡½æ•°å°±è¶Šæ¥è¶Šé•¿ï¼
  return null;
}
```

**è¿™æ®µä»£ç çš„é—®é¢˜ï¼š**
1. ğŸ”— **æ‰€æœ‰é€»è¾‘è€¦åˆ**ï¼šæ‰€æœ‰æ ¡éªŒè§„åˆ™éƒ½å †åœ¨ä¸€ä¸ªå‡½æ•°é‡Œï¼Œéš¾ä»¥ç»´æŠ¤
2. ğŸ”„ **éš¾ä»¥æ‰©å±•**ï¼šæ–°å¢æ ¡éªŒè§„åˆ™è¦ä¿®æ”¹æ•´ä¸ªå‡½æ•°
3. ğŸ§© **æ— æ³•å¤ç”¨**ï¼šæ ¡éªŒé€»è¾‘æ— æ³•åœ¨å…¶ä»–åœ°æ–¹å¤ç”¨
4. ğŸš« **é¡ºåºå›ºå®š**ï¼šæ— æ³•åŠ¨æ€è°ƒæ•´æ ¡éªŒé¡ºåº

## æ¨¡å¼æ ¸å¿ƒæ¦‚å¿µ

**è´£ä»»é“¾æ¨¡å¼çš„æœ¬è´¨**ï¼šå°†è¯·æ±‚æ²¿ç€å¤„ç†è€…é“¾ä¼ é€’ï¼Œç›´åˆ°æœ‰ä¸€ä¸ªå¤„ç†è€…å¤„ç†å®ƒä¸ºæ­¢ã€‚æ¯ä¸ªå¤„ç†è€…éƒ½æœ‰æœºä¼šå¤„ç†è¯·æ±‚ï¼Œæˆ–è€…å°†è¯·æ±‚ä¼ é€’ç»™ä¸‹ä¸€ä¸ªå¤„ç†è€…ã€‚

**ä¸‰ä¸ªæ ¸å¿ƒè§’è‰²ï¼š**
- **å¤„ç†è€…ï¼ˆHandlerï¼‰**ï¼šå®šä¹‰å¤„ç†è¯·æ±‚çš„æ¥å£ï¼ŒåŒ…å«æŒ‡å‘ä¸‹ä¸€ä¸ªå¤„ç†è€…çš„å¼•ç”¨
- **å…·ä½“å¤„ç†è€…ï¼ˆConcreteHandlerï¼‰**ï¼šå®ç°å¤„ç†é€»è¾‘ï¼Œå†³å®šæ˜¯å¦å¤„ç†æˆ–ä¼ é€’ç»™ä¸‹ä¸€ä¸ª
- **å®¢æˆ·ç«¯ï¼ˆClientï¼‰**ï¼šåˆ›å»ºè´£ä»»é“¾ï¼Œå‘èµ·è¯·æ±‚

**ç±»æ¯”**ï¼š
- ğŸ“ **è¯·å‡å®¡æ‰¹**ï¼šå‘˜å·¥ â†’ ç»„é•¿ â†’ ç»ç† â†’ æ€»ç›‘ â†’ CEO
- ğŸ“ **å®¢æœç³»ç»Ÿ**ï¼šæ™ºèƒ½å®¢æœ â†’ åˆçº§å®¢æœ â†’ é«˜çº§å®¢æœ â†’ ä¸“å®¶
- ğŸ¥ **åŒ»é™¢çœ‹ç—…**ï¼šæŒ‚å· â†’ é—¨è¯Š â†’ æ£€æŸ¥ â†’ ä¸“å®¶ä¼šè¯Š

**æ ¸å¿ƒæ¥å£ï¼š**

```typescript
abstract class Handler {
  protected nextHandler: Handler | null = null;
  
  setNext(handler: Handler): Handler {
    this.nextHandler = handler;
    return handler; // æ”¯æŒé“¾å¼è°ƒç”¨
  }
  
  abstract handle(request: any): any;
}
```

## å‰ç«¯å®æˆ˜æ¡ˆä¾‹

### åœºæ™¯ä¸€ï¼šå¤šå±‚è¡¨å•éªŒè¯ï¼ˆè´£ä»»é“¾éªŒè¯å™¨ï¼‰

æˆ‘ä»¬è¦å®ç°ä¸€ä¸ªçµæ´»çš„è¡¨å•éªŒè¯ç³»ç»Ÿï¼Œæ”¯æŒå¤šç§éªŒè¯è§„åˆ™çš„ç»„åˆï¼š

```typescript
// âœ… ä½¿ç”¨è´£ä»»é“¾æ¨¡å¼é‡æ„

import React, { useState } from 'react';
import { Card, Form, Input, Button, Alert, Space, Tag, message } from 'antd';
import { CheckCircleOutlined, CloseCircleOutlined } from '@ant-design/icons';

// 1ï¸âƒ£ éªŒè¯ç»“æœ
interface ValidationResult {
  valid: boolean;
  message?: string;
  field?: string;
}

// 2ï¸âƒ£ å¤„ç†è€…æŠ½è±¡ç±»
abstract class ValidationHandler {
  protected nextHandler: ValidationHandler | null = null;
  
  setNext(handler: ValidationHandler): ValidationHandler {
    this.nextHandler = handler;
    return handler; // æ”¯æŒé“¾å¼è°ƒç”¨
  }
  
  // å¤„ç†éªŒè¯è¯·æ±‚
  handle(data: any): ValidationResult {
    // å…ˆè‡ªå·±éªŒè¯
    const result = this.validate(data);
    
    // å¦‚æœéªŒè¯å¤±è´¥ï¼Œç›´æ¥è¿”å›
    if (!result.valid) {
      return result;
    }
    
    // å¦‚æœéªŒè¯æˆåŠŸä¸”æœ‰ä¸‹ä¸€ä¸ªå¤„ç†è€…ï¼Œç»§ç»­ä¼ é€’
    if (this.nextHandler) {
      return this.nextHandler.handle(data);
    }
    
    // æ²¡æœ‰ä¸‹ä¸€ä¸ªå¤„ç†è€…äº†ï¼ŒéªŒè¯é€šè¿‡
    return { valid: true };
  }
  
  // å­ç±»å®ç°å…·ä½“éªŒè¯é€»è¾‘
  protected abstract validate(data: any): ValidationResult;
  
  // è·å–éªŒè¯å™¨åç§°ï¼ˆç”¨äºå±•ç¤ºï¼‰
  abstract getName(): string;
}

// 3ï¸âƒ£ å…·ä½“å¤„ç†è€…ï¼šå¿…å¡«æ ¡éªŒ
class RequiredValidator extends ValidationHandler {
  protected validate(data: any): ValidationResult {
    console.log('[å¿…å¡«æ ¡éªŒ] æ‰§è¡Œ');
    
    if (!data.username || !data.username.trim()) {
      return { valid: false, message: 'ç”¨æˆ·åä¸èƒ½ä¸ºç©º', field: 'username' };
    }
    if (!data.email || !data.email.trim()) {
      return { valid: false, message: 'é‚®ç®±ä¸èƒ½ä¸ºç©º', field: 'email' };
    }
    if (!data.password || !data.password.trim()) {
      return { valid: false, message: 'å¯†ç ä¸èƒ½ä¸ºç©º', field: 'password' };
    }
    
    return { valid: true };
  }
  
  getName(): string {
    return 'å¿…å¡«æ ¡éªŒ';
  }
}

// 4ï¸âƒ£ å…·ä½“å¤„ç†è€…ï¼šé•¿åº¦æ ¡éªŒ
class LengthValidator extends ValidationHandler {
  protected validate(data: any): ValidationResult {
    console.log('[é•¿åº¦æ ¡éªŒ] æ‰§è¡Œ');
    
    if (data.username && data.username.length < 3) {
      return { valid: false, message: 'ç”¨æˆ·åè‡³å°‘3ä¸ªå­—ç¬¦', field: 'username' };
    }
    if (data.username && data.username.length > 20) {
      return { valid: false, message: 'ç”¨æˆ·åæœ€å¤š20ä¸ªå­—ç¬¦', field: 'username' };
    }
    if (data.password && data.password.length < 8) {
      return { valid: false, message: 'å¯†ç è‡³å°‘8ä½', field: 'password' };
    }
    
    return { valid: true };
  }
  
  getName(): string {
    return 'é•¿åº¦æ ¡éªŒ';
  }
}

// 5ï¸âƒ£ å…·ä½“å¤„ç†è€…ï¼šæ ¼å¼æ ¡éªŒ
class FormatValidator extends ValidationHandler {
  protected validate(data: any): ValidationResult {
    console.log('[æ ¼å¼æ ¡éªŒ] æ‰§è¡Œ');
    
    // ç”¨æˆ·åæ ¼å¼ï¼šå­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿
    const usernameReg = /^[a-zA-Z0-9_]+$/;
    if (data.username && !usernameReg.test(data.username)) {
      return { 
        valid: false, 
        message: 'ç”¨æˆ·ååªèƒ½åŒ…å«å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿', 
        field: 'username' 
      };
    }
    
    // é‚®ç®±æ ¼å¼
    const emailReg = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (data.email && !emailReg.test(data.email)) {
      return { valid: false, message: 'é‚®ç®±æ ¼å¼ä¸æ­£ç¡®', field: 'email' };
    }
    
    // å¯†ç æ ¼å¼ï¼šå¿…é¡»åŒ…å«æ•°å­—å’Œå­—æ¯
    const hasNumber = /\d/.test(data.password);
    const hasLetter = /[a-zA-Z]/.test(data.password);
    if (data.password && (!hasNumber || !hasLetter)) {
      return { 
        valid: false, 
        message: 'å¯†ç å¿…é¡»åŒ…å«æ•°å­—å’Œå­—æ¯', 
        field: 'password' 
      };
    }
    
    return { valid: true };
  }
  
  getName(): string {
    return 'æ ¼å¼æ ¡éªŒ';
  }
}

// 6ï¸âƒ£ å…·ä½“å¤„ç†è€…ï¼šä¸šåŠ¡è§„åˆ™æ ¡éªŒ
class BusinessRuleValidator extends ValidationHandler {
  protected validate(data: any): ValidationResult {
    console.log('[ä¸šåŠ¡è§„åˆ™æ ¡éªŒ] æ‰§è¡Œ');
    
    // é»‘åå•ç”¨æˆ·å
    const blacklist = ['admin', 'root', 'system', 'test'];
    if (data.username && blacklist.includes(data.username.toLowerCase())) {
      return { 
        valid: false, 
        message: `ç”¨æˆ·å "${data.username}" ä¸å¯ç”¨`, 
        field: 'username' 
      };
    }
    
    // ç¦æ­¢æµ‹è¯•é‚®ç®±
    if (data.email && data.email.endsWith('@test.com')) {
      return { 
        valid: false, 
        message: 'ä¸å…è®¸ä½¿ç”¨æµ‹è¯•é‚®ç®±', 
        field: 'email' 
      };
    }
    
    // å¼±å¯†ç æ£€æµ‹
    const weakPasswords = ['12345678', 'password', 'qwerty123'];
    if (data.password && weakPasswords.includes(data.password.toLowerCase())) {
      return { 
        valid: false, 
        message: 'å¯†ç è¿‡äºç®€å•ï¼Œè¯·ä½¿ç”¨æ›´å¼ºçš„å¯†ç ', 
        field: 'password' 
      };
    }
    
    return { valid: true };
  }
  
  getName(): string {
    return 'ä¸šåŠ¡è§„åˆ™æ ¡éªŒ';
  }
}

// 7ï¸âƒ£ å…·ä½“å¤„ç†è€…ï¼šå¼‚æ­¥æ ¡éªŒï¼ˆæ¨¡æ‹Ÿæ£€æŸ¥ç”¨æˆ·åæ˜¯å¦å·²å­˜åœ¨ï¼‰
class AsyncValidator extends ValidationHandler {
  protected validate(data: any): ValidationResult {
    console.log('[å¼‚æ­¥æ ¡éªŒ] è·³è¿‡ï¼ˆåœ¨è´£ä»»é“¾ä¸­ä¸ºåŒæ­¥ï¼Œå®é™…å¯æ”¹ä¸º asyncï¼‰');
    // æ³¨ï¼šè¿™é‡Œç®€åŒ–å¤„ç†ï¼Œå®é™…å¯ä»¥æ”¹ä¸º async/await
    return { valid: true };
  }
  
  getName(): string {
    return 'å¼‚æ­¥æ ¡éªŒ';
  }
}

// 8ï¸âƒ£ React ç»„ä»¶
const ChainValidationForm: React.FC = () => {
  const [form] = Form.useForm();
  const [validationResult, setValidationResult] = useState<ValidationResult | null>(null);
  const [validationChain, setValidationChain] = useState<ValidationHandler[]>([]);
  const [currentValidator, setCurrentValidator] = useState<string>('');
  
  // åˆå§‹åŒ–è´£ä»»é“¾
  React.useEffect(() => {
    const required = new RequiredValidator();
    const length = new LengthValidator();
    const format = new FormatValidator();
    const businessRule = new BusinessRuleValidator();
    const async = new AsyncValidator();
    
    // é“¾æ¥å¤„ç†è€…ï¼ˆé“¾å¼è°ƒç”¨ï¼‰
    required
      .setNext(length)
      .setNext(format)
      .setNext(businessRule)
      .setNext(async);
    
    setValidationChain([required, length, format, businessRule, async]);
  }, []);
  
  // æäº¤è¡¨å•
  const handleSubmit = async () => {
    try {
      const values = await form.validateFields();
      
      // ä½¿ç”¨è´£ä»»é“¾éªŒè¯
      if (validationChain.length > 0) {
        setCurrentValidator('å¼€å§‹éªŒè¯...');
        
        const result = validationChain[0].handle(values);
        
        setValidationResult(result);
        setCurrentValidator('éªŒè¯å®Œæˆ');
        
        if (result.valid) {
          message.success('è¡¨å•éªŒè¯é€šè¿‡ï¼');
        } else {
          message.error(result.message || 'éªŒè¯å¤±è´¥');
          
          // å®šä½åˆ°é”™è¯¯å­—æ®µ
          if (result.field) {
            form.scrollToField(result.field);
          }
        }
      }
    } catch (error) {
      console.error('è¡¨å•æ ¡éªŒå¤±è´¥:', error);
    }
  };
  
  return (
    <div style={{ padding: 24, backgroundColor: '#f0f2f5', minHeight: '100vh' }}>
      <Card title="ğŸ“ è¡¨å•éªŒè¯ï¼ˆè´£ä»»é“¾æ¨¡å¼ï¼‰" style={{ maxWidth: 800, margin: '0 auto' }}>
        {/* è´£ä»»é“¾å±•ç¤º */}
        <Card type="inner" title="éªŒè¯è´£ä»»é“¾" style={{ marginBottom: 16 }}>
          <Space wrap>
            {validationChain.map((validator, index) => (
              <Tag key={index} color="blue">
                {index + 1}. {validator.getName()}
              </Tag>
            ))}
          </Space>
          <div style={{ marginTop: 12, color: '#666', fontSize: 12 }}>
            ğŸ’¡ éªŒè¯æŒ‰é“¾æ¡é¡ºåºæ‰§è¡Œï¼Œé‡åˆ°ç¬¬ä¸€ä¸ªå¤±è´¥çš„è§„åˆ™å°±åœæ­¢
          </div>
        </Card>
        
        {/* è¡¨å• */}
        <Form form={form} layout="vertical">
          <Form.Item
            label="ç”¨æˆ·å"
            name="username"
            rules={[{ required: true, message: 'è¯·è¾“å…¥ç”¨æˆ·å' }]}
          >
            <Input placeholder="3-20ä¸ªå­—ç¬¦ï¼Œå­—æ¯æ•°å­—ä¸‹åˆ’çº¿" />
          </Form.Item>
          
          <Form.Item
            label="é‚®ç®±"
            name="email"
            rules={[{ required: true, message: 'è¯·è¾“å…¥é‚®ç®±' }]}
          >
            <Input placeholder="example@domain.com" />
          </Form.Item>
          
          <Form.Item
            label="å¯†ç "
            name="password"
            rules={[{ required: true, message: 'è¯·è¾“å…¥å¯†ç ' }]}
          >
            <Input.Password placeholder="è‡³å°‘8ä½ï¼ŒåŒ…å«æ•°å­—å’Œå­—æ¯" />
          </Form.Item>
          
          <Form.Item>
            <Button type="primary" onClick={handleSubmit} block>
              æäº¤ï¼ˆè´£ä»»é“¾éªŒè¯ï¼‰
            </Button>
          </Form.Item>
        </Form>
        
        {/* éªŒè¯ç»“æœ */}
        {validationResult && (
          <Alert
            type={validationResult.valid ? 'success' : 'error'}
            icon={validationResult.valid ? <CheckCircleOutlined /> : <CloseCircleOutlined />}
            message={
              validationResult.valid 
                ? 'âœ… æ‰€æœ‰éªŒè¯è§„åˆ™éƒ½é€šè¿‡äº†ï¼' 
                : validationResult.message
            }
            style={{ marginTop: 16 }}
          />
        )}
        
        {/* è¯´æ˜ */}
        <Card type="inner" title="ğŸ“‹ è´£ä»»é“¾æ¨¡å¼è¯´æ˜" style={{ marginTop: 16 }}>
          <ul style={{ margin: 0, paddingLeft: 20 }}>
            <li>âœ… <strong>ValidationHandler</strong> æ˜¯å¤„ç†è€…æŠ½è±¡ç±»</li>
            <li>âœ… <strong>RequiredValidatorã€LengthValidator ç­‰</strong> æ˜¯å…·ä½“å¤„ç†è€…</li>
            <li>âœ… æ¯ä¸ªå¤„ç†è€…å…ˆæ‰§è¡Œè‡ªå·±çš„éªŒè¯ï¼Œå¤±è´¥åˆ™åœæ­¢ï¼ŒæˆåŠŸåˆ™ä¼ ç»™ä¸‹ä¸€ä¸ª</li>
            <li>âœ… é€šè¿‡ setNext() æ–¹æ³•è¿æ¥æˆé“¾æ¡</li>
            <li>âœ… æ–°å¢éªŒè¯è§„åˆ™åªéœ€åˆ›å»ºæ–°çš„å¤„ç†è€…å¹¶åŠ å…¥é“¾æ¡</li>
            <li>âœ… å¯ä»¥åŠ¨æ€è°ƒæ•´è´£ä»»é“¾çš„é¡ºåºå’Œç»„æˆ</li>
          </ul>
        </Card>
      </Card>
    </div>
  );
};

export default ChainValidationForm;
```

#### ğŸ¯ ä½¿ç”¨è´£ä»»é“¾æ¨¡å¼åçš„å¥½å¤„

1. **è§£è€¦éªŒè¯é€»è¾‘**ï¼šæ¯ä¸ªéªŒè¯è§„åˆ™ç‹¬ç«‹ï¼Œäº’ä¸å¹²æ‰°
2. **æ˜“äºæ‰©å±•**ï¼šæ–°å¢éªŒè¯è§„åˆ™æ— éœ€ä¿®æ”¹ç°æœ‰ä»£ç 
3. **çµæ´»ç»„åˆ**ï¼šå¯ä»¥åŠ¨æ€è°ƒæ•´éªŒè¯é¡ºåº
4. **èŒè´£å•ä¸€**ï¼šæ¯ä¸ªå¤„ç†è€…åªè´Ÿè´£ä¸€ç§éªŒè¯

---

### åœºæ™¯äºŒï¼šæƒé™éªŒè¯é“¾ï¼ˆå¤šçº§æƒé™æ£€æŸ¥ï¼‰

å®ç°ä¸€ä¸ªå¤šçº§æƒé™éªŒè¯ç³»ç»Ÿï¼Œç”¨äºæ¥å£è¯·æ±‚å‰çš„æƒé™æ£€æŸ¥ï¼š

```typescript
import React, { useState } from 'react';
import { Card, Button, Space, Table, Tag, message, Modal } from 'antd';
import { LockOutlined, UnlockOutlined, UserOutlined } from '@ant-design/icons';

// æƒé™éªŒè¯è¯·æ±‚
interface AuthRequest {
  user: {
    id: number;
    name: string;
    role: 'guest' | 'user' | 'vip' | 'admin';
    isLoggedIn: boolean;
    isVerified: boolean;
    permissions: string[];
  };
  resource: string;
  action: 'read' | 'write' | 'delete';
}

// æƒé™éªŒè¯ç»“æœ
interface AuthResult {
  allowed: boolean;
  message: string;
  handler?: string;
}

// æƒé™éªŒè¯å¤„ç†è€…
abstract class AuthHandler {
  protected nextHandler: AuthHandler | null = null;
  
  setNext(handler: AuthHandler): AuthHandler {
    this.nextHandler = handler;
    return handler;
  }
  
  handle(request: AuthRequest): AuthResult {
    const result = this.check(request);
    
    // å¦‚æœéªŒè¯å¤±è´¥ï¼Œç›´æ¥è¿”å›
    if (!result.allowed) {
      return { ...result, handler: this.getName() };
    }
    
    // å¦‚æœæœ‰ä¸‹ä¸€ä¸ªå¤„ç†è€…ï¼Œç»§ç»­ä¼ é€’
    if (this.nextHandler) {
      return this.nextHandler.handle(request);
    }
    
    // æ‰€æœ‰éªŒè¯éƒ½é€šè¿‡
    return { allowed: true, message: 'æƒé™éªŒè¯é€šè¿‡', handler: this.getName() };
  }
  
  protected abstract check(request: AuthRequest): AuthResult;
  abstract getName(): string;
}

// ç™»å½•éªŒè¯å¤„ç†è€…
class LoginCheckHandler extends AuthHandler {
  protected check(request: AuthRequest): AuthResult {
    console.log('[ç™»å½•éªŒè¯] æ£€æŸ¥ç”¨æˆ·æ˜¯å¦ç™»å½•');
    
    if (!request.user.isLoggedIn) {
      return { 
        allowed: false, 
        message: 'âŒ ç”¨æˆ·æœªç™»å½•ï¼Œè¯·å…ˆç™»å½•' 
      };
    }
    
    return { allowed: true, message: 'âœ… ç”¨æˆ·å·²ç™»å½•' };
  }
  
  getName(): string {
    return 'ç™»å½•éªŒè¯';
  }
}

// èº«ä»½éªŒè¯å¤„ç†è€…
class VerificationCheckHandler extends AuthHandler {
  protected check(request: AuthRequest): AuthResult {
    console.log('[èº«ä»½éªŒè¯] æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å®Œæˆå®åè®¤è¯');
    
    if (!request.user.isVerified) {
      return { 
        allowed: false, 
        message: 'âŒ ç”¨æˆ·æœªå®Œæˆå®åè®¤è¯' 
      };
    }
    
    return { allowed: true, message: 'âœ… ç”¨æˆ·å·²å®åè®¤è¯' };
  }
  
  getName(): string {
    return 'èº«ä»½éªŒè¯';
  }
}

// è§’è‰²æƒé™å¤„ç†è€…
class RoleCheckHandler extends AuthHandler {
  private rolePermissions: Record<string, string[]> = {
    guest: ['read'],
    user: ['read', 'write'],
    vip: ['read', 'write'],
    admin: ['read', 'write', 'delete'],
  };
  
  protected check(request: AuthRequest): AuthResult {
    console.log('[è§’è‰²æƒé™] æ£€æŸ¥ç”¨æˆ·è§’è‰²æƒé™');
    
    const allowedActions = this.rolePermissions[request.user.role] || [];
    
    if (!allowedActions.includes(request.action)) {
      return { 
        allowed: false, 
        message: `âŒ è§’è‰² ${request.user.role} æ— æƒæ‰§è¡Œ ${request.action} æ“ä½œ` 
      };
    }
    
    return { allowed: true, message: `âœ… è§’è‰²æƒé™æ£€æŸ¥é€šè¿‡` };
  }
  
  getName(): string {
    return 'è§’è‰²æƒé™';
  }
}

// èµ„æºæƒé™å¤„ç†è€…
class ResourceCheckHandler extends AuthHandler {
  protected check(request: AuthRequest): AuthResult {
    console.log('[èµ„æºæƒé™] æ£€æŸ¥ç”¨æˆ·å¯¹èµ„æºçš„è®¿é—®æƒé™');
    
    // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦æœ‰ç‰¹å®šèµ„æºçš„æƒé™
    const hasPermission = request.user.permissions.includes(request.resource);
    
    if (!hasPermission && request.action !== 'read') {
      return { 
        allowed: false, 
        message: `âŒ æ— æƒè®¿é—®èµ„æº: ${request.resource}` 
      };
    }
    
    return { allowed: true, message: 'âœ… èµ„æºæƒé™æ£€æŸ¥é€šè¿‡' };
  }
  
  getName(): string {
    return 'èµ„æºæƒé™';
  }
}

// é¢‘ç‡é™åˆ¶å¤„ç†è€…
class RateLimitHandler extends AuthHandler {
  private requestCounts: Map<number, number> = new Map();
  private readonly maxRequests = 10;
  
  protected check(request: AuthRequest): AuthResult {
    console.log('[é¢‘ç‡é™åˆ¶] æ£€æŸ¥è¯·æ±‚é¢‘ç‡');
    
    const userId = request.user.id;
    const count = this.requestCounts.get(userId) || 0;
    
    if (count >= this.maxRequests) {
      return { 
        allowed: false, 
        message: `âŒ è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œå·²è¾¾åˆ°é™åˆ¶ï¼ˆ${this.maxRequests}æ¬¡ï¼‰` 
      };
    }
    
    this.requestCounts.set(userId, count + 1);
    
    // æ¨¡æ‹Ÿé‡ç½®è®¡æ•°å™¨
    setTimeout(() => {
      this.requestCounts.set(userId, 0);
    }, 60000);
    
    return { allowed: true, message: 'âœ… é¢‘ç‡æ£€æŸ¥é€šè¿‡' };
  }
  
  getName(): string {
    return 'é¢‘ç‡é™åˆ¶';
  }
}

// React ç»„ä»¶
const AuthChainDemo: React.FC = () => {
  // æ¨¡æ‹Ÿç”¨æˆ·æ•°æ®
  const [currentUser, setCurrentUser] = useState<AuthRequest['user']>({
    id: 1,
    name: 'å¼ ä¸‰',
    role: 'user',
    isLoggedIn: false,
    isVerified: false,
    permissions: ['user-list', 'order-list'],
  });
  
  const [authResult, setAuthResult] = useState<AuthResult | null>(null);
  const [chainSteps, setChainSteps] = useState<Array<{ name: string; passed: boolean }>>([]);
  
  // åˆ›å»ºè´£ä»»é“¾
  const [authChain] = useState(() => {
    const loginCheck = new LoginCheckHandler();
    const verificationCheck = new VerificationCheckHandler();
    const roleCheck = new RoleCheckHandler();
    const resourceCheck = new ResourceCheckHandler();
    const rateLimit = new RateLimitHandler();
    
    loginCheck
      .setNext(verificationCheck)
      .setNext(roleCheck)
      .setNext(resourceCheck)
      .setNext(rateLimit);
    
    return loginCheck;
  });
  
  // æ¨¡æ‹Ÿè¯·æ±‚
  const handleRequest = (resource: string, action: 'read' | 'write' | 'delete') => {
    const request: AuthRequest = {
      user: currentUser,
      resource,
      action,
    };
    
    console.log('--- å¼€å§‹æƒé™éªŒè¯ ---');
    const result = authChain.handle(request);
    setAuthResult(result);
    
    if (result.allowed) {
      message.success(result.message);
    } else {
      message.error(result.message);
    }
  };
  
  // ç”¨æˆ·æ“ä½œ
  const toggleLogin = () => {
    setCurrentUser({ ...currentUser, isLoggedIn: !currentUser.isLoggedIn });
    setAuthResult(null);
  };
  
  const toggleVerification = () => {
    setCurrentUser({ ...currentUser, isVerified: !currentUser.isVerified });
    setAuthResult(null);
  };
  
  const changeRole = (role: 'guest' | 'user' | 'vip' | 'admin') => {
    setCurrentUser({ ...currentUser, role });
    setAuthResult(null);
  };
  
  // èµ„æºåˆ—è¡¨
  const resources = [
    { name: 'ç”¨æˆ·åˆ—è¡¨', key: 'user-list', actions: ['read', 'write', 'delete'] },
    { name: 'è®¢å•åˆ—è¡¨', key: 'order-list', actions: ['read', 'write', 'delete'] },
    { name: 'ç³»ç»Ÿè®¾ç½®', key: 'system-settings', actions: ['read', 'write', 'delete'] },
  ];
  
  return (
    <div style={{ padding: 24, backgroundColor: '#f0f2f5', minHeight: '100vh' }}>
      <Card title="ğŸ” æƒé™éªŒè¯é“¾ï¼ˆè´£ä»»é“¾æ¨¡å¼ï¼‰" style={{ maxWidth: 1200, margin: '0 auto' }}>
        {/* ç”¨æˆ·çŠ¶æ€ */}
        <Card type="inner" title="å½“å‰ç”¨æˆ·çŠ¶æ€" style={{ marginBottom: 16 }}>
          <Space direction="vertical" style={{ width: '100%' }}>
            <Space wrap>
              <Tag icon={<UserOutlined />} color="blue">
                {currentUser.name}
              </Tag>
              <Tag color={currentUser.isLoggedIn ? 'green' : 'default'}>
                {currentUser.isLoggedIn ? 'å·²ç™»å½•' : 'æœªç™»å½•'}
              </Tag>
              <Tag color={currentUser.isVerified ? 'green' : 'default'}>
                {currentUser.isVerified ? 'å·²å®å' : 'æœªå®å'}
              </Tag>
              <Tag color="purple">è§’è‰²: {currentUser.role}</Tag>
            </Space>
            
            <Space>
              <Button
                size="small"
                type={currentUser.isLoggedIn ? 'default' : 'primary'}
                onClick={toggleLogin}
              >
                {currentUser.isLoggedIn ? 'é€€å‡ºç™»å½•' : 'ç™»å½•'}
              </Button>
              <Button
                size="small"
                onClick={toggleVerification}
                disabled={!currentUser.isLoggedIn}
              >
                {currentUser.isVerified ? 'å–æ¶ˆå®å' : 'å®åè®¤è¯'}
              </Button>
              
              <div style={{ marginLeft: 16 }}>
                åˆ‡æ¢è§’è‰²ï¼š
                {['guest', 'user', 'vip', 'admin'].map(role => (
                  <Button
                    key={role}
                    size="small"
                    type={currentUser.role === role ? 'primary' : 'default'}
                    onClick={() => changeRole(role as any)}
                    style={{ marginLeft: 4 }}
                  >
                    {role}
                  </Button>
                ))}
              </div>
            </Space>
          </Space>
        </Card>
        
        {/* èµ„æºæ“ä½œ */}
        <Card type="inner" title="èµ„æºè®¿é—®" style={{ marginBottom: 16 }}>
          <Table
            dataSource={resources}
            pagination={false}
            columns={[
              {
                title: 'èµ„æºåç§°',
                dataIndex: 'name',
                key: 'name',
              },
              {
                title: 'æƒé™çŠ¶æ€',
                key: 'permission',
                render: (record: any) => {
                  const hasPermission = currentUser.permissions.includes(record.key);
                  return (
                    <Tag color={hasPermission ? 'green' : 'default'}>
                      {hasPermission ? 'æœ‰æƒé™' : 'æ— æƒé™'}
                    </Tag>
                  );
                },
              },
              {
                title: 'æ“ä½œ',
                key: 'actions',
                render: (record: any) => (
                  <Space>
                    <Button
                      size="small"
                      onClick={() => handleRequest(record.key, 'read')}
                    >
                      è¯»å–
                    </Button>
                    <Button
                      size="small"
                      onClick={() => handleRequest(record.key, 'write')}
                    >
                      å†™å…¥
                    </Button>
                    <Button
                      size="small"
                      danger
                      onClick={() => handleRequest(record.key, 'delete')}
                    >
                      åˆ é™¤
                    </Button>
                  </Space>
                ),
              },
            ]}
          />
        </Card>
        
        {/* éªŒè¯ç»“æœ */}
        {authResult && (
          <Card
            type="inner"
            title="éªŒè¯ç»“æœ"
            style={{
              marginBottom: 16,
              backgroundColor: authResult.allowed ? '#f6ffed' : '#fff2f0',
              borderColor: authResult.allowed ? '#b7eb8f' : '#ffccc7',
            }}
          >
            <Space direction="vertical" style={{ width: '100%' }}>
              <div style={{ fontSize: 16 }}>
                {authResult.allowed ? <UnlockOutlined style={{ color: '#52c41a' }} /> : <LockOutlined style={{ color: '#ff4d4f' }} />}
                {' '}
                {authResult.message}
              </div>
              {authResult.handler && (
                <Tag color={authResult.allowed ? 'green' : 'red'}>
                  {authResult.allowed ? 'é€šè¿‡æ‰€æœ‰éªŒè¯' : `å¤±è´¥äº: ${authResult.handler}`}
                </Tag>
              )}
            </Space>
          </Card>
        )}
        
        {/* è¯´æ˜ */}
        <Card type="inner" title="ğŸ“‹ è´£ä»»é“¾æ¨¡å¼è¯´æ˜">
          <ul style={{ margin: 0, paddingLeft: 20 }}>
            <li>âœ… è´£ä»»é“¾é¡ºåºï¼š<Tag>ç™»å½•éªŒè¯</Tag> â†’ <Tag>èº«ä»½éªŒè¯</Tag> â†’ <Tag>è§’è‰²æƒé™</Tag> â†’ <Tag>èµ„æºæƒé™</Tag> â†’ <Tag>é¢‘ç‡é™åˆ¶</Tag></li>
            <li>âœ… æ¯ä¸ªå¤„ç†è€…ç‹¬ç«‹åˆ¤æ–­ï¼Œå¤±è´¥åˆ™ç»ˆæ­¢ï¼ŒæˆåŠŸåˆ™ä¼ é€’ç»™ä¸‹ä¸€ä¸ª</li>
            <li>âœ… å¯ä»¥åŠ¨æ€è°ƒæ•´è´£ä»»é“¾çš„ç»„æˆå’Œé¡ºåº</li>
            <li>âœ… æ–°å¢æƒé™æ£€æŸ¥åªéœ€æ·»åŠ æ–°çš„å¤„ç†è€…</li>
          </ul>
        </Card>
      </Card>
    </div>
  );
};

export default AuthChainDemo;
```

---

### åœºæ™¯ä¸‰ï¼šä¸­é—´ä»¶ç³»ç»Ÿï¼ˆHTTP è¯·æ±‚æ‹¦æˆªé“¾ï¼‰

å®ç°ä¸€ä¸ªç±»ä¼¼ Express/Koa çš„ä¸­é—´ä»¶ç³»ç»Ÿï¼š

```typescript
import React, { useState } from 'react';
import { Card, Button, Space, Timeline, Tag, Input, message } from 'antd';
import { SendOutlined, LoadingOutlined, CheckCircleOutlined, CloseCircleOutlined } from '@ant-design/icons';

// è¯·æ±‚å¯¹è±¡
interface Request {
  url: string;
  method: string;
  headers: Record<string, string>;
  body?: any;
  timestamp: number;
}

// å“åº”å¯¹è±¡
interface Response {
  status: number;
  data?: any;
  headers: Record<string, string>;
}

// ä¸Šä¸‹æ–‡å¯¹è±¡
interface Context {
  request: Request;
  response?: Response;
  state: Record<string, any>; // å…±äº«çŠ¶æ€
  logs: string[];
}

// ä¸­é—´ä»¶å‡½æ•°ç±»å‹
type MiddlewareFunction = (ctx: Context, next: () => Promise<void>) => Promise<void>;

// ä¸­é—´ä»¶å¤„ç†è€…
class Middleware {
  private middlewares: MiddlewareFunction[] = [];
  
  // æ³¨å†Œä¸­é—´ä»¶
  use(middleware: MiddlewareFunction): void {
    this.middlewares.push(middleware);
  }
  
  // æ‰§è¡Œä¸­é—´ä»¶é“¾
  async execute(ctx: Context): Promise<void> {
    let index = 0;
    
    const dispatch = async (): Promise<void> => {
      if (index >= this.middlewares.length) return;
      
      const middleware = this.middlewares[index++];
      await middleware(ctx, dispatch);
    };
    
    await dispatch();
  }
}

// é¢„å®šä¹‰çš„ä¸­é—´ä»¶
const createMiddlewares = () => {
  // 1. æ—¥å¿—ä¸­é—´ä»¶
  const loggerMiddleware: MiddlewareFunction = async (ctx, next) => {
    const start = Date.now();
    ctx.logs.push(`ğŸ“ [æ—¥å¿—] è¯·æ±‚å¼€å§‹: ${ctx.request.method} ${ctx.request.url}`);
    
    await next();
    
    const duration = Date.now() - start;
    ctx.logs.push(`ğŸ“ [æ—¥å¿—] è¯·æ±‚ç»“æŸï¼Œè€—æ—¶: ${duration}ms`);
  };
  
  // 2. è®¤è¯ä¸­é—´ä»¶
  const authMiddleware: MiddlewareFunction = async (ctx, next) => {
    ctx.logs.push('ğŸ” [è®¤è¯] æ£€æŸ¥ Token');
    
    const token = ctx.request.headers['authorization'];
    
    if (!token) {
      ctx.response = {
        status: 401,
        data: { error: 'æœªæä¾›è®¤è¯ Token' },
        headers: {},
      };
      ctx.logs.push('âŒ [è®¤è¯] Token ç¼ºå¤±ï¼Œè¯·æ±‚ç»ˆæ­¢');
      return; // ä¸è°ƒç”¨ next()ï¼Œç»ˆæ­¢è´£ä»»é“¾
    }
    
    // æ¨¡æ‹Ÿ Token éªŒè¯
    if (token !== 'Bearer valid-token') {
      ctx.response = {
        status: 401,
        data: { error: 'Token æ— æ•ˆ' },
        headers: {},
      };
      ctx.logs.push('âŒ [è®¤è¯] Token æ— æ•ˆï¼Œè¯·æ±‚ç»ˆæ­¢');
      return;
    }
    
    ctx.state.userId = 123; // ä¿å­˜ç”¨æˆ·ä¿¡æ¯åˆ°å…±äº«çŠ¶æ€
    ctx.logs.push('âœ… [è®¤è¯] Token éªŒè¯é€šè¿‡');
    
    await next();
  };
  
  // 3. æƒé™ä¸­é—´ä»¶
  const permissionMiddleware: MiddlewareFunction = async (ctx, next) => {
    ctx.logs.push('ğŸ”‘ [æƒé™] æ£€æŸ¥ç”¨æˆ·æƒé™');
    
    // ä»å…±äº«çŠ¶æ€è·å–ç”¨æˆ·ä¿¡æ¯
    const userId = ctx.state.userId;
    
    if (!userId) {
      ctx.response = {
        status: 403,
        data: { error: 'æ— æƒé™' },
        headers: {},
      };
      ctx.logs.push('âŒ [æƒé™] æƒé™ä¸è¶³ï¼Œè¯·æ±‚ç»ˆæ­¢');
      return;
    }
    
    ctx.logs.push('âœ… [æƒé™] æƒé™æ£€æŸ¥é€šè¿‡');
    
    await next();
  };
  
  // 4. é™æµä¸­é—´ä»¶
  const rateLimitMiddleware: MiddlewareFunction = async (ctx, next) => {
    ctx.logs.push('â±ï¸ [é™æµ] æ£€æŸ¥è¯·æ±‚é¢‘ç‡');
    
    // æ¨¡æ‹Ÿé™æµæ£€æŸ¥
    const isRateLimited = Math.random() > 0.8; // 20% æ¦‚ç‡è§¦å‘é™æµ
    
    if (isRateLimited) {
      ctx.response = {
        status: 429,
        data: { error: 'è¯·æ±‚è¿‡äºé¢‘ç¹' },
        headers: {},
      };
      ctx.logs.push('âŒ [é™æµ] è§¦å‘é™æµï¼Œè¯·æ±‚ç»ˆæ­¢');
      return;
    }
    
    ctx.logs.push('âœ… [é™æµ] é¢‘ç‡æ£€æŸ¥é€šè¿‡');
    
    await next();
  };
  
  // 5. æ•°æ®å¤„ç†ä¸­é—´ä»¶
  const dataMiddleware: MiddlewareFunction = async (ctx, next) => {
    ctx.logs.push('ğŸ“¦ [æ•°æ®] å¤„ç†è¯·æ±‚æ•°æ®');
    
    // æ¨¡æ‹Ÿæ•°æ®å¤„ç†
    await new Promise(resolve => setTimeout(resolve, 500));
    
    ctx.logs.push('âœ… [æ•°æ®] æ•°æ®å¤„ç†å®Œæˆ');
    
    await next();
  };
  
  // 6. å“åº”ä¸­é—´ä»¶
  const responseMiddleware: MiddlewareFunction = async (ctx, next) => {
    await next();
    
    if (!ctx.response) {
      ctx.response = {
        status: 200,
        data: { 
          message: 'è¯·æ±‚æˆåŠŸ', 
          userId: ctx.state.userId,
          timestamp: Date.now(),
        },
        headers: { 'Content-Type': 'application/json' },
      };
      ctx.logs.push('âœ… [å“åº”] è¿”å›æˆåŠŸå“åº”');
    }
  };
  
  return {
    loggerMiddleware,
    authMiddleware,
    permissionMiddleware,
    rateLimitMiddleware,
    dataMiddleware,
    responseMiddleware,
  };
};

// React ç»„ä»¶
const MiddlewareChainDemo: React.FC = () => {
  const [url, setUrl] = useState('/api/users');
  const [token, setToken] = useState('');
  const [logs, setLogs] = useState<string[]>([]);
  const [response, setResponse] = useState<Response | null>(null);
  const [isLoading, setIsLoading] = useState(false);
  
  // åˆ›å»ºä¸­é—´ä»¶å®ä¾‹
  const [middleware] = useState(() => {
    const mw = new Middleware();
    const middlewares = createMiddlewares();
    
    // æ³¨å†Œä¸­é—´ä»¶ï¼ˆé¡ºåºå¾ˆé‡è¦ï¼ï¼‰
    mw.use(middlewares.loggerMiddleware);
    mw.use(middlewares.authMiddleware);
    mw.use(middlewares.permissionMiddleware);
    mw.use(middlewares.rateLimitMiddleware);
    mw.use(middlewares.dataMiddleware);
    mw.use(middlewares.responseMiddleware);
    
    return mw;
  });
  
  // å‘é€è¯·æ±‚
  const handleSend = async () => {
    setIsLoading(true);
    setLogs([]);
    setResponse(null);
    
    const ctx: Context = {
      request: {
        url,
        method: 'GET',
        headers: token ? { authorization: token } : {},
        timestamp: Date.now(),
      },
      state: {},
      logs: [],
    };
    
    try {
      await middleware.execute(ctx);
      
      setLogs(ctx.logs);
      setResponse(ctx.response || null);
      
      if (ctx.response?.status === 200) {
        message.success('è¯·æ±‚æˆåŠŸ');
      } else {
        message.error('è¯·æ±‚å¤±è´¥');
      }
    } catch (error) {
      message.error('è¯·æ±‚å‡ºé”™');
    } finally {
      setIsLoading(false);
    }
  };
  
  return (
    <div style={{ padding: 24, backgroundColor: '#f0f2f5', minHeight: '100vh' }}>
      <Card title="ğŸ”— HTTP ä¸­é—´ä»¶é“¾ï¼ˆè´£ä»»é“¾æ¨¡å¼ï¼‰" style={{ maxWidth: 1200, margin: '0 auto' }}>
        {/* è¯·æ±‚é…ç½® */}
        <Card type="inner" title="è¯·æ±‚é…ç½®" style={{ marginBottom: 16 }}>
          <Space direction="vertical" style={{ width: '100%' }}>
            <div>
              <div style={{ marginBottom: 8 }}>URL:</div>
              <Input
                value={url}
                onChange={(e) => setUrl(e.target.value)}
                placeholder="/api/users"
              />
            </div>
            
            <div>
              <div style={{ marginBottom: 8 }}>Token (ç•™ç©ºæµ‹è¯•è®¤è¯å¤±è´¥):</div>
              <Input
                value={token}
                onChange={(e) => setToken(e.target.value)}
                placeholder="Bearer valid-token"
              />
            </div>
            
            <Space>
              <Button
                type="primary"
                icon={isLoading ? <LoadingOutlined /> : <SendOutlined />}
                onClick={handleSend}
                loading={isLoading}
              >
                å‘é€è¯·æ±‚
              </Button>
              <Button onClick={() => setToken('Bearer valid-token')}>
                ä½¿ç”¨æœ‰æ•ˆ Token
              </Button>
              <Button onClick={() => setToken('')}>
                æ¸…ç©º Token
              </Button>
            </Space>
          </Space>
        </Card>
        
        <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: 16 }}>
          {/* ä¸­é—´ä»¶æ‰§è¡Œæ—¥å¿— */}
          <Card type="inner" title="ä¸­é—´ä»¶æ‰§è¡Œæ—¥å¿—">
            {logs.length === 0 ? (
              <div style={{ textAlign: 'center', color: '#999', padding: 40 }}>
                ç‚¹å‡»"å‘é€è¯·æ±‚"æŸ¥çœ‹ä¸­é—´ä»¶æ‰§è¡Œè¿‡ç¨‹
              </div>
            ) : (
              <Timeline
                items={logs.map((log, index) => ({
                  children: (
                    <div style={{ fontSize: 12 }}>
                      {log}
                    </div>
                  ),
                  color: log.includes('âŒ') ? 'red' : log.includes('âœ…') ? 'green' : 'blue',
                }))}
              />
            )}
          </Card>
          
          {/* å“åº”ç»“æœ */}
          <Card type="inner" title="å“åº”ç»“æœ">
            {!response ? (
              <div style={{ textAlign: 'center', color: '#999', padding: 40 }}>
                ç­‰å¾…å“åº”...
              </div>
            ) : (
              <div>
                <Space style={{ marginBottom: 16 }}>
                  <Tag color={response.status === 200 ? 'green' : 'red'}>
                    çŠ¶æ€ç : {response.status}
                  </Tag>
                  {response.status === 200 ? (
                    <CheckCircleOutlined style={{ color: '#52c41a', fontSize: 20 }} />
                  ) : (
                    <CloseCircleOutlined style={{ color: '#ff4d4f', fontSize: 20 }} />
                  )}
                </Space>
                
                <pre style={{
                  backgroundColor: '#f5f5f5',
                  padding: 12,
                  borderRadius: 4,
                  overflow: 'auto',
                  fontSize: 12,
                }}>
                  {JSON.stringify(response.data, null, 2)}
                </pre>
              </div>
            )}
          </Card>
        </div>
        
        {/* è¯´æ˜ */}
        <Card type="inner" title="ğŸ“‹ è´£ä»»é“¾æ¨¡å¼è¯´æ˜" style={{ marginTop: 16 }}>
          <ul style={{ margin: 0, paddingLeft: 20 }}>
            <li>âœ… ä¸­é—´ä»¶é“¾é¡ºåºï¼š<Tag>æ—¥å¿—</Tag> â†’ <Tag>è®¤è¯</Tag> â†’ <Tag>æƒé™</Tag> â†’ <Tag>é™æµ</Tag> â†’ <Tag>æ•°æ®å¤„ç†</Tag> â†’ <Tag>å“åº”</Tag></li>
            <li>âœ… æ¯ä¸ªä¸­é—´ä»¶è°ƒç”¨ next() å°†è¯·æ±‚ä¼ é€’ç»™ä¸‹ä¸€ä¸ªä¸­é—´ä»¶</li>
            <li>âœ… ä»»ä½•ä¸­é—´ä»¶å¯ä»¥ç»ˆæ­¢é“¾æ¡ï¼ˆä¸è°ƒç”¨ nextï¼‰</li>
            <li>âœ… ä¸­é—´ä»¶å¯ä»¥åœ¨ next() å‰åæ‰§è¡Œä»£ç ï¼ˆç±»ä¼¼æ´‹è‘±æ¨¡å‹ï¼‰</li>
            <li>âœ… é€šè¿‡ ctx.state åœ¨ä¸­é—´ä»¶é—´å…±äº«æ•°æ®</li>
          </ul>
        </Card>
      </Card>
    </div>
  );
};

export default MiddlewareChainDemo;
```

## æ¨¡å¼æ€»ç»“

### âœ… ä¼˜ç‚¹

1. **é™ä½è€¦åˆåº¦**ï¼šè¯·æ±‚è€…å’Œå¤„ç†è€…è§£è€¦ï¼Œè¯·æ±‚è€…ä¸éœ€è¦çŸ¥é“è°å¤„ç†
2. **èŒè´£å•ä¸€**ï¼šæ¯ä¸ªå¤„ç†è€…åªè´Ÿè´£ä¸€ç§å¤„ç†é€»è¾‘
3. **çµæ´»ç»„åˆ**ï¼šå¯ä»¥åŠ¨æ€è°ƒæ•´é“¾æ¡çš„ç»„æˆå’Œé¡ºåº
4. **æ˜“äºæ‰©å±•**ï¼šæ–°å¢å¤„ç†è€…ä¸å½±å“ç°æœ‰ä»£ç 
5. **ç¬¦åˆå¼€é—­åŸåˆ™**ï¼šå¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­

### âŒ ç¼ºç‚¹

1. **è°ƒè¯•å›°éš¾**ï¼šè¯·æ±‚åœ¨é“¾æ¡ä¸­ä¼ é€’ï¼Œè°ƒè¯•æ—¶éš¾ä»¥è¿½è¸ª
2. **æ€§èƒ½å¼€é”€**ï¼šè¯·æ±‚éœ€è¦éå†æ•´ä¸ªé“¾æ¡
3. **ä¸ä¿è¯å¤„ç†**ï¼šå¦‚æœæ²¡æœ‰å¤„ç†è€…å¤„ç†è¯·æ±‚ï¼Œå¯èƒ½å¯¼è‡´é—®é¢˜
4. **é“¾æ¡è¿‡é•¿**ï¼šå¤„ç†è€…è¿‡å¤šæ—¶ï¼Œæ€§èƒ½å’Œå¯ç»´æŠ¤æ€§ä¸‹é™

### ğŸ¯ é€‚ç”¨åœºæ™¯

è´£ä»»é“¾æ¨¡å¼ç‰¹åˆ«é€‚åˆä»¥ä¸‹å‰ç«¯åœºæ™¯ï¼š

| åœºæ™¯ | è¯´æ˜ | å…¸å‹å®ç° |
|------|------|---------|
| **è¡¨å•éªŒè¯** | å¤šå±‚éªŒè¯è§„åˆ™ | å¿…å¡«ã€é•¿åº¦ã€æ ¼å¼ã€ä¸šåŠ¡è§„åˆ™ |
| **æƒé™éªŒè¯** | å¤šçº§æƒé™æ£€æŸ¥ | ç™»å½•ã€è§’è‰²ã€èµ„æºã€é¢‘ç‡é™åˆ¶ |
| **ä¸­é—´ä»¶ç³»ç»Ÿ** | HTTP è¯·æ±‚æ‹¦æˆª | æ—¥å¿—ã€è®¤è¯ã€æƒé™ã€é™æµ |
| **å®¡æ‰¹æµç¨‹** | å¤šçº§å®¡æ‰¹ | ç»„é•¿ â†’ ç»ç† â†’ æ€»ç›‘ â†’ CEO |
| **äº‹ä»¶å†’æ³¡** | DOM äº‹ä»¶ä¼ é€’ | å­å…ƒç´  â†’ çˆ¶å…ƒç´  â†’ ç¥–å…ˆå…ƒç´  |
| **é”™è¯¯å¤„ç†** | å¤šå±‚é”™è¯¯æ•è· | ç»„ä»¶çº§ â†’ é¡µé¢çº§ â†’ å…¨å±€çº§ |
| **æ—¥å¿—å¤„ç†** | æ—¥å¿—åˆ†çº§å¤„ç† | Debug â†’ Info â†’ Warning â†’ Error |

### ğŸ¤” ä»€ä¹ˆæ—¶å€™è¯¥ç”¨è´£ä»»é“¾æ¨¡å¼ï¼Ÿ

**ä¸‰ä¸ªåˆ¤æ–­æ ‡å‡†ï¼š**

1. **æœ‰å¤šä¸ªå¤„ç†è€…å¯ä»¥å¤„ç†åŒä¸€è¯·æ±‚å—ï¼Ÿ**
   - å¤šä¸ªéªŒè¯è§„åˆ™ã€å¤šçº§å®¡æ‰¹ã€å¤šä¸ªä¸­é—´ä»¶

2. **å¤„ç†è€…çš„é¡ºåºå¾ˆé‡è¦å—ï¼Ÿ**
   - å…ˆæ£€æŸ¥ Aï¼Œå†æ£€æŸ¥ Bï¼Œé¡ºåºä¸èƒ½ä¹±

3. **éœ€è¦åŠ¨æ€ç»„åˆå¤„ç†è€…å—ï¼Ÿ**
   - æ ¹æ®åœºæ™¯è°ƒæ•´å¤„ç†é“¾

**å¿«é€Ÿå†³ç­–æ ‘ï¼š**

```
ä¸€ä¸ªè¯·æ±‚éœ€è¦å¤šä¸ªå¤„ç†è€…å¤„ç†å—ï¼Ÿ
    â”œâ”€ æ˜¯ â†’ å¤„ç†è€…ä¹‹é—´æœ‰é¡ºåºå…³ç³»å—ï¼Ÿ
    â”‚        â”œâ”€ æ˜¯ â†’ éœ€è¦çµæ´»ç»„åˆå¤„ç†è€…å—ï¼Ÿ
    â”‚        â”‚        â”œâ”€ æ˜¯ â†’ âœ… ç”¨è´£ä»»é“¾æ¨¡å¼ï¼
    â”‚        â”‚        â””â”€ å¦ â†’ ğŸ¤” ç®€å•é“¾å¼è°ƒç”¨ä¹Ÿè¡Œ
    â”‚        â””â”€ å¦ â†’ ğŸ¤” è€ƒè™‘ç­–ç•¥æ¨¡å¼
    â””â”€ å¦ â†’ âŒ ä¸éœ€è¦
```

### ğŸ†š è´£ä»»é“¾æ¨¡å¼ vs ç­–ç•¥æ¨¡å¼

| ç‰¹å¾ | è´£ä»»é“¾æ¨¡å¼ | ç­–ç•¥æ¨¡å¼ |
|------|-----------|---------|
| **ç›®çš„** | å¤šä¸ªå¤„ç†è€…ä¾æ¬¡å¤„ç†è¯·æ±‚ | é€‰æ‹©ä¸€ä¸ªç®—æ³•å¤„ç†è¯·æ±‚ |
| **å¤„ç†æ•°é‡** | å¯èƒ½å¤šä¸ªå¤„ç†è€…éƒ½å¤„ç† | åªæœ‰ä¸€ä¸ªç­–ç•¥å¤„ç† |
| **æ˜¯å¦ä¼ é€’** | æ²¿é“¾æ¡ä¼ é€’ | ä¸ä¼ é€’ |
| **è°å†³å®šå¤„ç†** | å¤„ç†è€…è‡ªå·±å†³å®š | å®¢æˆ·ç«¯é€‰æ‹©ç­–ç•¥ |
| **å…¸å‹åœºæ™¯** | éªŒè¯é“¾ã€ä¸­é—´ä»¶ã€å®¡æ‰¹æµ | æ”¯ä»˜æ–¹å¼ã€æ’åºç®—æ³• |

### ğŸ’¡ å‰ç«¯æ¡†æ¶ä¸­çš„è´£ä»»é“¾æ¨¡å¼

#### 1. Express/Koa ä¸­é—´ä»¶

```typescript
// Express ä¸­é—´ä»¶å°±æ˜¯è´£ä»»é“¾æ¨¡å¼
app.use(logger);
app.use(auth);
app.use(router);

// æ¯ä¸ªä¸­é—´ä»¶è°ƒç”¨ next() ä¼ é€’ç»™ä¸‹ä¸€ä¸ª
function logger(req, res, next) {
  console.log('Request received');
  next(); // ä¼ é€’ç»™ä¸‹ä¸€ä¸ªä¸­é—´ä»¶
}
```

#### 2. Vue Router å¯¼èˆªå®ˆå«

```typescript
// å…¨å±€å‰ç½®å®ˆå« â†’ è·¯ç”±ç‹¬äº«å®ˆå« â†’ ç»„ä»¶å®ˆå«
router.beforeEach((to, from, next) => {
  // æ£€æŸ¥æƒé™
  if (requiresAuth && !isLoggedIn) {
    next('/login');
  } else {
    next(); // ä¼ é€’ç»™ä¸‹ä¸€ä¸ªå®ˆå«
  }
});
```

#### 3. DOM äº‹ä»¶å†’æ³¡

```typescript
// äº‹ä»¶ä»å­å…ƒç´ å†’æ³¡åˆ°çˆ¶å…ƒç´ 
element.addEventListener('click', (e) => {
  // å¤„ç†äº‹ä»¶
  // å¦‚æœä¸è°ƒç”¨ e.stopPropagation()ï¼Œäº‹ä»¶ä¼šç»§ç»­å‘ä¸Šä¼ é€’
});
```

#### 4. Promise é“¾

```typescript
// Promise çš„ then å°±æ˜¯è´£ä»»é“¾
fetch('/api/users')
  .then(response => response.json())  // å¤„ç†è€…1
  .then(data => validate(data))       // å¤„ç†è€…2
  .then(data => transform(data))      // å¤„ç†è€…3
  .catch(error => handleError(error)); // é”™è¯¯å¤„ç†è€…
```

### ğŸ”§ å®ç°æŠ€å·§

#### 1. æ”¯æŒé“¾å¼è°ƒç”¨

```typescript
class Handler {
  setNext(handler: Handler): Handler {
    this.nextHandler = handler;
    return handler; // è¿”å›ä¸‹ä¸€ä¸ªå¤„ç†è€…ï¼Œæ”¯æŒé“¾å¼è°ƒç”¨
  }
}

// ä½¿ç”¨
handler1
  .setNext(handler2)
  .setNext(handler3)
  .setNext(handler4);
```

#### 2. æ´‹è‘±æ¨¡å‹ï¼ˆKoa é£æ ¼ï¼‰

```typescript
async function middleware1(ctx, next) {
  console.log('1 - before');
  await next();
  console.log('1 - after');
}

async function middleware2(ctx, next) {
  console.log('2 - before');
  await next();
  console.log('2 - after');
}

// è¾“å‡ºï¼š
// 1 - before
// 2 - before
// 2 - after
// 1 - after
```

#### 3. æ¡ä»¶ä¼ é€’

```typescript
handle(request) {
  if (this.canHandle(request)) {
    this.process(request);
    // å³ä½¿å¤„ç†äº†ï¼Œä¹Ÿå¯ä»¥ç»§ç»­ä¼ é€’
    if (this.shouldContinue()) {
      this.nextHandler?.handle(request);
    }
  } else {
    this.nextHandler?.handle(request);
  }
}
```

---

## ğŸ’¬ å°ç»“

è´£ä»»é“¾æ¨¡å¼å°±åƒ"æ¥åŠ›èµ›"ï¼Œè¯·æ±‚åœ¨å¤„ç†è€…ä¹‹é—´ä¼ é€’ï¼Œæ¯ä¸ªå¤„ç†è€…éƒ½æœ‰æœºä¼šå¤„ç†å®ƒï¼Œæˆ–è€…ä¼ é€’ç»™ä¸‹ä¸€ä¸ªã€‚

åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œè´£ä»»é“¾æ¨¡å¼èƒ½è®©ä½ çš„ä»£ç ï¼š
- ä»"å¤šå±‚åµŒå¥— if-else"å˜æˆ"ç‹¬ç«‹çš„å¤„ç†è€…é“¾æ¡"
- ä»"å¤„ç†é€»è¾‘è€¦åˆ"å˜æˆ"èŒè´£å•ä¸€çš„å¤„ç†è€…"
- ä»"éš¾ä»¥æ‰©å±•"å˜æˆ"çµæ´»ç»„åˆå¤„ç†è€…"

**è®°ä½ä¸€å¥è¯**ï¼šå½“ä½ éœ€è¦å¤šä¸ªå¤„ç†è€…æŒ‰é¡ºåºå¤„ç†åŒä¸€ä¸ªè¯·æ±‚æ—¶ï¼Œå°±è¯¥è€ƒè™‘è´£ä»»é“¾æ¨¡å¼äº†ï¼

---

> ğŸ’¡ **æ€è€ƒé¢˜**ï¼š
> 1. è´£ä»»é“¾æ¨¡å¼å’Œç­–ç•¥æ¨¡å¼æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ
> 2. Express çš„ä¸­é—´ä»¶å’Œ Koa çš„ä¸­é—´ä»¶æœ‰ä»€ä¹ˆä¸åŒï¼Ÿï¼ˆæç¤ºï¼šæ´‹è‘±æ¨¡å‹ï¼‰
> 3. å¦‚ä½•åœ¨è´£ä»»é“¾ä¸­å®ç°"è·³è¿‡æŸäº›å¤„ç†è€…"çš„åŠŸèƒ½ï¼Ÿ

---

> ğŸ“š **ç›¸å…³æ¨¡å¼**ï¼š
> - å‘½ä»¤æ¨¡å¼ï¼ˆCommandï¼‰ï¼šå‘½ä»¤å¯ä»¥åœ¨è´£ä»»é“¾ä¸­ä¼ é€’
> - è£…é¥°å™¨æ¨¡å¼ï¼ˆDecoratorï¼‰ï¼šéƒ½æ˜¯é“¾å¼ç»“æ„ï¼Œä½†è£…é¥°å™¨æ˜¯å¢å¼ºåŠŸèƒ½
> - ç»„åˆæ¨¡å¼ï¼ˆCompositeï¼‰ï¼šå¯ä»¥ç”¨ç»„åˆæ¨¡å¼æ„å»ºå¤æ‚çš„è´£ä»»é“¾

